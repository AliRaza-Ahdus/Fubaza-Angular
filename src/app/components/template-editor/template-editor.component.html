<div class="template-editor-container">
  <!-- Mobile Navigation Buttons (Visible only on small screens) -->
  <div class="mobile-nav-buttons">
    <button [ngClass]="{'active': activeMobilePanel === 'sidebar'}" (click)="toggleMobilePanel('sidebar')">
      <mat-icon>dashboard</mat-icon>
      <span>Elements</span>
    </button>
    <button [ngClass]="{'active': activeMobilePanel === 'canvas'}" (click)="toggleMobilePanel('canvas')">
      <mat-icon>edit</mat-icon>
      <span>Canvas</span>
    </button>
    <button [ngClass]="{'active': activeMobilePanel === 'properties'}" (click)="toggleMobilePanel('properties')" [disabled]="selectedElement === null">
      <mat-icon>tune</mat-icon>
      <span>Properties</span>
    </button>
  </div>

  <div class="template-editor-header">
    <div class="header-left">
      <div class="app-logo">
        <mat-icon>dashboard_customize</mat-icon>
        <h2 class="template-editor-title">Template Studio</h2>
      </div>
      <div class="template-info">
        <input type="text" class="template-name-input" [(ngModel)]="template.name" placeholder="Untitled Template">
        <select class="template-type-select" [(ngModel)]="template.type">
          <option value="">Select type</option>
          <option *ngFor="let type of templateTypes" [value]="type.value">{{ type.label }}</option>
        </select>
      </div>
    </div>
    <div class="header-actions">
      <div class="history-controls">
        <button class="history-btn" [disabled]="!canUndo" (click)="undo()" title="Undo">
          <mat-icon>undo</mat-icon>
        </button>
        <button class="history-btn" [disabled]="!canRedo" (click)="redo()" title="Redo">
          <mat-icon>redo</mat-icon>
        </button>
      </div>
      <button class="preview-btn" title="Preview" (click)="previewTemplate()">
        <mat-icon>visibility</mat-icon>
      </button>
      <button class="save-btn" (click)="saveTemplate()">
        <mat-icon>save</mat-icon>
        <span>Save</span>
      </button>
      <button class="exit-btn" (click)="cancelEdit()">Exit</button>
    </div>
  </div>
  
  <div class="template-editor-main">
    <div class="template-sidebar" [ngClass]="{'mobile-active': activeMobilePanel === 'sidebar'}">
      <div class="sidebar-section">
        <h3 class="sidebar-title">Elements</h3>
        <div class="elements-list">
          <div class="element-item" draggable="true" (dragstart)="onDragStart($event, 'text')">
            <mat-icon>text_fields</mat-icon>
            <span>Text</span>
          </div>
          <div class="element-item" draggable="true" (dragstart)="onDragStart($event, 'image')">
            <mat-icon>image</mat-icon>
            <span>Image</span>
          </div>
          <div class="element-item" draggable="true" (dragstart)="onDragStart($event, 'shape')">
            <mat-icon>crop_square</mat-icon>
            <span>Shape</span>
          </div>
        </div>
      </div>
      
      <div class="sidebar-section">
        <h3 class="sidebar-title">Templates</h3>
        <div class="template-presets">
          <div class="preset-item">
            <div class="preset-preview">Email</div>
            <span>Email Template</span>
          </div>
          <div class="preset-item">
            <div class="preset-preview">Notice</div>
            <span>Notification</span>
          </div>
          <div class="preset-item">
            <div class="preset-preview">Report</div>
            <span>Report</span>
          </div>
        </div>
      </div>
      
      <div class="sidebar-section">
        <h3 class="sidebar-title">Uploads</h3>
        <div class="upload-section">
          <button class="upload-btn" (click)="triggerUpload()">
            <mat-icon>cloud_upload</mat-icon>
            <span>Upload Image</span>
          </button>
          <input type="file" #fileUpload style="display: none" (change)="onFileSelected($event)" accept="image/*">
        </div>
        <div class="uploads-list" *ngIf="uploads.length > 0">
          <div class="upload-item" *ngFor="let upload of uploads" (click)="addElementToCanvas('image', upload)">
            <img [src]="upload.url" [alt]="upload.name">
          </div>
        </div>
      </div>
    </div>
    
    <div class="canvas-container" [ngClass]="{'mobile-active': activeMobilePanel === 'canvas'}">
      <div class="canvas-toolbar">
        <div class="toolbar-section">
          <div class="canvas-size-controls">
            <button class="size-btn" (click)="setCanvasSize('small')">Small</button>
            <button class="size-btn" (click)="setCanvasSize('medium')">Medium</button>
            <button class="size-btn" (click)="setCanvasSize('large')">Large</button>
            <button class="size-btn custom" title="Custom Size">
              <mat-icon>settings</mat-icon>
            </button>
          </div>
        </div>
        <div class="toolbar-section">
          <div class="zoom-controls">
            <button class="zoom-btn" (click)="zoom(-10)" title="Zoom Out">
              <mat-icon>zoom_out</mat-icon>
            </button>
            <span class="zoom-level">{{ zoomLevel }}%</span>
            <button class="zoom-btn" (click)="zoom(10)" title="Zoom In">
              <mat-icon>zoom_in</mat-icon>
            </button>
          </div>
        </div>
      </div>
      
      <div class="canvas-workspace" [style.transform]="'scale(' + zoomLevel/100 + ')'" (drop)="onDrop($event)" (dragover)="onDragOver($event)">
        <div class="canvas" #canvas [style.width.px]="canvasWidth" [style.height.px]="canvasHeight">
          <!-- Canvas elements will be rendered here -->
          <div *ngFor="let element of canvasElements; let i = index" 
               class="canvas-element" 
               [ngClass]="{'selected': selectedElement === i}" 
               [style.left.px]="element.x" 
               [style.top.px]="element.y"
               [style.width.px]="element.width"
               [style.height.px]="element.height"
               (mousedown)="selectElement(i, $event)">
            
            <!-- Text element -->
            <div *ngIf="element.type === 'text'" 
                 class="text-element" 
                 [style.fontSize.px]="element.fontSize"
                 [style.color]="element.color"
                 [style.fontFamily]="element.fontFamily"
                 [style.fontWeight]="element.fontWeight"
                 [style.fontStyle]="element.fontStyle"
                 [style.textDecoration]="element.textDecoration"
                 [style.textAlign]="element.textAlign"
                 [style.backgroundColor]="element.backgroundColor"
                 [style.padding.px]="element.padding"
                 [style.borderRadius.px]="element.borderRadius"
                 [contentEditable]="selectedElement === i"
                 (blur)="updateElementContent(i, $event)"
                 (focus)="selectedElement = i">
              {{ element.content }}
            </div>
            
            <!-- Image element -->
            <img *ngIf="element.type === 'image'" 
                 [src]="element.src" 
                 [alt]="element.alt || 'Image'" 
                 class="image-element"
                 [style.objectFit]="element.objectFit || 'contain'"
                 [style.objectPosition]="element.objectPosition || 'center'"
                 [style.borderRadius.px]="element.borderRadius"
                 [style.border]="element.border"
                 [style.boxShadow]="element.boxShadow"
                 [style.filter]="element.filter"
                 [style.opacity]="element.opacity || 1">
            
            <!-- Shape element -->
            <div *ngIf="element.type === 'shape'" 
                 class="shape-element"
                 [style.backgroundColor]="element.color"
                 [style.borderRadius.px]="element.shape === 'circle' ? element.width/2 : element.borderRadius"
                 [style.clipPath]="element.shape === 'triangle' ? 'polygon(50% 0%, 0% 100%, 100% 100%)' : null"
                 [style.boxShadow]="element.boxShadow"
                 [style.opacity]="element.opacity || 1"
                 [style.border]="element.border"
                 [style.transform]="element.rotate ? 'rotate(' + element.rotate + 'deg)' : null">
            </div>
            
            <!-- Resize handles (only show for selected element) -->
            <div *ngIf="selectedElement === i" class="resize-handles">
              <div class="resize-handle top-left" (mousedown)="startResize(i, 'top-left', $event)"></div>
              <div class="resize-handle top-right" (mousedown)="startResize(i, 'top-right', $event)"></div>
              <div class="resize-handle bottom-left" (mousedown)="startResize(i, 'bottom-left', $event)"></div>
              <div class="resize-handle bottom-right" (mousedown)="startResize(i, 'bottom-right', $event)"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="properties-panel" *ngIf="selectedElement !== null" [ngClass]="{'mobile-active': activeMobilePanel === 'properties'}">
      <h3 class="panel-title">Properties</h3>
      
      <div class="quick-actions">
        <button class="action-btn" title="Bring Forward">
          <mat-icon>flip_to_front</mat-icon>
        </button>
        <button class="action-btn" title="Send Backward">
          <mat-icon>flip_to_back</mat-icon>
        </button>
        <button class="action-btn" title="Duplicate" (click)="duplicateElement(selectedElement)">
          <mat-icon>content_copy</mat-icon>
        </button>
        <button class="action-btn delete" title="Delete" (click)="deleteElement(selectedElement)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      
      <!-- Common properties -->
      <div class="property-group">
        <label>Position & Size</label>
        <div class="property-grid">
          <div class="property-control">
            <span>X</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].x" (change)="updateElement()">
          </div>
          <div class="property-control">
            <span>Y</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].y" (change)="updateElement()">
          </div>
          <div class="property-control">
            <span>W</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].width" (change)="updateElement()">
          </div>
          <div class="property-control">
            <span>H</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].height" (change)="updateElement()">
          </div>
        </div>
      </div>
      
      <!-- Text specific properties -->
      <div *ngIf="canvasElements[selectedElement].type === 'text'">
        <div class="property-group">
          <label>Text Content</label>
          <textarea [(ngModel)]="canvasElements[selectedElement].content" (change)="updateElement()" class="text-editor"></textarea>
        </div>
        
        <div class="property-group">
          <label>Font</label>
          <div class="text-formatting">
            <select [(ngModel)]="canvasElements[selectedElement].fontFamily" (change)="updateElement()" class="font-select">
              <option value="Arial">Arial</option>
              <option value="Helvetica">Helvetica</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Courier New">Courier New</option>
              <option value="Verdana">Verdana</option>
              <option value="Georgia">Georgia</option>
              <option value="Roboto">Roboto</option>
              <option value="Open Sans">Open Sans</option>
              <option value="Montserrat">Montserrat</option>
            </select>
            
            <div class="text-controls">
              <div class="font-size-control">
                <span>Size</span>
                <input type="number" [(ngModel)]="canvasElements[selectedElement].fontSize" (change)="updateElement()">
              </div>
              
              <div class="color-control">
                <span>Color</span>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].color" (change)="updateElement()">
              </div>
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Text Style</label>
          <div class="style-buttons">
            <button type="button" [ngClass]="{'active': canvasElements[selectedElement].fontWeight === 'bold'}" 
                    (click)="toggleTextStyle('fontWeight', 'bold')" title="Bold">
              <mat-icon>format_bold</mat-icon>
            </button>
            <button type="button" [ngClass]="{'active': canvasElements[selectedElement].fontStyle === 'italic'}" 
                    (click)="toggleTextStyle('fontStyle', 'italic')" title="Italic">
              <mat-icon>format_italic</mat-icon>
            </button>
            <button type="button" [ngClass]="{'active': canvasElements[selectedElement].textDecoration === 'underline'}" 
                    (click)="toggleTextStyle('textDecoration', 'underline')" title="Underline">
              <mat-icon>format_underlined</mat-icon>
            </button>
          </div>
          <div class="alignment-buttons">
            <button type="button" [ngClass]="{'active': canvasElements[selectedElement].textAlign === 'left'}" 
                    (click)="setTextStyle('textAlign', 'left')" title="Align Left">
              <mat-icon>format_align_left</mat-icon>
            </button>
            <button type="button" [ngClass]="{'active': canvasElements[selectedElement].textAlign === 'center'}" 
                    (click)="setTextStyle('textAlign', 'center')" title="Align Center">
              <mat-icon>format_align_center</mat-icon>
            </button>
            <button type="button" [ngClass]="{'active': canvasElements[selectedElement].textAlign === 'right'}" 
                    (click)="setTextStyle('textAlign', 'right')" title="Align Right">
              <mat-icon>format_align_right</mat-icon>
            </button>
          </div>
        </div>
        
        <div class="property-group">
          <label>Background & Spacing</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Background</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].backgroundColor" (change)="updateElement()">
            </div>
            <div class="property-control">
              <span>Padding (px)</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].padding" (change)="updateElement()" min="0" max="50">
            </div>
            <div class="property-control">
              <span>Border Radius</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" min="0" max="50">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Image specific properties -->
      <div *ngIf="canvasElements[selectedElement].type === 'image'">
        <div class="property-group">
          <label>Image</label>
          <div class="image-preview">
            <img [src]="canvasElements[selectedElement].src" [alt]="canvasElements[selectedElement].alt || 'Image'">
          </div>
          <button class="replace-image-btn" (click)="triggerUpload()">
            <mat-icon>photo_library</mat-icon>
            <span>Replace Image</span>
          </button>
        </div>
        
        <div class="property-group">
          <label>Image Appearance</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Object Fit</span>
              <select [(ngModel)]="canvasElements[selectedElement].objectFit" (change)="updateElement()">
                <option value="contain">Contain</option>
                <option value="cover">Cover</option>
                <option value="fill">Fill</option>
                <option value="scale-down">Scale Down</option>
              </select>
            </div>
            <div class="property-control">
              <span>Border Radius</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" min="0" max="100">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Effects</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" (change)="updateElement()" min="0.1" max="1" step="0.1">
              <span class="value-display">{{ canvasElements[selectedElement].opacity || 1 }}</span>
            </div>
            
            <div class="property-control">
              <span>Shadow</span>
              <select [(ngModel)]="canvasElements[selectedElement].boxShadow" (change)="updateElement()">
                <option value="none">None</option>
                <option value="0 2px 5px rgba(0,0,0,0.1)">Light</option>
                <option value="0 4px 8px rgba(0,0,0,0.2)">Medium</option>
                <option value="0 8px 16px rgba(0,0,0,0.3)">Strong</option>
              </select>
            </div>
            
            <div class="property-control">
              <span>Filter</span>
              <select [(ngModel)]="canvasElements[selectedElement].filter" (change)="updateElement()">
                <option value="none">None</option>
                <option value="grayscale(100%)">Grayscale</option>
                <option value="sepia(100%)">Sepia</option>
                <option value="blur(2px)">Blur</option>
                <option value="brightness(150%)">Brighten</option>
                <option value="contrast(150%)">Contrast</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Border</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Border Style</span>
              <select [(ngModel)]="canvasElements[selectedElement].border" (change)="updateElement()">
                <option value="none">None</option>
                <option value="1px solid #000">Thin</option>
                <option value="2px solid #000">Medium</option>
                <option value="3px solid #000">Thick</option>
                <option value="1px dashed #000">Dashed</option>
                <option value="1px dotted #000">Dotted</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Shape specific properties -->
      <div *ngIf="canvasElements[selectedElement].type === 'shape'">
        <div class="property-group">
          <label>Shape Type</label>
          <div class="shape-controls">
            <div class="shape-selector">
              <span>Type</span>
              <select [(ngModel)]="canvasElements[selectedElement].shape" (change)="updateElement()">
                <option value="rectangle">Rectangle</option>
                <option value="circle">Circle</option>
                <option value="triangle">Triangle</option>
                <option value="ellipse">Ellipse</option>
                <option value="diamond">Diamond</option>
              </select>
            </div>
            
            <div class="color-control">
              <span>Fill Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].color" (change)="updateElement()">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Shape Properties</label>
          <div class="property-controls">
            <div class="property-control" *ngIf="canvasElements[selectedElement].shape === 'rectangle'">
              <span>Border Radius</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" min="0" max="100">
            </div>
            
            <div class="property-control">
              <span>Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" (change)="updateElement()" min="0.1" max="1" step="0.1">
              <span class="value-display">{{ canvasElements[selectedElement].opacity || 1 }}</span>
            </div>
            
            <div class="property-control">
              <span>Rotation (°)</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].rotate" (change)="updateElement()" min="0" max="360">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Border & Effects</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Border</span>
              <select [(ngModel)]="canvasElements[selectedElement].border" (change)="updateElement()">
                <option value="none">None</option>
                <option value="1px solid #000">Thin</option>
                <option value="2px solid #000">Medium</option>
                <option value="3px solid #000">Thick</option>
                <option value="1px dashed #000">Dashed</option>
                <option value="1px dotted #000">Dotted</option>
              </select>
            </div>
            
            <div class="property-control">
              <span>Shadow</span>
              <select [(ngModel)]="canvasElements[selectedElement].boxShadow" (change)="updateElement()">
                <option value="none">None</option>
                <option value="0 2px 5px rgba(0,0,0,0.1)">Light</option>
                <option value="0 4px 8px rgba(0,0,0,0.2)">Medium</option>
                <option value="0 8px 16px rgba(0,0,0,0.3)">Strong</option>
                <option value="0 0 8px rgba(0,0,255,0.3)">Glow</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
