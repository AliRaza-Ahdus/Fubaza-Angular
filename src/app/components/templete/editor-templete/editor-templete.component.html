<div class="template-editor-container">
  <!-- Mobile Navigation Buttons (Visible only on small screens) -->
  <div class="mobile-nav-buttons">
    <button [ngClass]="{'active': activeMobilePanel === 'sidebar'}" (click)="toggleMobilePanel('sidebar')">
      <mat-icon>dashboard</mat-icon>
      <span>Elements</span>
    </button>
    <button [ngClass]="{'active': activeMobilePanel === 'canvas'}" (click)="toggleMobilePanel('canvas')">
      <mat-icon>brush</mat-icon>
      <span>Canvas</span>
    </button>
    <button [ngClass]="{'active': activeMobilePanel === 'properties'}" (click)="toggleMobilePanel('properties')" [disabled]="selectedElement === null">
      <mat-icon>tune</mat-icon>
      <span>Properties</span>
    </button>
  </div>

  <div class="template-editor-header">
    <div class="header-left">
      <div class="app-logo">
        <mat-icon>design_services</mat-icon>
        <h2 class="template-editor-title">Template Studio</h2>
      </div>
      <div class="template-info">
        <input type="text" class="template-name-input" [(ngModel)]="template.name" placeholder="Untitled Template">
        <select class="template-type-select" [(ngModel)]="template.type">
          <option value="">Select type</option>
          <option *ngFor="let type of templateTypes" [value]="type.value">{{ type.label }}</option>
        </select>
      </div>
    </div>
    <div class="header-actions">
      <div class="history-controls">
        <button class="history-btn" [disabled]="!canUndo" (click)="undo()" title="Undo">
          <mat-icon>undo</mat-icon>
        </button>
        <button class="history-btn" [disabled]="!canRedo" (click)="redo()" title="Redo">
          <mat-icon>redo</mat-icon>
        </button>
      </div>
      <button class="preview-btn" title="Preview" (click)="previewTemplate()">
        <mat-icon>visibility</mat-icon>
      </button>
      <div class="export-btn-wrapper">
        <button class="export-btn" (click)="toggleExportOptions()">
          <mat-icon>download</mat-icon>
          <span>Export</span>
        </button>
        <div class="export-options" *ngIf="showExportOptions">
          <button (click)="exportTemplate('png', 'standard')">PNG (Standard)</button>
          <button (click)="exportTemplate('png', 'high')">PNG (High-Res)</button>
          <button (click)="exportTemplate('jpg', 'standard')">JPG (Standard)</button>
          <button (click)="exportTemplate('jpg', 'high')">JPG (High-Res)</button>
          <button (click)="exportTemplate('pdf', 'standard')">PDF</button>
          <button (click)="generateShareLink()">Share Link</button>
        </div>
      </div>
      <button class="save-btn" (click)="saveTemplateWithImageConversion()">
        <mat-icon>save</mat-icon>
        <span>Save</span>
      </button>
      <button class="exit-btn" (click)="cancelEdit()">Exit</button>
    </div>
  </div>
  
  <div class="template-editor-body">
    <div class="sidebar" [ngClass]="{'mobile-active': activeMobilePanel === 'sidebar'}"
         style="background: #f8fafc; padding: 1rem; overflow-y: auto;">
      
      <!-- ============================================ -->
      <!-- SECTION 1: TEXT - Add Different Text Styles -->
      <!-- ============================================ -->
      <div class="sidebar-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">text_fields</mat-icon>
          </div>
          <span>Text</span>
        </h3>
        
        <!-- Compact 2-Column Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
          <!-- Heading -->
          <div (click)="addTextElement('heading')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'heading'})" (dragend)="onDragEnd()"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">title</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Heading</div>
            <div style="font-size: 0.65rem; color: #64748b;">Large text</div>
          </div>
          
          <!-- Subheading -->
          <div (click)="addTextElement('subheading')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'subheading'})" (dragend)="onDragEnd()"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">format_h2</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Subheading</div>
            <div style="font-size: 0.65rem; color: #64748b;">Medium text</div>
          </div>
          
          <!-- Body Text -->
          <div (click)="addTextElement('body')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'body'})" (dragend)="onDragEnd()"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">article</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Body</div>
            <div style="font-size: 0.65rem; color: #64748b;">Paragraph</div>
          </div>
          
          <!-- Caption -->
          <div (click)="addTextElement('caption')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'caption'})" (dragend)="onDragEnd()"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">text_fields_alt</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Caption</div>
            <div style="font-size: 0.65rem; color: #64748b;">Small text</div>
          </div>
        </div>
      </div>

      <!-- ================================================ -->
      <!-- SECTION 2: TYPOGRAPHY & EFFECTS -->
      <!-- ================================================ -->
      
      <div class="sidebar-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">font_download</mat-icon>
          </div>
          <span>Typography Combos</span>
        </h3>
        
        <!-- Compact Category Filters -->
        <div style="display: flex; gap: 0.375rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
          <button (click)="setTypographyCategory('all')" [class.active]="activeTypographyCategory === 'all'"
                  style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; transition: all 0.15s;">
            All
          </button>
          <button (click)="setTypographyCategory('modern')" [class.active]="activeTypographyCategory === 'modern'"
                  style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; transition: all 0.15s;">
            Modern
          </button>
          <button (click)="setTypographyCategory('elegant')" [class.active]="activeTypographyCategory === 'elegant'"
                  style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; transition: all 0.15s;">
            Elegant
          </button>
          <button (click)="setTypographyCategory('bold')" [class.active]="activeTypographyCategory === 'bold'"
                  style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; transition: all 0.15s;">
            Bold
          </button>
        </div>
        
        <!-- Compact Typography Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
          <div *ngFor="let combo of filteredTypographyCombos; trackBy: trackByCombo" 
               (click)="applyTypographyCombo(combo)"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s;">
            <div style="font-size: 0.75rem; font-weight: 600; color: #0f172a; margin-bottom: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
              {{ combo.name }}
            </div>
            <div style="font-size: 0.625rem; color: #64748b; margin-bottom: 0.375rem;">
              {{ combo.headingFont }}
            </div>
            <div style="background: white; padding: 0.375rem; border-radius: 4px; border: 1px solid #e2e8f0;">
              <div [ngStyle]="getComboHeadingStyle(combo)" style="font-size: 0.7rem; margin-bottom: 0.125rem;">Heading</div>
              <div [ngStyle]="getComboBodyStyle(combo)" style="font-size: 0.625rem;">Body Text</div>
            </div>
          </div>
          
          <!-- Empty State -->
          <div *ngIf="filteredTypographyCombos.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 1.5rem; color: #94a3b8;">
            <mat-icon style="font-size: 32px; width: 32px; height: 32px; opacity: 0.5;">font_download</mat-icon>
            <div style="font-size: 0.75rem; margin-top: 0.5rem;">No combos found</div>
          </div>
        </div>

        <!-- Text Effects -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.75rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">auto_fix_high</mat-icon>
          </div>
          <span>Text Effects</span>
        </h3>
        
        <!-- Compact Effects Grid -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem;">
          <div (click)="applyTextEffect('shadow')" [class.active]="hasEffect('shadow')"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">layers</mat-icon>
            </div>
            <div style="font-size: 0.65rem; font-weight: 600; color: #0f172a;">Shadow</div>
          </div>
          
          <div (click)="applyTextEffect('outline')" [class.active]="hasEffect('outline')"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">border_outer</mat-icon>
            </div>
            <div style="font-size: 0.65rem; font-weight: 600; color: #0f172a;">Outline</div>
          </div>
          
          <div (click)="applyTextEffect('gradient')" [class.active]="hasEffect('gradient')"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">gradient</mat-icon>
            </div>
            <div style="font-size: 0.65rem; font-weight: 600; color: #0f172a;">Gradient</div>
          </div>
          
          <div (click)="applyTextEffect('neon')" [class.active]="hasEffect('neon')"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">flare</mat-icon>
            </div>
            <div style="font-size: 0.65rem; font-weight: 600; color: #0f172a;">Neon</div>
          </div>
        </div>
      </div>

      <!-- Font Library Section -->
      <div class="sidebar-section font-library-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.75rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">font_download</mat-icon>
          </div>
          <span>Fonts</span>
        </h3>
        
        <!-- Compact Search -->
        <div style="position: relative; margin-bottom: 0.625rem;">
          <mat-icon style="position: absolute; left: 0.625rem; top: 50%; transform: translateY(-50%); font-size: 16px; color: #94a3b8;">search</mat-icon>
          <input type="text" [(ngModel)]="fontSearchQuery" (input)="filterFonts()" placeholder="Search fonts..."
                 style="width: 100%; padding: 0.5rem 0.5rem 0.5rem 2.25rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; outline: none; transition: all 0.15s;">
          <button *ngIf="fontSearchQuery" (click)="fontSearchQuery = ''; filterFonts()" 
                  style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0.25rem; color: #94a3b8;">
            <mat-icon style="font-size: 16px;">close</mat-icon>
          </button>
        </div>

        <!-- Compact Category Tabs -->
        <div style="display: flex; gap: 0.375rem; margin-bottom: 0.75rem; overflow-x: auto;">
          <button (click)="setFontCategory('all')" [class.active]="activeFontCategory === 'all'"
                  style="padding: 0.375rem 0.5rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px;">apps</mat-icon>
            <span>All</span>
          </button>
          <button (click)="setFontCategory('sans-serif')" [class.active]="activeFontCategory === 'sans-serif'"
                  style="padding: 0.375rem 0.5rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px;">font_download</mat-icon>
            <span>Sans</span>
          </button>
          <button (click)="setFontCategory('serif')" [class.active]="activeFontCategory === 'serif'"
                  style="padding: 0.375rem 0.5rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px;">format_quote</mat-icon>
            <span>Serif</span>
          </button>
          <button (click)="setFontCategory('display')" [class.active]="activeFontCategory === 'display'"
                  style="padding: 0.375rem 0.5rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px;">star</mat-icon>
            <span>Display</span>
          </button>
          <button (click)="setFontCategory('handwriting')" [class.active]="activeFontCategory === 'handwriting'"
                  style="padding: 0.375rem 0.5rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px;">draw</mat-icon>
            <span>Script</span>
          </button>
        </div>

        <!-- Compact Font List -->
        <div style="max-height: 280px; overflow-y: auto; margin-bottom: 0.75rem;">
          <div *ngFor="let font of filteredFonts; trackBy: trackByFont" 
               (click)="applyFont(font)"
               [class.selected]="isSelectedFont(font)"
               style="padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 0.375rem; cursor: pointer; transition: all 0.15s;">
            <div [ngStyle]="getFontPreviewStyle(font)" style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #0f172a;">
              {{ font.previewText || 'Aa Bb Cc 123' }}
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.375rem;">
                <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">{{ font.name }}</span>
                <span style="font-size: 0.625rem; padding: 0.125rem 0.375rem; background: #e0e7ff; color: #4338ca; border-radius: 4px;">{{ font.category }}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.25rem;">
                <mat-icon *ngIf="font.premium" style="font-size: 14px; width: 14px; height: 14px; color: #f59e0b;">workspace_premium</mat-icon>
                <mat-icon *ngIf="isSelectedFont(font)" style="font-size: 14px; width: 14px; height: 14px; color: #10b981;">check_circle</mat-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Compact Upload Button -->
        <button (click)="triggerFontUpload()" 
                style="width: 100%; padding: 0.625rem; background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.75rem; font-weight: 600; transition: all 0.15s;">
          <mat-icon style="font-size: 16px; width: 16px; height: 16px;">cloud_upload</mat-icon>
          <span>Upload Custom Font</span>
        </button>
        <input type="file" #fontUploadRef style="display: none" accept=".ttf,.otf,.woff,.woff2" (change)="onFontFileSelected($event)">
      </div>
      
      <!-- Media & Shapes Section -->
      <div class="sidebar-section media-shapes-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">design_services</mat-icon>
          </div>
          <span>Media & Shapes</span>
        </h3>
        
        <!-- Compact 2x2 Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
          <!-- Image -->
          <div draggable="true" (dragstart)="onDragStart($event, 'image')" (dragend)="onDragEnd()" (click)="triggerImageUpload()"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">add_photo_alternate</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Image</div>
            <div style="font-size: 0.65rem; color: #64748b;">Upload photo</div>
          </div>
          
          <!-- Shape -->
          <div draggable="true" (dragstart)="onDragStart($event, 'shape')" (dragend)="onDragEnd()" (click)="openShapeSelector()"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">category</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Shape</div>
            <div style="font-size: 0.65rem; color: #64748b;">Add shapes</div>
          </div>
          
          <!-- Line -->
          <div draggable="true" (dragstart)="onDragStart($event, 'line')" (dragend)="onDragEnd()" (click)="addElementToCanvas('line')"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">timeline</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Line</div>
            <div style="font-size: 0.65rem; color: #64748b;">Draw lines</div>
          </div>
          
          <!-- Icon -->
          <div draggable="true" (dragstart)="onDragStart($event, 'icon')" (dragend)="onDragEnd()" (click)="addElementToCanvas('icon')"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 6px; padding: 6px; display: inline-flex; margin-bottom: 0.375rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">emoji_symbols</mat-icon>
            </div>
            <div style="font-size: 0.8rem; font-weight: 600; color: #0f172a; margin-bottom: 0.125rem;">Icon</div>
            <div style="font-size: 0.65rem; color: #64748b;">Add symbols</div>
          </div>
        </div>
        
        <!-- Compact Shape Selector Panel -->
        <div *ngIf="showShapeSelector" 
             style="margin-top: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); overflow: hidden;">
          <!-- Header -->
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; border-bottom: 1px solid #e2e8f0;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <mat-icon style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 6px; padding: 4px; font-size: 16px; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">category</mat-icon>
              <h3 style="font-size: 0.875rem; font-weight: 600; color: #0f172a; margin: 0;">Shapes</h3>
            </div>
            <button (click)="closeShapeSelector()" 
                    style="background: #f8fafc; border: none; border-radius: 6px; padding: 4px; cursor: pointer; transition: all 0.15s;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">close</mat-icon>
            </button>
          </div>
          
          <!-- Search -->
          <div style="padding: 0.75rem;">
            <div style="position: relative;">
              <mat-icon style="position: absolute; left: 0.625rem; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 16px; width: 16px; height: 16px;">search</mat-icon>
              <input type="text" [(ngModel)]="shapeSearchQuery" (input)="filterShapes()" placeholder="Search shapes..."
                     style="width: 100%; padding: 0.5rem 0.5rem 0.5rem 2.25rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; background: #f8fafc; outline: none;">
              <button *ngIf="shapeSearchQuery" (click)="clearShapeSearch()" 
                      style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0.25rem;">
                <mat-icon style="font-size: 14px; color: #94a3b8;">clear</mat-icon>
              </button>
            </div>
          </div>
          
          <!-- Categories -->
          <div style="display: flex; gap: 0.375rem; padding: 0 0.75rem 0.75rem; overflow-x: auto;">
            <button (click)="setActiveCategory('all')" [class.active]="activeShapeCategory === 'all'"
                    style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; transition: all 0.15s;">
              All
            </button>
            <button (click)="setActiveCategory('basic')" [class.active]="activeShapeCategory === 'basic'"
                    style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; transition: all 0.15s;">
              Basic
            </button>
            <button (click)="setActiveCategory('geometric')" [class.active]="activeShapeCategory === 'geometric'"
                    style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; transition: all 0.15s;">
              Geometric
            </button>
            <button (click)="setActiveCategory('lines')" [class.active]="activeShapeCategory === 'lines'"
                    style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; transition: all 0.15s;">
              Lines
            </button>
            <button (click)="setActiveCategory('special')" [class.active]="activeShapeCategory === 'special'"
                    style="padding: 0.375rem 0.625rem; font-size: 0.7rem; border-radius: 6px; border: 1px solid #e2e8f0; background: white; color: #64748b; cursor: pointer; white-space: nowrap; transition: all 0.15s;">
              Special
            </button>
          </div>
          
          <!-- Shape Grid -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; padding: 0 0.75rem 0.75rem; max-height: 240px; overflow-y: auto;">
            <div *ngFor="let shape of filteredShapes; trackBy: trackByShape" 
                 (click)="addShapeToCanvas(shape.type)"
                 style="padding: 0.75rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; text-align: center; transition: all 0.15s;">
              <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #06b6d4; margin-bottom: 0.25rem;">{{ shape.icon }}</mat-icon>
              <div style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">{{ shape.name }}</div>
            </div>
            
            <!-- Empty State -->
            <div *ngIf="filteredShapes.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #94a3b8;">
              <mat-icon style="font-size: 32px; width: 32px; height: 32px; opacity: 0.5;">category</mat-icon>
              <div style="font-size: 0.75rem; margin-top: 0.5rem;">No shapes found</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Canvas Background Section -->
      <div class="sidebar-section canvas-background-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">wallpaper</mat-icon>
          </div>
          <span>Canvas Background</span>
        </h3>
        
        <!-- Compact Type Selector (3 buttons) -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 0.875rem;">
          <div (click)="setBackgroundType('color')" [class.active]="canvasBackground.type === 'color'"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #a855f7; margin-bottom: 0.25rem;">palette</mat-icon>
            <div style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Color</div>
          </div>
          
          <div (click)="setBackgroundType('gradient')" [class.active]="canvasBackground.type === 'gradient'"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #a855f7; margin-bottom: 0.25rem;">gradient</mat-icon>
            <div style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Gradient</div>
          </div>
          
          <div (click)="setBackgroundType('image')" [class.active]="canvasBackground.type === 'image'"
               style="padding: 0.625rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.15s; text-align: center;">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #a855f7; margin-bottom: 0.25rem;">image</mat-icon>
            <div style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Image</div>
          </div>
        </div>
        
        <!-- Solid Color Panel -->
        <div *ngIf="canvasBackground.type === 'color'" style="padding: 0.75rem; background: #f8fafc; border-radius: 8px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
            <span style="font-size: 0.75rem; font-weight: 600; color: #0f172a;">Background Color</span>
            <span style="font-size: 0.7rem; color: #64748b;">{{ canvasBackground.color }}</span>
          </div>
          <input type="color" [(ngModel)]="canvasBackground.color" (change)="updateCanvasBackground()"
                 style="width: 100%; height: 40px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
        </div>
        
        <!-- Gradient Panel -->
        <div *ngIf="canvasBackground.type === 'gradient'" style="padding: 0.75rem; background: #f8fafc; border-radius: 8px;">
          <select [(ngModel)]="canvasBackground.gradientType" (change)="updateCanvasBackground()"
                  style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; margin-bottom: 0.625rem; outline: none;">
            <option value="linear">Linear Gradient</option>
            <option value="radial">Radial Gradient</option>
          </select>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.625rem;">
            <div>
              <div style="font-size: 0.7rem; font-weight: 600; color: #0f172a; margin-bottom: 0.25rem;">Color 1</div>
              <input type="color" [(ngModel)]="canvasBackground.gradientColor1" (change)="updateCanvasBackground()"
                     style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
            </div>
            <div>
              <div style="font-size: 0.7rem; font-weight: 600; color: #0f172a; margin-bottom: 0.25rem;">Color 2</div>
              <input type="color" [(ngModel)]="canvasBackground.gradientColor2" (change)="updateCanvasBackground()"
                     style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
            </div>
          </div>
          
          <div *ngIf="canvasBackground.gradientType === 'linear'">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Angle</span>
              <span style="font-size: 0.7rem; color: #64748b;">{{canvasBackground.gradientAngle || 45}}°</span>
            </div>
            <input type="range" [(ngModel)]="canvasBackground.gradientAngle" (change)="updateCanvasBackground()" 
                   min="0" max="360" step="15"
                   style="width: 100%; height: 6px; border-radius: 3px; outline: none; appearance: none; -webkit-appearance: none; background: linear-gradient(90deg, #a855f7, #9333ea);">
          </div>
        </div>
        
        <!-- Image Panel -->
        <div *ngIf="canvasBackground.type === 'image'" style="padding: 0.75rem; background: #f8fafc; border-radius: 8px;">
          <button (click)="triggerBackgroundUpload()" *ngIf="!canvasBackground.imageUrl"
                  style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.75rem; font-weight: 600;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">cloud_upload</mat-icon>
            <span>Upload Image</span>
          </button>
          <input type="file" #backgroundUpload style="display: none" (change)="onBackgroundSelected($event)" accept="image/*">
          
          <div *ngIf="canvasBackground.imageUrl" style="margin-bottom: 0.625rem;">
            <div style="position: relative; border-radius: 6px; overflow: hidden; margin-bottom: 0.625rem;">
              <img [src]="canvasBackground.imageUrl" alt="Background" style="width: 100%; height: 100px; object-fit: cover;">
              <button (click)="removeBackgroundImage()"
                      style="position: absolute; top: 0.375rem; right: 0.375rem; background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 6px; padding: 0.25rem; cursor: pointer;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px;">delete</mat-icon>
              </button>
            </div>
            
            <div style="margin-bottom: 0.5rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Opacity</span>
                <span style="font-size: 0.7rem; color: #64748b;">{{canvasBackground.opacity || 1}}</span>
              </div>
              <input type="range" [(ngModel)]="canvasBackground.opacity" (change)="updateCanvasBackground()" 
                     min="0.1" max="1" step="0.1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Blur</span>
                <span style="font-size: 0.7rem; color: #64748b;">{{canvasBackground.blur || 0}}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasBackground.blur" (change)="updateCanvasBackground()" 
                     min="0" max="10" step="1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Media Library Section -->
      <div class="sidebar-section media-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">perm_media</mat-icon>
          </div>
          <span>Media Library</span>
          <span *ngIf="uploads.length > 0" style="margin-left: auto; font-size: 0.7rem; color: #64748b; font-weight: 500;">({{ uploads.length }})</span>
        </h3>
        
        <!-- Compact Upload Button -->
        <button (click)="triggerUpload()" 
                style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.75rem; font-weight: 600; margin-bottom: 0.875rem; transition: all 0.2s;">
          <mat-icon style="font-size: 18px; width: 18px; height: 18px;">cloud_upload</mat-icon>
          <div style="text-align: left;">
            <div>Upload Images</div>
            <div style="font-size: 0.65rem; font-weight: 400; opacity: 0.9;">PNG, JPG, SVG, GIF</div>
          </div>
        </button>
        <input type="file" #fileUpload style="display: none" (change)="onFileSelected($event)" accept="image/*">
        
        <!-- Media Grid (with uploads) -->
        <div *ngIf="uploads.length > 0" style="max-height: 320px; overflow-y: auto; margin-top: 0.625rem;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <div *ngFor="let upload of uploads" (click)="addElementToCanvas('image', upload)"
                 style="position: relative; border-radius: 8px; overflow: hidden; cursor: pointer; border: 1.5px solid #e2e8f0; transition: all 0.2s; background: #f8fafc;">
              <div style="position: relative; width: 100%; padding-bottom: 100%; overflow: hidden;">
                <img [src]="upload.url" [alt]="upload.name" 
                     style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                <div style="position: absolute; inset: 0; background: rgba(6, 182, 212, 0.85); opacity: 0; transition: opacity 0.2s; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="color: white; font-size: 28px; width: 28px; height: 28px;">add_circle</mat-icon>
                </div>
              </div>
              <div style="padding: 0.5rem; background: white;">
                <span [title]="upload.name" 
                      style="font-size: 0.7rem; color: #0f172a; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                  {{ upload.name }}
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Empty State (compact) -->
        <div *ngIf="uploads.length === 0" 
             style="text-align: center; padding: 2rem 1rem; background: #f8fafc; border-radius: 8px; border: 1.5px dashed #cbd5e1;">
          <mat-icon style="font-size: 40px; width: 40px; height: 40px; color: #94a3b8; margin-bottom: 0.5rem;">photo_library</mat-icon>
          <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 0.875rem;">No media uploaded yet</div>
          <button (click)="triggerUpload()" 
                  style="padding: 0.625rem 1rem; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">add</mat-icon>
            <span>Upload Your First Image</span>
          </button>
        </div>
      </div>
    </div>
    
    <div class="canvas-container" [ngClass]="{'mobile-active': activeMobilePanel === 'canvas'}">
      <!-- Compact Modern Toolbar -->
      <div style="background: white; border-bottom: 1px solid #e2e8f0; padding: 0.625rem 1.25rem; display: flex; align-items: center; justify-content: space-between; gap: 1.5rem; box-shadow: 0 1px 2px rgba(0,0,0,0.04);">
        
        <!-- Canvas Size Info -->
        <div style="display: flex; align-items: center; gap: 0.625rem;">
          <div style="background: #f1f5f9; padding: 0.375rem 0.75rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">photo_size_select_large</mat-icon>
            <span style="font-size: 0.75rem; font-weight: 600; color: #0f172a;">{{canvasWidth}} × {{canvasHeight}}</span>
          </div>
          <button (click)="openCustomSizeDialog()" title="Change Canvas Size"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">settings</mat-icon>
          </button>
        </div>
        
        <!-- Canvas Tools Group -->
        <div style="display: flex; align-items: center; gap: 0.375rem; background: #f8fafc; padding: 0.25rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <button [ngClass]="{'active': showGrid}" (click)="toggleGrid()" title="Toggle Grid"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">grid_4x4</mat-icon>
          </button>
          <button [ngClass]="{'active': snapToGrid}" (click)="toggleSnapToGrid()" title="Snap to Grid"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">grid_goldenratio</mat-icon>
          </button>
          <button [ngClass]="{'active': showAlignmentGuides}" (click)="toggleAlignmentGuides()" title="Alignment Guides"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">align_horizontal_center</mat-icon>
          </button>
          <button [ngClass]="{'active': showSmartGuides}" (click)="toggleSmartGuides()" title="Smart Guides"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">straighten</mat-icon>
          </button>
          <button [ngClass]="{'active': snapToGuides}" (click)="toggleSnapToGuides()" title="Snap to Guides"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">settings_ethernet</mat-icon>
          </button>
        </div>
        
        <!-- View Controls Group -->
        <div style="display: flex; align-items: center; gap: 0.375rem; background: #f8fafc; padding: 0.25rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <button (click)="fitToScreen()" title="Fit to Screen"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">fit_screen</mat-icon>
          </button>
          <button (click)="actualSize()" title="Actual Size (100%)"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">aspect_ratio</mat-icon>
          </button>
          <button (click)="centerCanvas()" title="Center Canvas"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">center_focus_strong</mat-icon>
          </button>
        </div>
        
        <!-- Zoom Controls Group -->
        <div style="display: flex; align-items: center; gap: 0.375rem; background: #f8fafc; padding: 0.25rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <button (click)="setZoom(25)" title="25%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">25%</button>
          <button (click)="setZoom(50)" title="50%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">50%</button>
          
          <div style="width: 1px; height: 20px; background: #e2e8f0; margin: 0 0.125rem;"></div>
          
          <button (click)="zoom(-10)" title="Zoom Out"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">zoom_out</mat-icon>
          </button>
          
          <div style="background: #6366f1; color: white; padding: 0.375rem 0.75rem; border-radius: 6px; min-width: 55px; text-align: center;">
            <span style="font-size: 0.75rem; font-weight: 600;">{{ zoomLevel }}%</span>
          </div>
          
          <button (click)="zoom(10)" title="Zoom In"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">zoom_in</mat-icon>
          </button>
          
          <div style="width: 1px; height: 20px; background: #e2e8f0; margin: 0 0.125rem;"></div>
          
          <button (click)="setZoom(100)" title="100%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">100%</button>
          <button (click)="setZoom(200)" title="200%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">200%</button>
        </div>
      </div>
      
      <div class="canvas-workspace" 
           [style.transform]="'scale(' + zoomLevel/100 + ') translate(' + panX + 'px, ' + panY + 'px)'" 
           [style.transform-origin]="'center center'"
           (drop)="onDrop($event)" 
           (dragover)="onDragOver($event)"
           (mousedown)="startPan($event)"
           (wheel)="onWheel($event)"
           (touchstart)="onTouchStart($event)"
           (touchmove)="onTouchMove($event)">
           
        <!-- Rulers -->
        <div class="rulers" *ngIf="showRulers">
          <div class="ruler horizontal-ruler"></div>
          <div class="ruler vertical-ruler"></div>
        </div>
        
        <div class="canvas" #canvas 
             [style.width.px]="canvasWidth" 
             [style.height.px]="canvasHeight" 
             [ngClass]="{'show-grid': showGrid}"
             [style.background]="getCanvasBackgroundStyle()"
             (drop)="onDrop($event)" 
             (dragover)="onDragOver($event)"
             (click)="onCanvasClick($event)">
             
          <!-- Grid overlay for snap-to-grid -->
          <div class="grid-overlay" *ngIf="showGrid"
               [style.background-size]="gridSize + 'px ' + gridSize + 'px'"></div>
          
          <!-- Alignment guides -->
          <div class="alignment-guides" *ngIf="showAlignmentGuides && selectedElement !== null">
            <div class="guide horizontal-center" *ngIf="showHorizontalCenterGuide"></div>
            <div class="guide vertical-center" *ngIf="showVerticalCenterGuide"></div>
            <div class="guide left-edge" *ngIf="showLeftEdgeGuide"></div>
            <div class="guide right-edge" *ngIf="showRightEdgeGuide"></div>
            <div class="guide top-edge" *ngIf="showTopEdgeGuide"></div>
            <div class="guide bottom-edge" *ngIf="showBottomEdgeGuide"></div>
          </div>
          
          <!-- Smart guides -->
          <div class="smart-guides" *ngIf="showSmartGuides && guideLines.length > 0">
            <div class="guide-line" 
                 *ngFor="let guide of guideLines" 
                 [ngClass]="{'horizontal': guide.y !== undefined, 'vertical': guide.x !== undefined}"
                 [style.left.px]="guide.x"
                 [style.top.px]="guide.y">
            </div>
          </div>
          <!-- Canvas elements will be rendered here -->
          <div *ngFor="let element of canvasElements; let i = index" 
               class="canvas-element" 
               [ngClass]="getElementClasses(i)" 
               [attr.data-selection-index]="selectedElements.length > 1 && selectedElements.includes(i) ? (selectedElements.indexOf(i) + 1) : null"
               [attr.data-element-index]="i"
               [style.left.px]="element.x" 
               [style.top.px]="element.y"
               [style.width.px]="element.width"
               [style.height.px]="element.height"
               [style.z-index]="i + 1"
               [style.transform]="getElementTransform(element)"
               [style.opacity]="element.hidden ? 0 : (element.opacity || 1)"
               [style.pointer-events]="element.locked ? 'none' : 'auto'"
               [style.mix-blend-mode]="element.blendMode || 'normal'"
               (mouseenter)="onElementMouseEnter(i)"
               (mouseleave)="onElementMouseLeave()"
               (mousedown)="selectElement(i, $event)">
            
            <!-- Text element -->
            <div *ngIf="element.type === 'text'" 
                 class="text-element" 
                 [style.fontSize.px]="element.fontSize"
                 [style.color]="getTextColor(element)"
                 [style.background]="getTextGradient(element)"
                 [style.webkitBackgroundClip]="element.textGradientType && element.textGradientType !== 'none' ? 'text' : 'unset'"
                 [style.webkitTextFillColor]="element.textGradientType && element.textGradientType !== 'none' ? 'transparent' : 'unset'"
                 [style.fontFamily]="element.fontFamily"
                 [style.fontWeight]="element.fontWeight"
                 [style.fontStyle]="element.fontStyle"
                 [style.textDecoration]="element.textDecoration"
                 [style.textAlign]="element.textAlign"
                 [style.backgroundColor]="getTextBackgroundColor(element)"
                 [style.padding.px]="element.padding"
                 [style.borderRadius.px]="element.borderRadius"
                 [style.lineHeight]="element.lineHeight"
                 [style.letterSpacing.px]="element.letterSpacing"
                 [style.textTransform]="element.textTransform"
                 [style.webkitTextStrokeWidth.px]="element.textStrokeWidth"
                 [style.webkitTextStrokeColor]="element.textStrokeColor"
                 [style.textShadow]="element.textShadow"
                 [style.transform]="getTextTransform(element)"
                 [style.opacity]="element.opacity || 1"
                 [contentEditable]="selectedElement === i"
                 (blur)="updateElementContent(i, $event)"
                 (focus)="selectedElement = i">
              {{ element.content }}
            </div>
            
            <!-- Image element -->
            <img *ngIf="element.type === 'image'" 
                 [src]="element.src" 
                 [alt]="element.alt || 'Image'" 
                 class="image-element"
                 [style.objectFit]="element.objectFit || 'contain'"
                 [style.objectPosition]="element.objectPosition || 'center'"
                 [style.borderRadius.px]="element.borderRadius"
                 [style.border]="element.border"
                 [style.boxShadow]="element.boxShadow"
                 [style.filter]="getImageFilter(element)"
                 [style.opacity]="element.opacity || 1"
                 [style.clipPath]="getImageMask(element)">
            
            <!-- Shape element -->
            <div *ngIf="element.type === 'shape'" 
                 class="shape-element"
                 [style.background]="getShapeBackground(element)"
                 [style.borderRadius.px]="getShapeBorderRadius(element)"
                 [style.clipPath]="getShapeClipPath(element)"
                 [style.boxShadow]="element.boxShadow"
                 [style.opacity]="element.opacity || 1"
                 [style.border]="element.border">
            </div>

            <!-- Line element -->
            <div *ngIf="element.type === 'line'" 
                 class="line-element"
                 [style.backgroundColor]="element.color"
                 [style.width.px]="element.width"
                 [style.height.px]="element.lineWidth || 2"
                 [style.opacity]="element.opacity || 1">
            </div>

            <!-- Icon element -->
            <div *ngIf="element.type === 'icon'" 
                 class="icon-element"
                 [style.backgroundImage]="'url(' + element.src + ')'"
                 [style.backgroundSize]="'contain'"
                 [style.backgroundRepeat]="'no-repeat'"
                 [style.backgroundPosition]="'center'"
                 [style.filter]="getIconFilter(element)"
                 [style.opacity]="element.opacity || 1">
            </div>
            
            <!-- Resize handles (only show for selected element) -->
            <div *ngIf="selectedElement === i" class="resize-handles">
              <div class="resize-handle top-left" (mousedown)="startResize(i, 'top-left', $event)"></div>
              <div class="resize-handle top-right" (mousedown)="startResize(i, 'top-right', $event)"></div>
              <div class="resize-handle bottom-left" (mousedown)="startResize(i, 'bottom-left', $event)"></div>
              <div class="resize-handle bottom-right" (mousedown)="startResize(i, 'bottom-right', $event)"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mobile Canvas Controls -->
      <div class="canvas-controls mobile-only">
        <div class="zoom-controls">
          <button class="zoom-btn" (click)="setZoom(50)" title="50%">50%</button>
          <button class="zoom-btn" (click)="setZoom(75)" title="75%">75%</button>
          <button class="zoom-btn" (click)="setZoom(100)" title="100%">100%</button>
          <button class="zoom-btn" (click)="fitToScreen()" title="Fit">
            <mat-icon>fit_screen</mat-icon>
          </button>
        </div>
      </div>
    </div>
    
    <div class="properties-panel" [ngClass]="{'mobile-active': activeMobilePanel === 'properties'}" 
         style="background: #f8fafc; border-left: 1px solid #e2e8f0; overflow-y: auto;">
      
      <!-- Layer Management Panel -->
      <div *ngIf="canvasElements.length > 0" style="background: white; border-radius: 10px; margin: 1rem; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.875rem;">
          <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px;">layers</mat-icon>
            </div>
            <span>Layers</span>
            <span style="font-size: 0.7rem; color: #64748b; font-weight: 500;">({{ canvasElements.length }})</span>
          </h3>
          
          <!-- Layer Actions (Compact) -->
          <div style="display: flex; gap: 0.25rem;">
            <button title="Isolate" (click)="isolateLayer()" [disabled]="selectedElement === null && selectedElements.length === 0"
                    style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">{{ isLayerIsolated ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <button title="Select All" (click)="selectAllElements()"
                    style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">checklist</mat-icon>
            </button>
            <button title="Group" (click)="groupSelectedElements()" [disabled]="selectedElements.length < 2"
                    style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">group_work</mat-icon>
            </button>
          </div>
        </div>
        
        <!-- Compact Search -->
        <div style="position: relative; margin-bottom: 0.75rem;">
          <mat-icon style="position: absolute; left: 0.625rem; top: 50%; transform: translateY(-50%); font-size: 16px; width: 16px; height: 16px; color: #94a3b8;">search</mat-icon>
          <input type="text" placeholder="Search layers..." [(ngModel)]="layerSearchQuery" (input)="filterLayers()"
                 style="width: 100%; padding: 0.5rem 0.5rem 0.5rem 2rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; outline: none;">
        </div>
        
        <!-- Compact Layers List -->
        <div style="max-height: 300px; overflow-y: auto;">
          <div *ngFor="let element of filteredCanvasElements; let i = index; trackBy: trackByElementId"
               [ngClass]="{'selected': selectedElement === i || selectedElements.includes(i), 'locked': element.locked, 'hidden': element.hidden, 'dragging': draggedLayerIndex === i}"
               [attr.draggable]="!element.locked"
               (dragstart)="onLayerDragStart($event, i)"
               (dragover)="onLayerDragOver($event, i)"
               (drop)="onLayerDrop($event, i)"
               (dragend)="onLayerDragEnd($event)"
               (click)="selectLayer(i, $event)"
               (dblclick)="startLayerRename(i)"
               style="display: flex; align-items: center; gap: 0.625rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.15s;">
            
            <!-- Layer Icon -->
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border-radius: 6px; padding: 0.375rem; display: flex; flex-shrink: 0;">
              <mat-icon *ngIf="element.type === 'text'" style="font-size: 16px; width: 16px; height: 16px;">text_fields</mat-icon>
              <mat-icon *ngIf="element.type === 'image'" style="font-size: 16px; width: 16px; height: 16px;">photo</mat-icon>
              <mat-icon *ngIf="element.type === 'shape'" style="font-size: 16px; width: 16px; height: 16px;">category</mat-icon>
              <mat-icon *ngIf="element.type === 'line'" style="font-size: 16px; width: 16px; height: 16px;">show_chart</mat-icon>
            </div>
            
            <!-- Layer Info -->
            <div style="flex: 1; min-width: 0;">
              <span *ngIf="!element.editing" style="font-size: 0.75rem; font-weight: 600; color: #0f172a; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                {{ element.layerName || getDefaultLayerName(element, i) }}
              </span>
              <input *ngIf="element.editing"
                     [(ngModel)]="element.layerName" 
                     (blur)="finishLayerRename(i)"
                     (keydown.enter)="finishLayerRename(i)"
                     (keydown.escape)="cancelLayerRename(i)"
                     style="width: 100%; padding: 0.25rem; border: 1px solid #6366f1; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
              <div style="display: flex; gap: 0.5rem; margin-top: 0.125rem;">
                <span style="font-size: 0.65rem; color: #64748b;">{{ element.type | titlecase }}</span>
                <span style="font-size: 0.65rem; color: #94a3b8;">{{ element.width }}×{{ element.height }}</span>
              </div>
            </div>
            
            <!-- Layer Controls -->
            <div style="display: flex; gap: 0.25rem; flex-shrink: 0;">
              <button [ngClass]="{'active': !element.hidden}" (click)="toggleLayerVisibility(i, $event)" title="Visibility"
                      style="background: transparent; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">{{ element.hidden ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <button [ngClass]="{'active': element.locked}" (click)="toggleLayerLock(i, $event)" title="Lock"
                      style="background: transparent; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">{{ element.locked ? 'lock' : 'lock_open' }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Element Properties (Compact Modern Design) -->
      <div *ngIf="selectedElement !== null" style="background: white; border-radius: 10px; margin: 0 1rem 1rem 1rem; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">tune</mat-icon>
          </div>
          <span>Properties</span>
        </h3>
        
        <!-- Quick Actions (Compact Grid) -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.875rem;">
          <button title="Bring Front" (click)="bringToFront()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">flip_to_front</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Front</span>
          </button>
          <button title="Forward" (click)="bringForward()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">arrow_upward</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Up</span>
          </button>
          <button title="Backward" (click)="sendBackward()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">arrow_downward</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Down</span>
          </button>
          <button title="Send Back" (click)="sendToBack()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">flip_to_back</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Back</span>
          </button>
          <button title="Duplicate" (click)="duplicateElement(selectedElement)"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #10b981;">content_copy</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Copy</span>
          </button>
          <button title="Reset" (click)="resetElementTransform()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">refresh</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Reset</span>
          </button>
          <button title="Delete" (click)="deleteElement(selectedElement)"
                  style="background: #fef2f2; border: 1px solid #fecaca; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s; grid-column: span 2;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #ef4444;">delete</mat-icon>
            <span style="font-size: 0.6rem; color: #ef4444;">Delete</span>
          </button>
        </div>
        
        <!-- Alignment Tools (Compact) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">align_horizontal_center</mat-icon>
            <span>Alignment</span>
          </h4>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.375rem;">
            <button (click)="alignElement('left')" title="Left"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_horizontal_left</mat-icon>
            </button>
            <button (click)="alignElement('center-horizontal')" title="Center H"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_horizontal_center</mat-icon>
            </button>
            <button (click)="alignElement('right')" title="Right"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_horizontal_right</mat-icon>
            </button>
            <button (click)="alignElement('top')" title="Top"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_vertical_top</mat-icon>
            </button>
            <button (click)="alignElement('center-vertical')" title="Center V"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_vertical_center</mat-icon>
            </button>
            <button (click)="alignElement('bottom')" title="Bottom"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_vertical_bottom</mat-icon>
            </button>
          </div>
          
          <div *ngIf="selectedElements.length > 2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem; margin-top: 0.5rem;">
            <button (click)="distributeElements('horizontal')" 
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">align_horizontal_left</mat-icon>
              Horizontal
            </button>
            <button (click)="distributeElements('vertical')" 
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">align_vertical_top</mat-icon>
              Vertical
            </button>
          </div>
        </div>
      
      <!-- Position & Size (Ultra Compact) -->
      <div style="background: #f8fafc; border-radius: 8px; padding: 0.625rem; margin-bottom: 0.875rem;">
        <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.5rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
          <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">photo_size_select_small</mat-icon>
          <span>Position & Size</span>
        </h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem;">
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">X</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].x" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">Y</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].y" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">W</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].width" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">H</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].height" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
        </div>
      </div>
      
      <!-- Text Properties (Compact Modern Design) -->
      <div *ngIf="canvasElements[selectedElement].type === 'text'" style="background: white; border-radius: 10px; margin: 0 1rem 1rem 1rem; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Text Content with AI Tools -->
        <div style="margin-bottom: 0.875rem;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.625rem;">
            <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">text_fields</mat-icon>
              <span>Text Content</span>
            </h4>
            <div style="display: flex; gap: 0.25rem;">
              <button (click)="openAIRewrite()" title="AI Rewrite"
                      style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #8b5cf6;">auto_fix_high</mat-icon>
              </button>
              <button (click)="openTranslateText()" title="Translate"
                      style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">translate</mat-icon>
              </button>
              <button (click)="startVoiceToText()" title="Voice"
                      style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #f43f5e;">mic</mat-icon>
              </button>
            </div>
          </div>
          <div style="position: relative;">
            <textarea [(ngModel)]="canvasElements[selectedElement].content" (change)="updateElement()" 
                      placeholder="Enter your text here..."
                      style="width: 100%; min-height: 100px; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.75rem; resize: vertical; outline: none; font-family: inherit;"></textarea>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
              <div style="display: flex; gap: 0.375rem;">
                <button (click)="checkAccessibility()" title="Accessibility"
                        style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
                  <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #64748b;">accessibility</mat-icon>
                </button>
                <button (click)="addHyperlink()" title="Add Link"
                        style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
                  <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #64748b;">link</mat-icon>
                </button>
              </div>
              <span style="font-size: 0.65rem; color: #94a3b8;">{{ (canvasElements[selectedElement].content || '').length }} chars</span>
            </div>
          </div>
        </div>

        <div style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; margin-bottom: 0.875rem;">
            <div style="border-radius: 6px; padding: 6px; display: inline-flex; background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-right: 0.5rem;">
              <mat-icon style="font-size: 16px; color: white;">font_download</mat-icon>
            </div>
            <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Font & Typography</span>
          </div>

          <div style="display: grid; grid-template-columns: 1fr; gap: 0.625rem; margin-bottom: 0.875rem;">
            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 0.75rem;">
              <div [ngStyle]="getCurrentFontStyle()" style="font-size: 0.875rem; margin-bottom: 0.5rem; color: #0f172a;">
                {{ canvasElements[selectedElement].fontFamily || 'Select Font' }}
              </div>
              <button (click)="openFontBrowser()"
                      style="width: 100%; padding: 0.5rem; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
                <mat-icon style="font-size: 14px; width: 14px; height: 14px;">library_books</mat-icon>
                Browse Fonts
              </button>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem; margin-bottom: 0.875rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Font Size</span>
              <div style="display: flex; align-items: center; gap: 0.375rem;">
                <button (click)="adjustFontSize(-2)"
                        style="padding: 0.375rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="font-size: 14px; color: #64748b;">remove</mat-icon>
                </button>
                <input type="number"
                       [(ngModel)]="canvasElements[selectedElement].fontSize"
                       (change)="updateElement()"
                       style="flex: 1; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem; text-align: center; background: white; outline: none;"
                       min="8" max="200">
                <button (click)="adjustFontSize(2)"
                        style="padding: 0.375rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="font-size: 14px; color: #64748b;">add</mat-icon>
                </button>
              </div>
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Style</span>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.25rem;">
                <button [class.active]="canvasElements[selectedElement].fontWeight === 'bold'" (click)="toggleTextStyle('fontWeight', 'bold')"
                        style="padding: 0.5rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="font-size: 14px; color: #64748b;">format_bold</mat-icon>
                </button>
                <button [class.active]="canvasElements[selectedElement].fontStyle === 'italic'" (click)="toggleTextStyle('fontStyle', 'italic')"
                        style="padding: 0.5rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="font-size: 14px; color: #64748b;">format_italic</mat-icon>
                </button>
                <button [class.active]="canvasElements[selectedElement].textDecoration === 'underline'" (click)="toggleTextStyle('textDecoration', 'underline')"
                        style="padding: 0.5rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="font-size: 14px; color: #64748b;">format_underlined</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
        </div>
        
        <!-- Color & Style (Compact Design) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">palette</mat-icon>
            <span>Color & Style</span>
          </h4>
          
          <!-- Compact Tabs -->
          <div style="display: flex; gap: 0.375rem; margin-bottom: 0.625rem; background: white; padding: 0.25rem; border-radius: 6px; border: 1px solid #e2e8f0;">
            <button [class.active]="activeColorTab === 'solid'" (click)="activeColorTab = 'solid'"
                    style="flex: 1; padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Solid
            </button>
            <button [class.active]="activeColorTab === 'gradient'" (click)="activeColorTab = 'gradient'"
                    style="flex: 1; padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Gradient
            </button>
          </div>
          
          <!-- Solid Color -->
          <div *ngIf="activeColorTab === 'solid'">
            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.625rem; margin-bottom: 0.625rem;">
              <input type="color" [(ngModel)]="canvasElements[selectedElement].color" (change)="updateElement()"
                     style="width: 100%; height: 40px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
            </div>
            <!-- Color Presets (Compact Grid) -->
            <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.375rem;">
              <div *ngFor="let color of colorPresets" 
                   [style.background-color]="color"
                   [class.selected]="canvasElements[selectedElement].color === color"
                   (click)="applyColor(color)"
                   style="aspect-ratio: 1; border-radius: 6px; cursor: pointer; border: 2px solid #e2e8f0; transition: all 0.15s;">
              </div>
            </div>
          </div>
          
          <!-- Gradient -->
          <div *ngIf="activeColorTab === 'gradient'">
            <select [(ngModel)]="canvasElements[selectedElement].textGradientType" (change)="updateTextGradient()"
                    style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; margin-bottom: 0.625rem; outline: none;">
              <option value="">No Gradient</option>
              <option value="linear">Linear Gradient</option>
              <option value="radial">Radial Gradient</option>
            </select>
            
            <div *ngIf="canvasElements[selectedElement].textGradientType" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.625rem;">
              <div>
                <label style="font-size: 0.65rem; color: #64748b; display: block; margin-bottom: 0.25rem;">Color 1</label>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].textGradientColor1" (change)="updateTextGradient()"
                       style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
              </div>
              <div>
                <label style="font-size: 0.65rem; color: #64748b; display: block; margin-bottom: 0.25rem;">Color 2</label>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].textGradientColor2" (change)="updateTextGradient()"
                       style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
              </div>
            </div>
            
            <div *ngIf="canvasElements[selectedElement].textGradientType === 'linear'">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Angle</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].textGradientAngle || 0 }}°</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].textGradientAngle" (change)="updateTextGradient()" 
                     min="0" max="360" step="15"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
          </div>
        </div>

        <!-- Alignment & Position (Compact Design) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">format_align_center</mat-icon>
            <span>Alignment & Position</span>
          </h4>
          
          <!-- Text Alignment (Compact 4-button) -->
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.625rem;">
            <button [class.active]="canvasElements[selectedElement].textAlign === 'left'" (click)="setTextStyle('textAlign', 'left')" title="Left"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_left</mat-icon>
            </button>
            <button [class.active]="canvasElements[selectedElement].textAlign === 'center'" (click)="setTextStyle('textAlign', 'center')" title="Center"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_center</mat-icon>
            </button>
            <button [class.active]="canvasElements[selectedElement].textAlign === 'right'" (click)="setTextStyle('textAlign', 'right')" title="Right"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_right</mat-icon>
            </button>
            <button [class.active]="canvasElements[selectedElement].textAlign === 'justify'" (click)="setTextStyle('textAlign', 'justify')" title="Justify"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_justify</mat-icon>
            </button>
          </div>
          
          <!-- Transform Controls (Compact) -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.5rem; display: flex; align-items: center; justify-content: space-between;">
              <button (click)="rotateText(-90)" title="Rotate Left"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">rotate_left</mat-icon>
              </button>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">{{ canvasElements[selectedElement].rotate || 0 }}°</span>
              <button (click)="rotateText(90)" title="Rotate Right"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">rotate_right</mat-icon>
              </button>
            </div>
            
            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
              <button (click)="flipText('horizontal')" title="Flip H"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">flip</mat-icon>
              </button>
              <button (click)="flipText('vertical')" title="Flip V"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b; transform: rotate(90deg);">flip</mat-icon>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Spacing & Typography (Compact Design) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">format_line_spacing</mat-icon>
            <span>Spacing & Typography</span>
          </h4>
          
          <div style="display: flex; flex-direction: column; gap: 0.625rem;">
            <!-- Letter Spacing -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Letter Spacing</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].letterSpacing || 0 }}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].letterSpacing" (change)="updateElement()" 
                     min="-5" max="20" step="0.1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
            
            <!-- Line Height -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Line Height</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].lineHeight || 1.2 }}</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].lineHeight" (change)="updateElement()" 
                     min="0.5" max="3" step="0.1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
            
            <!-- Word Spacing -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Word Spacing</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].wordSpacing || 0 }}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].wordSpacing" (change)="updateElement()" 
                     min="-10" max="50" step="1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
          </div>

          <!-- Smart Controls (Compact) -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem; margin-top: 0.625rem;">
            <button [class.active]="canvasElements[selectedElement].autoFit" (click)="toggleAutoFit()" title="Auto-fit"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">fit_screen</mat-icon>
              Auto-fit
            </button>
            <button [class.active]="canvasElements[selectedElement].textWrap" (click)="toggleTextWrap()" title="Wrap"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">wrap_text</mat-icon>
              Wrap
            </button>
          </div>
        </div>
        
        <!-- Text Effects (Compact Design) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">auto_fix_high</mat-icon>
            <span>Text Effects</span>
          </h4>
          
          <!-- Effect Presets (Compact Scrollable) -->
          <div style="display: flex; gap: 0.5rem; overflow-x: auto; margin-bottom: 0.625rem; padding-bottom: 0.5rem;">
            <button *ngFor="let preset of textEffectPresets" (click)="applyTextEffectPreset(preset)" [title]="preset.name"
                    style="flex-shrink: 0; background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; min-width: 60px;">
              <div [ngStyle]="getEffectPreviewStyle(preset)" style="font-size: 1.25rem; font-weight: 700;">Aa</div>
              <span style="font-size: 0.65rem; color: #64748b;">{{ preset.name }}</span>
            </button>
          </div>
          
          <!-- Effect Tabs (Compact 4-button) -->
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.625rem; background: white; padding: 0.25rem; border-radius: 6px; border: 1px solid #e2e8f0;">
            <button [class.active]="activeEffectTab === 'shadow'" (click)="activeEffectTab = 'shadow'"
                    style="padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.65rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Shadow
            </button>
            <button [class.active]="activeEffectTab === 'outline'" (click)="activeEffectTab = 'outline'"
                    style="padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.65rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Outline
            </button>
            <button [class.active]="activeEffectTab === 'highlight'" (click)="activeEffectTab = 'highlight'"
                    style="padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.65rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Highlight
            </button>
            <button [class.active]="activeEffectTab === 'curve'" (click)="activeEffectTab = 'curve'"
                    style="padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.65rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Curve
            </button>
          </div>
          
          <!-- Shadow Panel -->
          <div *ngIf="activeEffectTab === 'shadow'" style="background: white; border-radius: 6px; padding: 0.625rem;">
            <select [(ngModel)]="canvasElements[selectedElement].shadowType" (change)="updateTextShadow()"
                    style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; margin-bottom: 0.625rem; outline: none;">
              <option value="none">None</option>
              <option value="drop">Drop Shadow</option>
              <option value="inner">Inner Shadow</option>
              <option value="neon">Neon Glow</option>
              <option value="multiple">Multiple Shadows</option>
            </select>
            
            <div *ngIf="canvasElements[selectedElement].shadowType !== 'none'" style="display: flex; flex-direction: column; gap: 0.625rem;">
              <div>
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a; display: block; margin-bottom: 0.375rem;">Shadow Color</label>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].shadowColor" (change)="updateTextShadow()"
                       style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
              </div>
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                  <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Blur</label>
                  <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].shadowBlur || 0 }}px</span>
                </div>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowBlur" (change)="updateTextShadow()" 
                       min="0" max="50" step="1"
                       style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                <div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                    <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Offset X</label>
                    <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].shadowOffsetX || 0 }}</span>
                  </div>
                  <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowOffsetX" (change)="updateTextShadow()" 
                         min="-50" max="50" step="1"
                         style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
                </div>
                <div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                    <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Offset Y</label>
                    <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].shadowOffsetY || 0 }}</span>
                  </div>
                  <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowOffsetY" (change)="updateTextShadow()" 
                         min="-50" max="50" step="1"
                         style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Outline Panel -->
          <div *ngIf="activeEffectTab === 'outline'" style="background: white; border-radius: 6px; padding: 0.625rem; display: flex; flex-direction: column; gap: 0.625rem;">
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Outline Width</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].outlineWidth || 0 }}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].outlineWidth" (change)="updateTextOutline()" 
                     min="0" max="10" step="0.5"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
            <div>
              <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a; display: block; margin-bottom: 0.375rem;">Outline Color</label>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].outlineColor" (change)="updateTextOutline()"
                     style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
            </div>
          </div>
          
          <!-- Highlight Panel -->
          <div *ngIf="activeEffectTab === 'highlight'" style="background: white; border-radius: 6px; padding: 0.625rem; display: flex; flex-direction: column; gap: 0.625rem;">
            <div>
              <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a; display: block; margin-bottom: 0.375rem;">Background Color</label>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].backgroundColor" (change)="updateElement()"
                     style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
            </div>
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Padding</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].padding || 0 }}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].padding" (change)="updateElement()" 
                     min="0" max="50" step="1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Border Radius</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].borderRadius || 0 }}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" 
                     min="0" max="50" step="1"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
          </div>
          
          <!-- Curve Panel -->
          <div *ngIf="activeEffectTab === 'curve'" style="background: white; border-radius: 6px; padding: 0.625rem; display: flex; flex-direction: column; gap: 0.625rem;">
            <select [(ngModel)]="canvasElements[selectedElement].curveType" (change)="updateTextCurve()"
                    style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; outline: none;">
              <option value="none">None</option>
              <option value="arc">Arc</option>
              <option value="bridge">Bridge</option>
              <option value="bulge">Bulge</option>
              <option value="wave">Wave</option>
              <option value="circle">Circle</option>
            </select>
            
            <div *ngIf="canvasElements[selectedElement].curveType !== 'none'">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Curve Amount</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].curveAmount || 0 }}%</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].curveAmount" (change)="updateTextCurve()" 
                     min="-100" max="100" step="5"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
          </div>
        </div>
        <!-- Text Animations -->
        <div style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; margin-bottom: 0.875rem;">
            <div style="border-radius: 6px; padding: 6px; display: inline-flex; background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-right: 0.5rem;">
              <mat-icon style="font-size: 16px; color: white;">animation</mat-icon>
            </div>
            <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Text Animations</span>
          </div>

          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.875rem;">
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer;" *ngFor="let animation of textAnimations"
                    [style.background]="canvasElements[selectedElement].animation === animation.type ? '#10b981' : '#f8fafc'"
                    [style.color]="canvasElements[selectedElement].animation === animation.type ? 'white' : '#374151'"
                    [style.border-color]="canvasElements[selectedElement].animation === animation.type ? '#059669' : '#e2e8f0'"
                    (click)="applyTextAnimation(animation)" [title]="animation.name">
              <mat-icon style="font-size: 14px;">{{ animation.icon }}</mat-icon>
            </button>
          </div>

          <div *ngIf="canvasElements[selectedElement].animation" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem; margin-bottom: 0.875rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Duration</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].animationDuration"
                     (change)="updateAnimation()" min="0.1" max="5" step="0.1"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{ canvasElements[selectedElement].animationDuration || 1 }}s</span>
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Delay</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].animationDelay"
                     (change)="updateAnimation()" min="0" max="3" step="0.1"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{ canvasElements[selectedElement].animationDelay || 0 }}s</span>
            </div>
          </div>

          <div *ngIf="canvasElements[selectedElement].animation" style="display: grid; grid-template-columns: 1fr; gap: 0.625rem; margin-bottom: 0.875rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="checkbox" [(ngModel)]="canvasElements[selectedElement].animationLoop"
                     (change)="updateAnimation()" id="animation-loop"
                     style="width: 16px; height: 16px; accent-color: #10b981;">
              <label for="animation-loop" style="font-size: 0.8rem; font-weight: 500; color: #6b7280; cursor: pointer;">Loop Animation</label>
            </div>
          </div>

          <div *ngIf="canvasElements[selectedElement].animation" style="display: flex; justify-content: center;">
            <button (click)="previewAnimation()"
                    style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px;">play_arrow</mat-icon>
              Preview Animation
            </button>
          </div>
        </div>

        <div style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; margin-bottom: 0.875rem;">
            <div style="border-radius: 6px; padding: 6px; display: inline-flex; background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-right: 0.5rem;">
              <mat-icon style="font-size: 16px; color: white;">opacity</mat-icon>
            </div>
            <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Transparency & Masking</span>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr; gap: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" 
                     (change)="updateElement()" min="0" max="1" step="0.01"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{ getOpacityPercentage() }}%</span>
            </div>
          </div>
          
          <div style="margin-top: 0.875rem;">
            <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280; display: block; margin-bottom: 0.5rem;">Masking Options</span>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem;">
              <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;" 
                      [style.background]="canvasElements[selectedElement].maskEnabled ? '#10b981' : '#f8fafc'"
                      [style.color]="canvasElements[selectedElement].maskEnabled ? 'white' : '#374151'"
                      [style.border-color]="canvasElements[selectedElement].maskEnabled ? '#059669' : '#e2e8f0'"
                      (click)="enableTextMasking()" title="Use text as mask for images">
                <mat-icon style="font-size: 14px;">layers</mat-icon>
                <span>Text as Mask</span>
              </button>
              <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;" 
                      (click)="addTextToFrame()" title="Add text to image frame">
                <mat-icon style="font-size: 14px;">crop_free</mat-icon>
                <span>Text in Frame</span>
              </button>
            </div>
          </div>
        </div>

        <div style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; margin-bottom: 0.875rem;">
            <div style="border-radius: 6px; padding: 6px; display: inline-flex; background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-right: 0.5rem;">
              <mat-icon style="font-size: 16px; color: white;">branding_watermark</mat-icon>
            </div>
            <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Brand Kit & Accessibility</span>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem; margin-bottom: 0.875rem;">
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;" 
                    (click)="applyBrandFont()" title="Apply brand font">
              <mat-icon style="font-size: 14px;">business</mat-icon>
              <span>Brand Font</span>
            </button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;" 
                    (click)="saveToBrandKit()" title="Save to brand kit">
              <mat-icon style="font-size: 14px;">bookmark_add</mat-icon>
              <span>Save Style</span>
            </button>
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Accessibility Check</span>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem;" 
                    [style.background]="contrastRatio < 4.5 ? '#fef2f2' : '#f0fdf4'"
                    [style.border-color]="contrastRatio < 4.5 ? '#fca5a5' : '#86efac'"
                    (click)="checkContrastRatio()" title="Check contrast ratio">
              <mat-icon style="font-size: 14px;">accessibility</mat-icon>
              <span>Contrast: {{ contrastRatio ? contrastRatio.toFixed(1) : 'Check' }}</span>
            </button>
            <div *ngIf="contrastRatio" style="display: flex; align-items: center; justify-content: center; gap: 0.25rem;">
              <span style="font-size: 0.65rem; padding: 0.25rem 0.5rem; border-radius: 4px; background: #f0fdf4; color: #166534;" 
                    [style.background]="contrastRatio >= 4.5 ? '#f0fdf4' : '#fef2f2'"
                    [style.color]="contrastRatio >= 4.5 ? '#166534' : '#dc2626'">
                {{ contrastRatio >= 4.5 ? 'WCAG AA ✓' : 'WCAG AA ✗' }}
              </span>
            </div>
          </div>
        </div>

        <div style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; margin-bottom: 0.875rem;">
            <div style="border-radius: 6px; padding: 6px; display: inline-flex; background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-right: 0.5rem;">
              <mat-icon style="font-size: 16px; color: white;">animation</mat-icon>
            </div>
            <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Text Animations</span>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.875rem;">
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer;" 
                    [style.background]="activeTextEffectTab === 'stroke' ? '#10b981' : '#f8fafc'"
                    [style.color]="activeTextEffectTab === 'stroke' ? 'white' : '#374151'"
                    [style.border-color]="activeTextEffectTab === 'stroke' ? '#059669' : '#e2e8f0'"
                    (click)="activeTextEffectTab = 'stroke'">Stroke</button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer;" 
                    [style.background]="activeTextEffectTab === 'shadow' ? '#10b981' : '#f8fafc'"
                    [style.color]="activeTextEffectTab === 'shadow' ? 'white' : '#374151'"
                    [style.border-color]="activeTextEffectTab === 'shadow' ? '#059669' : '#e2e8f0'"
                    (click)="activeTextEffectTab = 'shadow'">Shadow</button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer;" 
                    [style.background]="activeTextEffectTab === 'gradient' ? '#10b981' : '#f8fafc'"
                    [style.color]="activeTextEffectTab === 'gradient' ? 'white' : '#374151'"
                    [style.border-color]="activeTextEffectTab === 'gradient' ? '#059669' : '#e2e8f0'"
                    (click)="activeTextEffectTab = 'gradient'">Gradient</button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer;" 
                    [style.background]="activeTextEffectTab === 'highlight' ? '#10b981' : '#f8fafc'"
                    [style.color]="activeTextEffectTab === 'highlight' ? 'white' : '#374151'"
                    [style.border-color]="activeTextEffectTab === 'highlight' ? '#059669' : '#e2e8f0'"
                    (click)="activeTextEffectTab = 'highlight'">Highlight</button>
          </div>
          
          <div *ngIf="activeTextEffectTab === 'stroke'" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Width</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].textStrokeWidth" 
                     (change)="updateElement()" min="0" max="5" step="0.5"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].textStrokeWidth || 0}}px</span>
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].textStrokeColor" (change)="updateElement()"
                     style="width: 100%; height: 32px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">
            </div>
          </div>
          
          <div *ngIf="activeTextEffectTab === 'shadow'" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Preset</span>
              <select [(ngModel)]="canvasElements[selectedElement].textShadow" (change)="updateElement()"
                      style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem; background: white;">
                <option value="none">None</option>
                <option value="1px 1px 2px rgba(0,0,0,0.3)">Light</option>
                <option value="2px 2px 4px rgba(0,0,0,0.4)">Medium</option>
                <option value="3px 3px 5px rgba(0,0,0,0.5)">Heavy</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div *ngIf="canvasElements[selectedElement].textShadow === 'custom'" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Shadow Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].customShadowColor" (change)="updateCustomTextShadow()"
                     style="width: 100%; height: 32px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">
            </div>
          </div>
          
          <div *ngIf="activeTextEffectTab === 'gradient'" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Type</span>
              <select [(ngModel)]="canvasElements[selectedElement].textGradientType" (change)="updateTextGradient()"
                      style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem; background: white;">
                <option value="none">None</option>
                <option value="linear">Linear</option>
                <option value="radial">Radial</option>
              </select>
            </div>
            <div *ngIf="canvasElements[selectedElement].textGradientType !== 'none'" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Angle</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].textGradientAngle" 
                     (change)="updateTextGradient()" min="0" max="360" step="15"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].textGradientAngle || 45}}°</span>
            </div>
          </div>
          
          <div *ngIf="activeTextEffectTab === 'gradient' && canvasElements[selectedElement].textGradientType !== 'none'" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem; margin-top: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Color 1</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].textGradientColor1" (change)="updateTextGradient()"
                     style="width: 100%; height: 32px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Color 2</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].textGradientColor2" (change)="updateTextGradient()"
                     style="width: 100%; height: 32px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">
            </div>
          </div>
          
          <div *ngIf="activeTextEffectTab === 'highlight'" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Style</span>
              <select [(ngModel)]="canvasElements[selectedElement].highlightStyle" (change)="updateElement()"
                      style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem; background: white;">
                <option value="none">None</option>
                <option value="solid">Solid</option>
                <option value="marker">Marker</option>
                <option value="underline">Underline</option>
                <option value="box">Box</option>
              </select>
            </div>
            <div *ngIf="canvasElements[selectedElement].highlightStyle !== 'none'" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].highlightColor" (change)="updateElement()"
                     style="width: 100%; height: 32px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">
            </div>
          </div>
          
          <div *ngIf="activeTextEffectTab === 'highlight' && canvasElements[selectedElement].highlightStyle !== 'none'" style="display: grid; grid-template-columns: 1fr; gap: 0.625rem; margin-top: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].highlightOpacity" 
                     (change)="updateElement()" min="0.1" max="1" step="0.1"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].highlightOpacity || 0.3}}</span>
            </div>
          </div>
          
          <div *ngIf="canvasElements[selectedElement].textShadow === 'custom' && activeTextEffectTab === 'shadow'" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.625rem; margin-top: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Blur</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].customShadowBlur" 
                     (change)="updateCustomTextShadow()" min="0" max="20" step="1"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].customShadowBlur || 0}}px</span>
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.625rem;">
              <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">X Offset</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].customShadowX" 
                       (change)="updateCustomTextShadow()" min="-20" max="20" step="1"
                       style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
                <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].customShadowX || 0}}px</span>
              </div>
              <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Y Offset</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].customShadowY" 
                       (change)="updateCustomTextShadow()" min="-20" max="20" step="1"
                       style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
                <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].customShadowY || 0}}px</span>
              </div>
            </div>
          </div>
        </div>
        
        <div style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; margin-bottom: 0.875rem;">
            <div style="border-radius: 6px; padding: 6px; display: inline-flex; background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-right: 0.5rem;">
              <mat-icon style="font-size: 16px; color: white;">transform</mat-icon>
            </div>
            <span style="font-size: 0.9rem; font-weight: 600; color: #374151;">Text Transform</span>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.875rem;">
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center;" 
                    (click)="rotateText(-90)" title="Rotate Left">
              <mat-icon style="font-size: 14px;">rotate_left</mat-icon>
            </button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center;" 
                    (click)="rotateText(90)" title="Rotate Right">
              <mat-icon style="font-size: 14px;">rotate_right</mat-icon>
            </button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center;" 
                    (click)="flipText('horizontal')" title="Flip Horizontal">
              <mat-icon style="font-size: 14px;">flip</mat-icon>
            </button>
            <button style="padding: 0.5rem; background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px; font-size: 0.7rem; font-weight: 500; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center;" 
                    (click)="flipText('vertical')" title="Flip Vertical">
              <mat-icon style="font-size: 14px; transform: rotate(90deg);">flip</mat-icon>
            </button>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.625rem; margin-bottom: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Rotation</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].textRotation" 
                     (change)="updateElement()" min="-180" max="180" step="5"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].textRotation || 0}}°</span>
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Text Path</span>
              <select [(ngModel)]="canvasElements[selectedElement].textPath" (change)="updateElement()"
                      style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.8rem; background: white;">
                <option value="none">None</option>
                <option value="arc">Arc</option>
                <option value="circle">Circle</option>
                <option value="wave">Wave</option>
              </select>
            </div>
          </div>
          
          <div *ngIf="canvasElements[selectedElement].textPath !== 'none'" style="display: grid; grid-template-columns: 1fr; gap: 0.625rem;">
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <span style="font-size: 0.8rem; font-weight: 500; color: #6b7280;">Path Strength</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].textPathStrength" 
                     (change)="updateElement()" min="0" max="100" step="5"
                     style="width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; outline: none;">
              <span style="font-size: 0.65rem; color: #9ca3af; text-align: center;">{{canvasElements[selectedElement].textPathStrength || 50}}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Image specific properties -->
      <div *ngIf="selectedElement !== null && canvasElements[selectedElement] && canvasElements[selectedElement].type === 'image'">
        <div class="property-group">
          <label>Image</label>
          <div class="image-preview">
            <img [src]="canvasElements[selectedElement].src" [alt]="canvasElements[selectedElement].alt || 'Image'">
          </div>
          <button class="replace-image-btn" (click)="triggerUpload()">
            <mat-icon>photo_library</mat-icon>
            <span>Replace Image</span>
          </button>
        </div>
        
        <div class="property-group">
          <label>Image Appearance</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Object Fit</span>
              <select [(ngModel)]="canvasElements[selectedElement].objectFit" (change)="updateElement()">
                <option value="contain">Contain</option>
                <option value="cover">Cover</option>
                <option value="fill">Fill</option>
                <option value="scale-down">Scale Down</option>
              </select>
            </div>
            <div class="property-control">
              <span>Border Radius</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" min="0" max="100">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Image Transform</label>
          <div class="image-transform-grid">
            <button class="image-edit-btn" (click)="cropImage()">
              <mat-icon>crop</mat-icon>
              <span>Crop</span>
            </button>
            <button class="image-edit-btn" (click)="scaleImage()">
              <mat-icon>transform</mat-icon>
              <span>Scale</span>
            </button>
            <button class="image-edit-btn" (click)="rotateImage(-90)">
              <mat-icon>rotate_left</mat-icon>
              <span>Rotate Left</span>
            </button>
            <button class="image-edit-btn" (click)="rotateImage(90)">
              <mat-icon>rotate_right</mat-icon>
              <span>Rotate Right</span>
            </button>
            <button class="image-edit-btn" (click)="flipImage('horizontal')">
              <mat-icon>flip</mat-icon>
              <span>Flip H</span>
            </button>
            <button class="image-edit-btn" (click)="flipImage('vertical')">
              <mat-icon>flip</mat-icon>
              <span>Flip V</span>
            </button>
          </div>
          
          <div class="aspect-ratio-controls">
            <label>
              <input type="checkbox" [(ngModel)]="canvasElements[selectedElement].lockAspectRatio" (change)="updateElement()">
              Lock Aspect Ratio
            </label>
          </div>
        </div>
        
        <div class="property-group">
          <label>Image Filters</label>
          <div class="filter-tabs">
            <button class="filter-tab" [ngClass]="{'active': activeImageFilterTab === 'basic'}" (click)="activeImageFilterTab = 'basic'">Basic</button>
            <button class="filter-tab" [ngClass]="{'active': activeImageFilterTab === 'advanced'}" (click)="activeImageFilterTab = 'advanced'">Advanced</button>
            <button class="filter-tab" [ngClass]="{'active': activeImageFilterTab === 'blend'}" (click)="activeImageFilterTab = 'blend'">Blend</button>
          </div>
          
          <!-- Basic Filters -->
          <div class="filter-content" *ngIf="activeImageFilterTab === 'basic'">
            <div class="filter-sliders">
              <div class="filter-control">
                <span>Brightness: {{canvasElements[selectedElement].brightness || 100}}%</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].brightness" 
                       (change)="updateImageFilters()" min="0" max="200" step="5" value="100">
              </div>
              <div class="filter-control">
                <span>Contrast: {{canvasElements[selectedElement].contrast || 100}}%</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].contrast" 
                       (change)="updateImageFilters()" min="0" max="200" step="5" value="100">
              </div>
              <div class="filter-control">
                <span>Saturation: {{canvasElements[selectedElement].saturation || 100}}%</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].saturation" 
                       (change)="updateImageFilters()" min="0" max="200" step="5" value="100">
              </div>
              <div class="filter-control">
                <span>Hue Rotate: {{canvasElements[selectedElement].hueRotate || 0}}°</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].hueRotate" 
                       (change)="updateImageFilters()" min="0" max="360" step="15" value="0">
              </div>
            </div>
          </div>
          
          <!-- Advanced Filters -->
          <div class="filter-content" *ngIf="activeImageFilterTab === 'advanced'">
            <div class="filter-sliders">
              <div class="filter-control">
                <span>Blur: {{canvasElements[selectedElement].blur || 0}}px</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].blur" 
                       (change)="updateImageFilters()" min="0" max="10" step="0.5" value="0">
              </div>
              <div class="filter-control">
                <span>Sepia: {{canvasElements[selectedElement].sepia || 0}}%</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].sepia" 
                       (change)="updateImageFilters()" min="0" max="100" step="5" value="0">
              </div>
              <div class="filter-control">
                <span>Grayscale: {{canvasElements[selectedElement].grayscale || 0}}%</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].grayscale" 
                       (change)="updateImageFilters()" min="0" max="100" step="5" value="0">
              </div>
              <div class="filter-control">
                <span>Invert: {{canvasElements[selectedElement].invert || 0}}%</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].invert" 
                       (change)="updateImageFilters()" min="0" max="100" step="5" value="0">
              </div>
            </div>
          </div>
          
          <!-- Blend Modes -->
          <div class="filter-content" *ngIf="activeImageFilterTab === 'blend'">
            <div class="blend-controls">
              <div class="property-control">
                <span>Blend Mode</span>
                <select [(ngModel)]="canvasElements[selectedElement].blendMode" (change)="updateElement()">
                  <option value="normal">Normal</option>
                  <option value="multiply">Multiply</option>
                  <option value="screen">Screen</option>
                  <option value="overlay">Overlay</option>
                  <option value="soft-light">Soft Light</option>
                  <option value="hard-light">Hard Light</option>
                  <option value="color-dodge">Color Dodge</option>
                  <option value="color-burn">Color Burn</option>
                  <option value="darken">Darken</option>
                  <option value="lighten">Lighten</option>
                  <option value="difference">Difference</option>
                  <option value="exclusion">Exclusion</option>
                  <option value="luminosity">Luminosity</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="filter-presets">
            <button class="preset-filter-btn" (click)="applyFilterPreset('none')">Reset</button>
            <button class="preset-filter-btn" (click)="applyFilterPreset('vintage')">Vintage</button>
            <button class="preset-filter-btn" (click)="applyFilterPreset('blackwhite')">B&W</button>
            <button class="preset-filter-btn" (click)="applyFilterPreset('warm')">Warm</button>
            <button class="preset-filter-btn" (click)="applyFilterPreset('cool')">Cool</button>
          </div>
        </div>
        
        <div class="property-group">
          <label>Image Masking</label>
          <div class="masking-controls">
            <div class="mask-options">
              <button class="mask-btn" [ngClass]="{'active': canvasElements[selectedElement].maskType === 'rectangle'}"
                      (click)="applyMask('rectangle')">
                <mat-icon>crop_square</mat-icon>
                <span>Rectangle</span>
              </button>
              <button class="mask-btn" [ngClass]="{'active': canvasElements[selectedElement].maskType === 'circle'}"
                      (click)="applyMask('circle')">
                <mat-icon>radio_button_unchecked</mat-icon>
                <span>Circle</span>
              </button>
              <button class="mask-btn" [ngClass]="{'active': canvasElements[selectedElement].maskType === 'custom'}"
                      (click)="applyMask('custom')">
                <mat-icon>gesture</mat-icon>
                <span>Custom</span>
              </button>
              <button class="mask-btn" (click)="removeMask()">
                <mat-icon>clear</mat-icon>
                <span>Remove</span>
              </button>
            </div>
            
            <div class="mask-properties" *ngIf="canvasElements[selectedElement].maskType">
              <div class="property-control">
                <span>Feather: {{canvasElements[selectedElement].maskFeather || 0}}px</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].maskFeather" 
                       (change)="updateElement()" min="0" max="20" step="1">
              </div>
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>PNG Transparency & Background Removal</label>
          <div class="transparency-controls">
            <button class="image-edit-btn" (click)="toggleBackgroundRemoval()" 
                    [ngClass]="{'active': isBackgroundRemovalActive()}">
              <mat-icon>content_cut</mat-icon>
              <span>Remove Background</span>
            </button>
            <button class="image-edit-btn" (click)="preserveTransparency()"
                    [ngClass]="{'active': canvasElements[selectedElement].preserveTransparency}">
              <mat-icon>transparency</mat-icon>
              <span>Preserve PNG Alpha</span>
            </button>
          </div>
        </div>
        
        <div class="property-group">
          <label>Effects</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" (change)="updateElement()" min="0.1" max="1" step="0.1">
              <span class="value-display">{{ canvasElements[selectedElement].opacity || 1 }}</span>
            </div>
            
            <div class="property-control">
              <span>Shadow</span>
              <select [(ngModel)]="canvasElements[selectedElement].boxShadow" (change)="updateElement()">
                <option value="none">None</option>
                <option value="0 2px 5px rgba(0,0,0,0.1)">Light</option>
                <option value="0 4px 8px rgba(0,0,0,0.2)">Medium</option>
                <option value="0 8px 16px rgba(0,0,0,0.3)">Strong</option>
              </select>
            </div>
            
            <div class="property-control">
              <span>Filter</span>
              <select [(ngModel)]="canvasElements[selectedElement].filter" (change)="updateElement()">
                <option value="none">None</option>
                <option value="grayscale(100%)">Grayscale</option>
                <option value="sepia(100%)">Sepia</option>
                <option value="blur(2px)">Blur</option>
                <option value="brightness(150%)">Brighten</option>
                <option value="contrast(150%)">Contrast</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Border</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Border Style</span>
              <select [(ngModel)]="canvasElements[selectedElement].border" (change)="updateElement()">
                <option value="none">None</option>
                <option value="1px solid #000">Thin</option>
                <option value="2px solid #000">Medium</option>
                <option value="3px solid #000">Thick</option>
                <option value="1px dashed #000">Dashed</option>
                <option value="1px dotted #000">Dotted</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Shape specific properties -->
      <div *ngIf="selectedElement !== null && canvasElements[selectedElement] && canvasElements[selectedElement].type === 'shape'">
        <div class="property-group">
          <label>Shape Type</label>
          <div class="shape-controls">
            <div class="shape-selector">
              <span>Type</span>
              <select [(ngModel)]="canvasElements[selectedElement].shape" (change)="updateElement()">
                <option value="rectangle">Rectangle</option>
                <option value="circle">Circle</option>
                <option value="triangle">Triangle</option>
                <option value="ellipse">Ellipse</option>
                <option value="diamond">Diamond</option>
                <option value="hexagon">Hexagon</option>
                <option value="star">Star</option>
                <option value="heart">Heart</option>
                <option value="arrow">Arrow</option>
              </select>
            </div>
            
            <div class="color-control">
              <span>Fill Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].color" (change)="updateElement()">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Gradient</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Gradient Type</span>
              <select [(ngModel)]="canvasElements[selectedElement].gradientType" (change)="updateGradient()">
                <option value="">No Gradient</option>
                <option value="linear">Linear</option>
                <option value="radial">Radial</option>
              </select>
            </div>
            
            <div class="property-control" *ngIf="canvasElements[selectedElement].gradientType">
              <span>First Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].gradientStop1" (change)="updateGradient()">
            </div>
            
            <div class="property-control" *ngIf="canvasElements[selectedElement].gradientType">
              <span>Second Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].gradientStop2" (change)="updateGradient()">
            </div>
            
            <div class="property-control" *ngIf="canvasElements[selectedElement].gradientType === 'linear'">
              <span>Angle (°)</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].gradientAngle" (change)="updateGradient()" min="0" max="360" step="15">
              <span class="value-display">{{ canvasElements[selectedElement].gradientAngle || 0 }}°</span>
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Shape Properties</label>
          <div class="property-controls">
            <div class="property-control" *ngIf="canvasElements[selectedElement].shape === 'rectangle'">
              <span>Border Radius</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" min="0" max="100">
            </div>
            
            <div class="property-control">
              <span>Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" (change)="updateElement()" min="0.1" max="1" step="0.1">
              <span class="value-display">{{ canvasElements[selectedElement].opacity || 1 }}</span>
            </div>
            
            <div class="property-control">
              <span>Rotation (°)</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].rotate" (change)="updateElement()" min="0" max="360">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Border & Effects</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Border</span>
              <select [(ngModel)]="canvasElements[selectedElement].border" (change)="updateElement()">
                <option value="none">None</option>
                <option value="1px solid #000">Thin</option>
                <option value="2px solid #000">Medium</option>
                <option value="3px solid #000">Thick</option>
                <option value="1px dashed #000">Dashed</option>
                <option value="1px dotted #000">Dotted</option>
              </select>
            </div>
            
            <div class="property-control">
              <span>Shadow</span>
              <select [(ngModel)]="canvasElements[selectedElement].boxShadow" (change)="updateElement()">
                <option value="none">None</option>
                <option value="0 2px 5px rgba(0,0,0,0.1)">Light</option>
                <option value="0 4px 8px rgba(0,0,0,0.2)">Medium</option>
                <option value="0 8px 16px rgba(0,0,0,0.3)">Strong</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            
            <div class="shadow-custom-controls" *ngIf="canvasElements[selectedElement].boxShadow === 'custom'">
              <div class="property-control">
                <span>Shadow Color</span>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].shadowColor" (change)="updateCustomShadow()">
              </div>
              <div class="property-control">
                <span>Blur</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowBlur" (change)="updateCustomShadow()" min="0" max="20" step="1">
                <span class="value-display">{{ canvasElements[selectedElement].shadowBlur || 0 }}px</span>
              </div>
              <div class="property-control">
                <span>Offset X</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowOffsetX" (change)="updateCustomShadow()" min="-20" max="20" step="1">
                <span class="value-display">{{ canvasElements[selectedElement].shadowOffsetX || 0 }}px</span>
              </div>
              <div class="property-control">
                <span>Offset Y</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowOffsetY" (change)="updateCustomShadow()" min="-20" max="20" step="1">
                <span class="value-display">{{ canvasElements[selectedElement].shadowOffsetY || 0 }}px</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Custom Size Dialog -->
  <div class="dialog-overlay" *ngIf="showCustomSizeDialog">
    <div class="dialog-container">
      <div class="dialog-header">
        <h3>Custom Canvas Size</h3>
        <button class="close-btn" (click)="closeCustomSizeDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="dialog-content">
        <div class="size-input-group">
          <div class="size-input">
            <label for="customWidth">Width (px)</label>
            <input type="number" id="customWidth" [(ngModel)]="customWidth" min="50" max="2000">
          </div>
          <div class="size-input">
            <label for="customHeight">Height (px)</label>
            <input type="number" id="customHeight" [(ngModel)]="customHeight" min="50" max="2000">
          </div>
        </div>
        <div class="preset-sizes">
          <h4>Preset Sizes</h4>
          <div class="preset-buttons">
            <button (click)="selectPresetSize('instagram')">Instagram Post</button>
            <button (click)="selectPresetSize('facebook')">Facebook Post</button>
            <button (click)="selectPresetSize('twitter')">Twitter Post</button>
            <button (click)="selectPresetSize('story')">Instagram Story</button>
            <button (click)="selectPresetSize('youtube')">YouTube Thumbnail</button>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="cancel-btn" (click)="closeCustomSizeDialog()">Cancel</button>
        <button class="apply-btn" (click)="applyCustomSize()">Apply</button>
      </div>
    </div>
  </div>
  
  <!-- Image Crop Dialog -->
  <div class="dialog-overlay" *ngIf="showCropDialog">
    <div class="dialog-container crop-dialog">
      <div class="dialog-header">
        <h3>Crop Image</h3>
        <button class="close-btn" (click)="closeCropDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="dialog-content">
        <div class="crop-container">
          <img #cropImage [src]="currentImageToCrop?.src" alt="Image to crop">
          <div class="crop-area" #cropArea
               [style.width.px]="cropWidth"
               [style.height.px]="cropHeight"
               [style.top.px]="cropTop"
               [style.left.px]="cropLeft"
               (mousedown)="startCropDrag($event)">
            <div class="resize-handle top-left" (mousedown)="startCropResize('top-left', $event)"></div>
            <div class="resize-handle top-right" (mousedown)="startCropResize('top-right', $event)"></div>
            <div class="resize-handle bottom-left" (mousedown)="startCropResize('bottom-left', $event)"></div>
            <div class="resize-handle bottom-right" (mousedown)="startCropResize('bottom-right', $event)"></div>
          </div>
        </div>
        <div class="crop-controls">
          <div class="crop-aspect-ratio">
            <span>Aspect Ratio:</span>
            <select [(ngModel)]="cropAspectRatio" (change)="applyCropAspectRatio()">
              <option value="free">🆓 Free Form</option>
              <option value="1:1">⬜ 1:1 (Square)</option>
              <option value="4:3">📺 4:3 (Standard)</option>
              <option value="16:9">📱 16:9 (Widescreen)</option>
              <option value="3:4">📄 3:4 (Portrait)</option>
              <option value="9:16">📱 9:16 (Mobile)</option>
            </select>
          </div>
          <div class="crop-dimensions">
            <span>Crop Size: {{cropWidth}} × {{cropHeight}} px</span>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="cancel-btn" (click)="closeCropDialog()">Cancel</button>
        <button class="apply-btn" (click)="applyCrop()">Apply</button>
      </div>
    </div>
  </div>
  
  <!-- Share Link Dialog -->
  <div class="dialog-overlay" *ngIf="showShareDialog">
    <div class="dialog-container share-dialog">
      <div class="dialog-header">
        <h3>Share Template</h3>
        <button class="close-btn" (click)="closeShareDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="dialog-content">
        <p>Share this link with others to let them view or edit this template:</p>
        <div class="share-link">
          <input type="text" [value]="shareLink" readonly #shareLinkInput>
          <button (click)="copyShareLink(shareLinkInput)">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
        <div class="share-permissions">
          <h4>Permissions</h4>
          <div class="permission-option">
            <input type="radio" id="view-only" name="permission" value="view" [(ngModel)]="sharePermission">
            <label for="view-only">View only</label>
          </div>
          <div class="permission-option">
            <input type="radio" id="can-edit" name="permission" value="edit" [(ngModel)]="sharePermission">
            <label for="can-edit">Can edit</label>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="cancel-btn" (click)="closeShareDialog()">Close</button>
        <button class="apply-btn" (click)="generateNewShareLink()">Generate New Link</button>
      </div>
    </div>
  </div>
</div>
