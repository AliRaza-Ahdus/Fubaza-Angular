<div class="template-editor-container">
  <!-- Mobile Navigation Buttons (Visible only on small screens) -->
  <div class="mobile-nav-buttons">
    <button [ngClass]="{'active': activeMobilePanel === 'sidebar'}" (click)="toggleMobilePanel('sidebar')">
      <mat-icon>dashboard</mat-icon>
      <span>Elements</span>
    </button>
    <button [ngClass]="{'active': activeMobilePanel === 'canvas'}" (click)="toggleMobilePanel('canvas')">
      <mat-icon>brush</mat-icon>
      <span>Canvas</span>
    </button>
    <button [ngClass]="{'active': activeMobilePanel === 'properties'}" (click)="toggleMobilePanel('properties')" [disabled]="selectedElement === null">
      <mat-icon>tune</mat-icon>
      <span>Properties</span>
    </button>
  </div>

  <div class="template-editor-header">
    <div class="header-left">
      <div class="app-logo">
        <mat-icon>design_services</mat-icon>
        <h2 class="template-editor-title">Template Studio</h2>
      </div>
      <div class="template-info">
        <input type="text" class="template-name-input" [(ngModel)]="template.name" placeholder="Untitled Template">
        <select class="template-type-select" [(ngModel)]="template.type">
          <option value="">Select type</option>
          <option *ngFor="let type of templateTypes" [value]="type.value">{{ type.label }}</option>
        </select>
      </div>
    </div>
    <div class="header-actions">
      <div class="history-controls">
        <button class="history-btn" [disabled]="!canUndo" (click)="undo()" title="Undo">
          <mat-icon>undo</mat-icon>
        </button>
        <button class="history-btn" [disabled]="!canRedo" (click)="redo()" title="Redo">
          <mat-icon>redo</mat-icon>
        </button>
      </div>
      <button class="preview-btn" title="Preview" (click)="previewTemplate()">
        <mat-icon>visibility</mat-icon>
      </button>
      <div class="export-btn-wrapper">
        <button class="export-btn" (click)="toggleExportOptions()">
          <mat-icon>download</mat-icon>
          <span>Export</span>
        </button>
        <div class="export-options" *ngIf="showExportOptions">
          <button (click)="exportTemplate('png', 'standard')">PNG (Standard)</button>
          <button (click)="exportTemplate('png', 'high')">PNG (High-Res)</button>
          <button (click)="exportTemplate('jpg', 'standard')">JPG (Standard)</button>
          <button (click)="exportTemplate('jpg', 'high')">JPG (High-Res)</button>
          <button (click)="exportTemplate('pdf', 'standard')">PDF</button>
          <button (click)="generateShareLink()">Share Link</button>
        </div>
      </div>
      <button class="save-btn" (click)="saveTemplateWithImageConversion()">
        <mat-icon>save</mat-icon>
        <span>Save</span>
      </button>
      <button class="exit-btn" (click)="cancelEdit()">Exit</button>
    </div>
  </div>
  
  <div class="template-editor-body">
    <div class="sidebar" [ngClass]="{'mobile-active': activeMobilePanel === 'sidebar'}"
         style="background: #f8fafc; padding: 1rem; overflow-y: auto;">
      
      <!-- ============================================ -->
      <!-- SECTION 1: TEXT - Add Different Text Styles -->
      <!-- ============================================ -->
      <div style="background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(99, 102, 241, 0.1);">
        <!-- Modern Header -->
        <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">text_fields</mat-icon>
          </div>
          <span>Text Elements</span>
        </h3>
        
        <!-- Improved 2-Column Grid -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
          <!-- Heading -->
          <div (click)="addTextElement('heading')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'heading'})" (dragend)="onDragEnd()"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center; position: relative; overflow: hidden;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(99, 102, 241, 0.15)'; this.style.borderColor='#6366f1';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">title</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Heading</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Large title text</div>
          </div>
          
          <!-- Subheading -->
          <div (click)="addTextElement('subheading')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'subheading'})" (dragend)="onDragEnd()"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(6, 182, 212, 0.15)'; this.style.borderColor='#06b6d4';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">subject</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Subheading</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Medium subtitle</div>
          </div>
          
          <!-- Body Text -->
          <div (click)="addTextElement('body')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'body'})" (dragend)="onDragEnd()"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(245, 158, 11, 0.15)'; this.style.borderColor='#f59e0b';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">article</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Body</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Paragraph text</div>
          </div>
          
          <!-- Caption -->
          <div (click)="addTextElement('caption')" draggable="true" 
               (dragstart)="onDragStart($event, 'text', {textType: 'caption'})" (dragend)="onDragEnd()"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(16, 185, 129, 0.15)'; this.style.borderColor='#10b981';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">short_text</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Caption</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Small caption</div>
          </div>
        </div>
      </div>

      <!-- Font Library Section -->
      <div style="background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(20, 184, 166, 0.1);">
        <!-- Modern Header -->
        <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">text_format</mat-icon>
          </div>
          <span>Font Library</span>
        </h3>
        
        <!-- Modern Search -->
        <div style="position: relative; margin-bottom: 0.875rem;">
          <mat-icon style="position: absolute; left: 0.875rem; top: 50%; transform: translateY(-50%); font-size: 18px; color: #94a3b8;">search</mat-icon>
          <input type="text" [(ngModel)]="fontSearchQuery" (input)="filterFonts()" placeholder="Search fonts..."
                 style="width: 100%; padding: 0.75rem 2.75rem 0.75rem 2.75rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.875rem; outline: none; transition: all 0.3s; background: #f8fafc;"
                 onfocus="this.style.borderColor='#14b8a6'; this.style.background='white';" 
                 onblur="this.style.borderColor='#e2e8f0'; this.style.background='#f8fafc';">
          <button *ngIf="fontSearchQuery" (click)="fontSearchQuery = ''; filterFonts()" 
                  style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: #f1f5f9; border: none; cursor: pointer; padding: 0.375rem; color: #64748b; border-radius: 6px; display: flex; align-items: center; transition: all 0.3s;"
                  onmouseover="this.style.background='#e2e8f0'; this.style.color='#0f172a';" 
                  onmouseout="this.style.background='#f1f5f9'; this.style.color='#64748b';">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">close</mat-icon>
          </button>
        </div>

        <!-- Modern Category Tabs -->
        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.875rem; overflow-x: auto; padding-bottom: 0.25rem;">
          <button (click)="setFontCategory('all')" [class.active]="activeFontCategory === 'all'"
                  style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.375rem; transition: all 0.3s; font-weight: 600;"
                  [style.background]="activeFontCategory === 'all' ? 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)' : '#f8fafc'"
                  [style.color]="activeFontCategory === 'all' ? 'white' : '#64748b'"
                  [style.border-color]="activeFontCategory === 'all' ? '#14b8a6' : '#e2e8f0'"
                  onmouseover="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#14b8a6'; }" 
                  onmouseout="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">apps</mat-icon>
            <span>All</span>
          </button>
          <button (click)="setFontCategory('sans-serif')" [class.active]="activeFontCategory === 'sans-serif'"
                  style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.375rem; transition: all 0.3s; font-weight: 600;"
                  [style.background]="activeFontCategory === 'sans-serif' ? 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)' : '#f8fafc'"
                  [style.color]="activeFontCategory === 'sans-serif' ? 'white' : '#64748b'"
                  [style.border-color]="activeFontCategory === 'sans-serif' ? '#14b8a6' : '#e2e8f0'"
                  onmouseover="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#14b8a6'; }" 
                  onmouseout="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">text_fields</mat-icon>
            <span>Sans</span>
          </button>
          <button (click)="setFontCategory('serif')" [class.active]="activeFontCategory === 'serif'"
                  style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.375rem; transition: all 0.3s; font-weight: 600;"
                  [style.background]="activeFontCategory === 'serif' ? 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)' : '#f8fafc'"
                  [style.color]="activeFontCategory === 'serif' ? 'white' : '#64748b'"
                  [style.border-color]="activeFontCategory === 'serif' ? '#14b8a6' : '#e2e8f0'"
                  onmouseover="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#14b8a6'; }" 
                  onmouseout="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">format_quote</mat-icon>
            <span>Serif</span>
          </button>
          <button (click)="setFontCategory('display')" [class.active]="activeFontCategory === 'display'"
                  style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.375rem; transition: all 0.3s; font-weight: 600;"
                  [style.background]="activeFontCategory === 'display' ? 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)' : '#f8fafc'"
                  [style.color]="activeFontCategory === 'display' ? 'white' : '#64748b'"
                  [style.border-color]="activeFontCategory === 'display' ? '#14b8a6' : '#e2e8f0'"
                  onmouseover="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#14b8a6'; }" 
                  onmouseout="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">star</mat-icon>
            <span>Display</span>
          </button>
          <button (click)="setFontCategory('handwriting')" [class.active]="activeFontCategory === 'handwriting'"
                  style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 0.375rem; transition: all 0.3s; font-weight: 600;"
                  [style.background]="activeFontCategory === 'handwriting' ? 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)' : '#f8fafc'"
                  [style.color]="activeFontCategory === 'handwriting' ? 'white' : '#64748b'"
                  [style.border-color]="activeFontCategory === 'handwriting' ? '#14b8a6' : '#e2e8f0'"
                  onmouseover="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#14b8a6'; }" 
                  onmouseout="if(this.style.background !== 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">draw</mat-icon>
            <span>Script</span>
          </button>
        </div>

        <!-- Modern Font List -->
        <div style="max-height: 320px; overflow-y: auto; margin-bottom: 1rem; padding-right: 0.25rem;">
          <div *ngFor="let font of filteredFonts; trackBy: trackByFont" 
               (click)="applyFont(font)"
               [class.selected]="isSelectedFont(font)"
               style="padding: 0.875rem; background: linear-gradient(135deg, #fefeff 0%, #f8fcfc 100%); border: 2px solid #e2e8f0; border-radius: 10px; margin-bottom: 0.625rem; cursor: pointer; transition: all 0.3s;"
               onmouseover="this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 12px rgba(20, 184, 166, 0.12)'; this.style.borderColor='#14b8a6';" 
               onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div [ngStyle]="getFontPreviewStyle(font)" style="font-size: 1rem; margin-bottom: 0.5rem; color: #0f172a; font-weight: 600;">
              {{ font.previewText || 'Aa Bb Cc 123' }}
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                <span style="font-size: 0.8rem; font-weight: 700; color: #0f172a;">{{ font.name }}</span>
                <span style="font-size: 0.7rem; padding: 0.25rem 0.5rem; background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%); color: #0369a1; border-radius: 6px; font-weight: 600;">{{ font.category }}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.375rem;">
                <mat-icon *ngIf="font.premium" style="font-size: 18px; width: 18px; height: 18px; color: #f59e0b;">workspace_premium</mat-icon>
                <mat-icon *ngIf="isSelectedFont(font)" style="font-size: 18px; width: 18px; height: 18px; color: #10b981;">check_circle</mat-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Modern Upload Button -->
        <button (click)="triggerFontUpload()" 
                style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.625rem; font-size: 0.875rem; font-weight: 700; transition: all 0.3s; box-shadow: 0 4px 12px rgba(20, 184, 166, 0.25);"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(20, 184, 166, 0.35)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(20, 184, 166, 0.25)';">
          <mat-icon style="font-size: 20px; width: 20px; height: 20px;">cloud_upload</mat-icon>
          <span>Upload Custom Font</span>
        </button>
        <input type="file" #fontUploadRef style="display: none" accept=".ttf,.otf,.woff,.woff2" (change)="onFontFileSelected($event)">
      </div>
      
      <!-- Media & Shapes Section -->
      <div style="background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(244, 63, 94, 0.1);">
        <!-- Modern Header -->
        <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3);">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">palette</mat-icon>
          </div>
          <span>Media & Elements</span>
        </h3>
        
        <!-- Improved 2x2 Grid -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
          <!-- Image -->
          <div draggable="true" (dragstart)="onDragStart($event, 'image')" (dragend)="onDragEnd()" (click)="triggerImageUpload()"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(99, 102, 241, 0.15)'; this.style.borderColor='#6366f1';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">add_photo_alternate</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Image</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Upload photo</div>
          </div>
          
          <!-- Shape -->
          <div draggable="true" (dragstart)="onDragStart($event, 'shape')" (dragend)="onDragEnd()" (click)="openShapeSelector()"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(6, 182, 212, 0.15)'; this.style.borderColor='#06b6d4';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">category</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Shape</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Add shapes</div>
          </div>
          
          <!-- Line -->
          <div draggable="true" (dragstart)="onDragStart($event, 'line')" (dragend)="onDragEnd()" (click)="addElementToCanvas('line')"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(245, 158, 11, 0.15)'; this.style.borderColor='#f59e0b';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">timeline</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Line</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Draw lines</div>
          </div>
          
          <!-- Icon -->
          <div draggable="true" (dragstart)="onDragStart($event, 'icon')" (dragend)="onDragEnd()" (click)="addElementToCanvas('icon')"
               style="padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(16, 185, 129, 0.15)'; this.style.borderColor='#10b981';" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 8px; padding: 8px; display: inline-flex; margin-bottom: 0.5rem; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">emoji_symbols</mat-icon>
            </div>
            <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Icon</div>
            <div style="font-size: 0.7rem; color: #64748b; font-weight: 500;">Add symbols</div>
          </div>
        </div>
        
        <!-- Modern Shape Selector Panel -->
        <div *ngIf="showShapeSelector" 
             style="margin-top: 0.875rem; background: white; border-radius: 10px; border: 2px solid #06b6d4; box-shadow: 0 4px 16px rgba(6, 182, 212, 0.15); overflow: hidden;">
          <!-- Header -->
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 2px solid #e2e8f0; background: linear-gradient(135deg, #f8fafc 0%, #f0fdfa 100%);">
            <div style="display: flex; align-items: center; gap: 0.625rem;">
              <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 8px; padding: 6px; display: flex; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.25);">
                <mat-icon style="font-size: 18px; width: 18px; height: 18px;">category</mat-icon>
              </div>
              <h3 style="font-size: 0.95rem; font-weight: 700; color: #0f172a; margin: 0;">Shape Library</h3>
            </div>
            <button (click)="closeShapeSelector()" 
                    style="background: #f1f5f9; border: none; border-radius: 8px; padding: 0.5rem; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.background='#e2e8f0'; this.style.transform='rotate(90deg)';" 
                    onmouseout="this.style.background='#f1f5f9'; this.style.transform='rotate(0deg)';">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">close</mat-icon>
            </button>
          </div>
          
          <!-- Search -->
          <div style="padding: 1rem;">
            <div style="position: relative;">
              <mat-icon style="position: absolute; left: 0.875rem; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 18px; width: 18px; height: 18px;">search</mat-icon>
              <input type="text" [(ngModel)]="shapeSearchQuery" (input)="filterShapes()" placeholder="Search shapes..."
                     style="width: 100%; padding: 0.75rem 2.75rem 0.75rem 2.75rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.875rem; background: #f8fafc; outline: none; transition: all 0.3s;"
                     onfocus="this.style.borderColor='#06b6d4'; this.style.background='white';" 
                     onblur="this.style.borderColor='#e2e8f0'; this.style.background='#f8fafc';">
              <button *ngIf="shapeSearchQuery" (click)="clearShapeSearch()" 
                      style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: #f1f5f9; border: none; cursor: pointer; padding: 0.375rem; border-radius: 6px; display: flex; transition: all 0.3s;"
                      onmouseover="this.style.background='#e2e8f0';" 
                      onmouseout="this.style.background='#f1f5f9';">
                <mat-icon style="font-size: 18px; color: #64748b;">clear</mat-icon>
              </button>
            </div>
          </div>
          
          <!-- Categories -->
          <div style="display: flex; gap: 0.5rem; padding: 0 1rem 1rem; overflow-x: auto;">
            <button (click)="setActiveCategory('all')" [class.active]="activeShapeCategory === 'all'"
                    style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; transition: all 0.3s; font-weight: 600;"
                    [style.background]="activeShapeCategory === 'all' ? 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)' : '#f8fafc'"
                    [style.color]="activeShapeCategory === 'all' ? 'white' : '#64748b'"
                    [style.border-color]="activeShapeCategory === 'all' ? '#06b6d4' : '#e2e8f0'"
                    onmouseover="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#06b6d4'; }" 
                    onmouseout="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
              All
            </button>
            <button (click)="setActiveCategory('basic')" [class.active]="activeShapeCategory === 'basic'"
                    style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; transition: all 0.3s; font-weight: 600;"
                    [style.background]="activeShapeCategory === 'basic' ? 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)' : '#f8fafc'"
                    [style.color]="activeShapeCategory === 'basic' ? 'white' : '#64748b'"
                    [style.border-color]="activeShapeCategory === 'basic' ? '#06b6d4' : '#e2e8f0'"
                    onmouseover="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#06b6d4'; }" 
                    onmouseout="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
              Basic
            </button>
            <button (click)="setActiveCategory('geometric')" [class.active]="activeShapeCategory === 'geometric'"
                    style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; transition: all 0.3s; font-weight: 600;"
                    [style.background]="activeShapeCategory === 'geometric' ? 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)' : '#f8fafc'"
                    [style.color]="activeShapeCategory === 'geometric' ? 'white' : '#64748b'"
                    [style.border-color]="activeShapeCategory === 'geometric' ? '#06b6d4' : '#e2e8f0'"
                    onmouseover="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#06b6d4'; }" 
                    onmouseout="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
              Geometric
            </button>
            <button (click)="setActiveCategory('lines')" [class.active]="activeShapeCategory === 'lines'"
                    style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; transition: all 0.3s; font-weight: 600;"
                    [style.background]="activeShapeCategory === 'lines' ? 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)' : '#f8fafc'"
                    [style.color]="activeShapeCategory === 'lines' ? 'white' : '#64748b'"
                    [style.border-color]="activeShapeCategory === 'lines' ? '#06b6d4' : '#e2e8f0'"
                    onmouseover="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#06b6d4'; }" 
                    onmouseout="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
              Lines
            </button>
            <button (click)="setActiveCategory('special')" [class.active]="activeShapeCategory === 'special'"
                    style="padding: 0.625rem 0.875rem; font-size: 0.75rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; white-space: nowrap; transition: all 0.3s; font-weight: 600;"
                    [style.background]="activeShapeCategory === 'special' ? 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)' : '#f8fafc'"
                    [style.color]="activeShapeCategory === 'special' ? 'white' : '#64748b'"
                    [style.border-color]="activeShapeCategory === 'special' ? '#06b6d4' : '#e2e8f0'"
                    onmouseover="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f1f5f9'; this.style.borderColor='#06b6d4'; }" 
                    onmouseout="if(this.style.background !== 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)') { this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0'; }">
              Special
            </button>
          </div>
          
          <!-- Shape Grid -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; padding: 0 1rem 1rem; max-height: 320px; overflow-y: auto;">
            <div *ngFor="let shape of filteredShapes; trackBy: trackByShape" 
                 (click)="addShapeToCanvas(shape.type)"
                 style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #f8fcfc 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.3s;"
                 onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(6, 182, 212, 0.15)'; this.style.borderColor='#06b6d4';" 
                 onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 28px; width: 28px; height: 28px; color: #06b6d4; margin-bottom: 0.375rem;">{{ shape.icon }}</mat-icon>
              <div style="font-size: 0.75rem; font-weight: 700; color: #0f172a;">{{ shape.name }}</div>
            </div>
            
            <!-- Empty State -->
            <div *ngIf="filteredShapes.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 2.5rem; color: #94a3b8;">
              <mat-icon style="font-size: 48px; width: 48px; height: 48px; opacity: 0.3; margin: 0 auto 0.5rem;">category</mat-icon>
              <div style="font-size: 0.875rem; font-weight: 600; margin-top: 0.625rem;">No shapes found</div>
              <div style="font-size: 0.75rem; margin-top: 0.25rem;">Try a different search or category</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Canvas Background Section -->
      <div style="background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(168, 85, 247, 0.1);">
        <!-- Modern Header -->
        <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">wallpaper</mat-icon>
          </div>
          <span>Canvas Background</span>
        </h3>
        
        <!-- Improved Type Selector -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.625rem; margin-bottom: 1rem;">
          <div (click)="setBackgroundType('color')" [class.active]="canvasBackground.type === 'color'"
               style="padding: 0.75rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               [style.border-color]="canvasBackground.type === 'color' ? '#a855f7' : '#e2e8f0'"
               [style.box-shadow]="canvasBackground.type === 'color' ? '0 4px 12px rgba(168, 85, 247, 0.2)' : 'none'"
               onmouseover="if(this.style.borderColor !== 'rgb(168, 85, 247)') { this.style.transform='translateY(-2px)'; this.style.borderColor='#a855f7'; }" 
               onmouseout="if(this.style.borderColor !== 'rgb(168, 85, 247)') { this.style.transform='translateY(0)'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px; margin-bottom: 0.375rem;"
                      [style.color]="canvasBackground.type === 'color' ? '#a855f7' : '#94a3b8'">palette</mat-icon>
            <div style="font-size: 0.75rem; font-weight: 700; color: #0f172a;">Color</div>
          </div>
          
          <div (click)="setBackgroundType('gradient')" [class.active]="canvasBackground.type === 'gradient'"
               style="padding: 0.75rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               [style.border-color]="canvasBackground.type === 'gradient' ? '#a855f7' : '#e2e8f0'"
               [style.box-shadow]="canvasBackground.type === 'gradient' ? '0 4px 12px rgba(168, 85, 247, 0.2)' : 'none'"
               onmouseover="if(this.style.borderColor !== 'rgb(168, 85, 247)') { this.style.transform='translateY(-2px)'; this.style.borderColor='#a855f7'; }" 
               onmouseout="if(this.style.borderColor !== 'rgb(168, 85, 247)') { this.style.transform='translateY(0)'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px; margin-bottom: 0.375rem;"
                      [style.color]="canvasBackground.type === 'gradient' ? '#a855f7' : '#94a3b8'">gradient</mat-icon>
            <div style="font-size: 0.75rem; font-weight: 700; color: #0f172a;">Gradient</div>
          </div>
          
          <div (click)="setBackgroundType('image')" [class.active]="canvasBackground.type === 'image'"
               style="padding: 0.75rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: center;"
               [style.border-color]="canvasBackground.type === 'image' ? '#a855f7' : '#e2e8f0'"
               [style.box-shadow]="canvasBackground.type === 'image' ? '0 4px 12px rgba(168, 85, 247, 0.2)' : 'none'"
               onmouseover="if(this.style.borderColor !== 'rgb(168, 85, 247)') { this.style.transform='translateY(-2px)'; this.style.borderColor='#a855f7'; }" 
               onmouseout="if(this.style.borderColor !== 'rgb(168, 85, 247)') { this.style.transform='translateY(0)'; this.style.borderColor='#e2e8f0'; }">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px; margin-bottom: 0.375rem;"
                      [style.color]="canvasBackground.type === 'image' ? '#a855f7' : '#94a3b8'">image</mat-icon>
            <div style="font-size: 0.75rem; font-weight: 700; color: #0f172a;">Image</div>
          </div>
        </div>
        
        <!-- Solid Color Panel -->
        <div *ngIf="canvasBackground.type === 'color'" style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #faf5ff 100%); border-radius: 10px; border: 2px solid #f3e8ff;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
            <span style="font-size: 0.875rem; font-weight: 700; color: #0f172a;">Background Color</span>
            <span style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: white; color: #a855f7; border-radius: 6px; font-weight: 600; border: 1px solid #e9d5ff;">{{ canvasBackground.color }}</span>
          </div>
          <input type="color" [(ngModel)]="canvasBackground.color" (change)="updateCanvasBackground()"
                 style="width: 100%; height: 48px; border: 3px solid #e9d5ff; border-radius: 10px; cursor: pointer; transition: all 0.3s;"
                 onmouseover="this.style.borderColor='#a855f7';" 
                 onmouseout="this.style.borderColor='#e9d5ff';">
        </div>
        
        <!-- Gradient Panel -->
        <div *ngIf="canvasBackground.type === 'gradient'" style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #faf5ff 100%); border-radius: 10px; border: 2px solid #f3e8ff;">
          <select [(ngModel)]="canvasBackground.gradientType" (change)="updateCanvasBackground()"
                  style="width: 100%; padding: 0.75rem; border: 2px solid #e9d5ff; border-radius: 10px; font-size: 0.875rem; margin-bottom: 0.875rem; outline: none; background: white; font-weight: 600; color: #0f172a; cursor: pointer; transition: all 0.3s;"
                  onfocus="this.style.borderColor='#a855f7';" 
                  onblur="this.style.borderColor='#e9d5ff';">
            <option value="linear">Linear Gradient</option>
            <option value="radial">Radial Gradient</option>
          </select>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.875rem;">
            <div>
              <div style="font-size: 0.8rem; font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">Color 1</div>
              <input type="color" [(ngModel)]="canvasBackground.gradientColor1" (change)="updateCanvasBackground()"
                     style="width: 100%; height: 44px; border: 3px solid #e9d5ff; border-radius: 10px; cursor: pointer; transition: all 0.3s;"
                     onmouseover="this.style.borderColor='#a855f7';" 
                     onmouseout="this.style.borderColor='#e9d5ff';">
            </div>
            <div>
              <div style="font-size: 0.8rem; font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">Color 2</div>
              <input type="color" [(ngModel)]="canvasBackground.gradientColor2" (change)="updateCanvasBackground()"
                     style="width: 100%; height: 44px; border: 3px solid #e9d5ff; border-radius: 10px; cursor: pointer; transition: all 0.3s;"
                     onmouseover="this.style.borderColor='#a855f7';" 
                     onmouseout="this.style.borderColor='#e9d5ff';">
            </div>
          </div>
          
          <div *ngIf="canvasBackground.gradientType === 'linear'">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.625rem;">
              <span style="font-size: 0.8rem; font-weight: 700; color: #0f172a;">Gradient Angle</span>
              <span style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: white; color: #a855f7; border-radius: 6px; font-weight: 700; border: 1px solid #e9d5ff;">{{canvasBackground.gradientAngle || 45}}Â°</span>
            </div>
            <input type="range" [(ngModel)]="canvasBackground.gradientAngle" (change)="updateCanvasBackground()" 
                   min="0" max="360" step="15"
                   style="width: 100%; height: 8px; border-radius: 10px; outline: none; appearance: none; -webkit-appearance: none; background: linear-gradient(90deg, #a855f7, #9333ea); cursor: pointer;">
          </div>
        </div>
        
        <!-- Image Panel -->
        <div *ngIf="canvasBackground.type === 'image'" style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #faf5ff 100%); border-radius: 10px; border: 2px solid #f3e8ff;">
          <button (click)="triggerBackgroundUpload()" *ngIf="!canvasBackground.imageUrl"
                  style="width: 100%; padding: 1rem; background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.625rem; font-size: 0.875rem; font-weight: 700; transition: all 0.3s; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.25);"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(168, 85, 247, 0.35)';" 
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.25)';">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px;">cloud_upload</mat-icon>
            <span>Upload Background Image</span>
          </button>
          <input type="file" #backgroundUpload style="display: none" (change)="onBackgroundSelected($event)" accept="image/*">
          
          <div *ngIf="canvasBackground.imageUrl">
            <div style="position: relative; border-radius: 10px; overflow: hidden; margin-bottom: 0.875rem; border: 3px solid #e9d5ff;">
              <img [src]="canvasBackground.imageUrl" alt="Background" style="width: 100%; height: 120px; object-fit: cover;">
              <button (click)="removeBackgroundImage()"
                      style="position: absolute; top: 0.625rem; right: 0.625rem; background: rgba(239, 68, 68, 0.9); color: white; border: none; border-radius: 8px; padding: 0.5rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);"
                      onmouseover="this.style.background='rgba(220, 38, 38, 1)'; this.style.transform='scale(1.1)';" 
                      onmouseout="this.style.background='rgba(239, 68, 68, 0.9)'; this.style.transform='scale(1)';">
                <mat-icon style="font-size: 18px; width: 18px; height: 18px;">delete</mat-icon>
              </button>
            </div>
            
            <div style="margin-bottom: 0.875rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.625rem;">
                <span style="font-size: 0.8rem; font-weight: 700; color: #0f172a;">Opacity</span>
                <span style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: white; color: #a855f7; border-radius: 6px; font-weight: 700; border: 1px solid #e9d5ff;">{{(canvasBackground.opacity || 1) * 100}}%</span>
              </div>
              <input type="range" [(ngModel)]="canvasBackground.opacity" (change)="updateCanvasBackground()" 
                     min="0.1" max="1" step="0.1"
                     style="width: 100%; height: 8px; border-radius: 10px; outline: none; cursor: pointer;">
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.625rem;">
                <span style="font-size: 0.8rem; font-weight: 700; color: #0f172a;">Blur Effect</span>
                <span style="font-size: 0.8rem; padding: 0.25rem 0.5rem; background: white; color: #a855f7; border-radius: 6px; font-weight: 700; border: 1px solid #e9d5ff;">{{canvasBackground.blur || 0}}px</span>
              </div>
              <input type="range" [(ngModel)]="canvasBackground.blur" (change)="updateCanvasBackground()" 
                     min="0" max="10" step="1"
                     style="width: 100%; height: 8px; border-radius: 10px; outline: none; cursor: pointer;">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Media Library Section -->
      <div class="sidebar-section media-section" style="background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.06);">
        <!-- Compact Header -->
        <h3 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 0.875rem 0; font-size: 0.9rem; font-weight: 600; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 6px; padding: 6px; display: flex;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">perm_media</mat-icon>
          </div>
          <span>Media Library</span>
          <span *ngIf="uploads.length > 0" style="margin-left: auto; font-size: 0.7rem; color: #64748b; font-weight: 500;">({{ uploads.length }})</span>
        </h3>
        
        <!-- Compact Upload Button -->
        <button (click)="triggerUpload()" 
                style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.75rem; font-weight: 600; margin-bottom: 0.875rem; transition: all 0.2s;">
          <mat-icon style="font-size: 18px; width: 18px; height: 18px;">cloud_upload</mat-icon>
          <div style="text-align: left;">
            <div>Upload Images</div>
            <div style="font-size: 0.65rem; font-weight: 400; opacity: 0.9;">PNG, JPG, SVG, GIF</div>
          </div>
        </button>
        <input type="file" #fileUpload style="display: none" (change)="onFileSelected($event)" accept="image/*">
        
        <!-- Media Grid (with uploads) -->
        <div *ngIf="uploads.length > 0" style="max-height: 320px; overflow-y: auto; margin-top: 0.625rem;">
          <div class="media-library-grid">
            <div *ngFor="let upload of uploads" (click)="addElementToCanvas('image', upload)"
                 style="position: relative; border-radius: 8px; overflow: hidden; cursor: pointer; border: 1.5px solid #e2e8f0; transition: all 0.2s; background: #f8fafc;">
              <div style="position: relative; width: 100%; padding-bottom: 100%; overflow: hidden;">
                <img [src]="upload.url" [alt]="upload.name" 
                     style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                <div style="position: absolute; inset: 0; background: rgba(6, 182, 212, 0.85); opacity: 0; transition: opacity 0.2s; display: flex; align-items: center; justify-content: center;">
                  <mat-icon style="color: white; font-size: 28px; width: 28px; height: 28px;">add_circle</mat-icon>
                </div>
              </div>
              <div style="padding: 0.5rem; background: white;">
                <span [title]="upload.name" 
                      style="font-size: 0.7rem; color: #0f172a; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                  {{ upload.name }}
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Empty State (compact) -->
        <div *ngIf="uploads.length === 0" 
             style="text-align: center; padding: 2rem 1rem; background: #f8fafc; border-radius: 8px; border: 1.5px dashed #cbd5e1;">
          <mat-icon style="font-size: 40px; width: 40px; height: 40px; color: #94a3b8; margin-bottom: 0.5rem;">photo_library</mat-icon>
          <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 0.875rem;">No media uploaded yet</div>
          <button (click)="triggerUpload()" 
                  style="padding: 0.625rem 1rem; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px;">add</mat-icon>
            <span>Upload Your First Image</span>
          </button>
        </div>
      </div>
    </div>
    
    <div class="canvas-container" [ngClass]="{'mobile-active': activeMobilePanel === 'canvas'}">
      <!-- Compact Modern Toolbar -->
      <div style="background: white; border-bottom: 1px solid #e2e8f0; padding: 0.625rem 1.25rem; display: flex; align-items: center; justify-content: space-between; gap: 1.5rem; box-shadow: 0 1px 2px rgba(0,0,0,0.04);">
        
        <!-- Canvas Size Info -->
        <div style="display: flex; align-items: center; gap: 0.625rem;">
          <div style="background: #f1f5f9; padding: 0.375rem 0.75rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">photo_size_select_large</mat-icon>
            <span style="font-size: 0.75rem; font-weight: 600; color: #0f172a;">{{canvasWidth}} Ã {{canvasHeight}}</span>
          </div>
          <button (click)="openCustomSizeDialog()" title="Change Canvas Size"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">settings</mat-icon>
          </button>
        </div>
        
        <!-- Canvas Tools Group -->
        <div style="display: flex; align-items: center; gap: 0.375rem; background: #f8fafc; padding: 0.25rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <button [ngClass]="{'active': showGrid}" (click)="toggleGrid()" title="Toggle Grid"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">grid_4x4</mat-icon>
          </button>
          <button [ngClass]="{'active': snapToGrid}" (click)="toggleSnapToGrid()" title="Snap to Grid"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">grid_goldenratio</mat-icon>
          </button>
          <button [ngClass]="{'active': showAlignmentGuides}" (click)="toggleAlignmentGuides()" title="Alignment Guides"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">align_horizontal_center</mat-icon>
          </button>
          <button [ngClass]="{'active': showSmartGuides}" (click)="toggleSmartGuides()" title="Smart Guides"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">straighten</mat-icon>
          </button>
          <button [ngClass]="{'active': snapToGuides}" (click)="toggleSnapToGuides()" title="Snap to Guides"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">settings_ethernet</mat-icon>
          </button>
        </div>
        
        <!-- View Controls Group -->
        <div style="display: flex; align-items: center; gap: 0.375rem; background: #f8fafc; padding: 0.25rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <button (click)="fitToScreen()" title="Fit to Screen"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">fit_screen</mat-icon>
          </button>
          <button (click)="actualSize()" title="Actual Size (100%)"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">aspect_ratio</mat-icon>
          </button>
          <button (click)="centerCanvas()" title="Center Canvas"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">center_focus_strong</mat-icon>
          </button>
        </div>
        
        <!-- Zoom Controls Group -->
        <div style="display: flex; align-items: center; gap: 0.375rem; background: #f8fafc; padding: 0.25rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <button (click)="setZoom(25)" title="25%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">25%</button>
          <button (click)="setZoom(50)" title="50%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">50%</button>
          
          <div style="width: 1px; height: 20px; background: #e2e8f0; margin: 0 0.125rem;"></div>
          
          <button (click)="zoom(-10)" title="Zoom Out"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">zoom_out</mat-icon>
          </button>
          
          <div style="background: #6366f1; color: white; padding: 0.375rem 0.75rem; border-radius: 6px; min-width: 55px; text-align: center;">
            <span style="font-size: 0.75rem; font-weight: 600;">{{ zoomLevel }}%</span>
          </div>
          
          <button (click)="zoom(10)" title="Zoom In"
                  style="background: transparent; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">zoom_in</mat-icon>
          </button>
          
          <div style="width: 1px; height: 20px; background: #e2e8f0; margin: 0 0.125rem;"></div>
          
          <button (click)="setZoom(100)" title="100%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">100%</button>
          <button (click)="setZoom(200)" title="200%"
                  style="background: transparent; border: none; padding: 0.375rem 0.625rem; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">200%</button>
        </div>
      </div>
      
      <div class="canvas-workspace" 
           [style.transform]="'scale(' + zoomLevel/100 + ') translate(' + panX + 'px, ' + panY + 'px)'" 
           [style.transform-origin]="'center center'"
           (drop)="onDrop($event)" 
           (dragover)="onDragOver($event)"
           (mousedown)="startPan($event)"
           (wheel)="onWheel($event)"
           (touchstart)="onTouchStart($event)"
           (touchmove)="onTouchMove($event)">
           
        <!-- Rulers -->
        <div class="rulers" *ngIf="showRulers">
          <div class="ruler horizontal-ruler"></div>
          <div class="ruler vertical-ruler"></div>
        </div>
        
        <!-- Professional Canvas Container -->
        <div class="canvas-professional-wrapper" 
             [style.width.px]="canvasWidth" 
             [style.height.px]="canvasHeight">
          
          <!-- Canvas Shadow/Frame -->
          <div class="canvas-frame" 
               [style.width.px]="canvasWidth" 
               [style.height.px]="canvasHeight">
            
            <!-- Canvas Main Area -->
            <div class="canvas" #canvas 
                 [style.width.px]="canvasWidth" 
                 [style.height.px]="canvasHeight" 
                 [ngClass]="{'show-grid': showGrid}"
                 [style.background]="getCanvasBackgroundStyle()"
                 (drop)="onDrop($event)" 
                 (dragover)="onDragOver($event)"
                 (click)="onCanvasClick($event)"
                 (dragenter)="onCanvasDragEnter($event)"
                 (dragleave)="onCanvasDragLeave($event)">
              
              <!-- Professional Drop Zone Overlay -->
              <div class="canvas-drop-zone" *ngIf="isDragOverCanvas"
                   style="position: absolute; inset: 0; background: rgba(99, 102, 241, 0.05); border: 3px dashed #6366f1; border-radius: 12px; pointer-events: none; z-index: 9999; display: flex; align-items: center; justify-content: center;">
                <div style="background: rgba(99, 102, 241, 0.95); color: white; padding: 2rem; border-radius: 16px; box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3); display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                  <mat-icon style="font-size: 64px; width: 64px; height: 64px;">add_circle_outline</mat-icon>
                  <div style="font-size: 1.25rem; font-weight: 600;">Drop element here</div>
                </div>
              </div>
              
              <!-- Canvas Background Pattern (when no background) -->
              <div class="canvas-background-pattern" *ngIf="!canvasBackground || canvasBackground.type === 'color' && !canvasBackground.color">
                <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e2e8f0" stroke-width="1" opacity="0.3"/>
                    </pattern>
                  </defs>
                  <rect width="100%" height="100%" fill="url(#grid)" />
                </svg>
              </div>
              
              <!-- Grid overlay for snap-to-grid -->
              <div class="grid-overlay" *ngIf="showGrid"
                   [style.background-size]="gridSize + 'px ' + gridSize + 'px'"></div>
              
              <!-- Alignment guides -->
              <div class="alignment-guides" *ngIf="showAlignmentGuides && selectedElement !== null">
                <div class="guide horizontal-center" *ngIf="showHorizontalCenterGuide"></div>
                <div class="guide vertical-center" *ngIf="showVerticalCenterGuide"></div>
                <div class="guide left-edge" *ngIf="showLeftEdgeGuide"></div>
                <div class="guide right-edge" *ngIf="showRightEdgeGuide"></div>
                <div class="guide top-edge" *ngIf="showTopEdgeGuide"></div>
                <div class="guide bottom-edge" *ngIf="showBottomEdgeGuide"></div>
              </div>
              
              <!-- Smart guides -->
              <div class="smart-guides" *ngIf="showSmartGuides && guideLines.length > 0">
                <div class="guide-line" 
                     *ngFor="let guide of guideLines" 
                     [ngClass]="{'horizontal': guide.y !== undefined, 'vertical': guide.x !== undefined}"
                     [style.left.px]="guide.x"
                     [style.top.px]="guide.y">
                </div>
              </div>
              
              <!-- Canvas elements will be rendered here -->
              <div *ngFor="let element of canvasElements; let i = index" 
                   class="canvas-element" 
                   [ngClass]="getElementClasses(i)" 
                   [attr.data-selection-index]="selectedElements.length > 1 && selectedElements.includes(i) ? (selectedElements.indexOf(i) + 1) : null"
                   [attr.data-element-index]="i"
                   [style.left.px]="element.x" 
                   [style.top.px]="element.y"
                   [style.width.px]="element.width"
                   [style.height.px]="element.height"
                   [style.z-index]="i + 1"
                   [style.transform]="getElementTransform(element)"
                   [style.opacity]="element.hidden ? 0 : (element.opacity || 1)"
                   [style.pointer-events]="element.locked ? 'none' : 'auto'"
                   [style.mix-blend-mode]="element.blendMode || 'normal'"
                   (mouseenter)="onElementMouseEnter(i)"
                   (mouseleave)="onElementMouseLeave()"
                   (mousedown)="selectElement(i, $event)">
                
                <!-- Text element -->
                <div *ngIf="element.type === 'text'" 
                     class="text-element" 
                     [style.fontSize.px]="element.fontSize"
                     [style.color]="getTextColor(element)"
                     [style.background]="getTextGradient(element)"
                     [style.webkitBackgroundClip]="element.textGradientType && element.textGradientType !== 'none' ? 'text' : 'unset'"
                     [style.webkitTextFillColor]="element.textGradientType && element.textGradientType !== 'none' ? 'transparent' : 'unset'"
                     [style.fontFamily]="element.fontFamily"
                     [style.fontWeight]="element.fontWeight"
                     [style.fontStyle]="element.fontStyle"
                     [style.textDecoration]="element.textDecoration"
                     [style.textAlign]="element.textAlign"
                     [style.backgroundColor]="getTextBackgroundColor(element)"
                     [style.padding.px]="element.padding"
                     [style.borderRadius.px]="element.borderRadius"
                     [style.lineHeight]="element.lineHeight"
                     [style.letterSpacing.px]="element.letterSpacing"
                     [style.textTransform]="element.textTransform"
                     [style.webkitTextStrokeWidth.px]="element.textStrokeWidth"
                     [style.webkitTextStrokeColor]="element.textStrokeColor"
                     [style.textShadow]="element.textShadow"
                     [style.transform]="getTextTransform(element)"
                     [style.opacity]="element.opacity || 1"
                     [contentEditable]="selectedElement === i"
                     (blur)="updateElementContent(i, $event)"
                     (focus)="selectedElement = i">
                  {{ element.content }}
                </div>
                
                <!-- Image element -->
                <img *ngIf="element.type === 'image'" 
                     [src]="element.src" 
                     [alt]="element.alt || 'Image'" 
                     class="image-element"
                     [style.objectFit]="element.objectFit || 'contain'"
                     [style.objectPosition]="element.objectPosition || 'center'"
                     [style.borderRadius.px]="element.borderRadius"
                     [style.border]="element.border"
                     [style.boxShadow]="element.boxShadow"
                     [style.filter]="getImageFilter(element)"
                     [style.opacity]="element.opacity || 1"
                     [style.clipPath]="getImageMask(element)">
                
                <!-- Shape element -->
                <div *ngIf="element.type === 'shape'" 
                     class="shape-element"
                     [style.background]="getShapeBackground(element)"
                     [style.borderRadius.px]="getShapeBorderRadius(element)"
                     [style.clipPath]="getShapeClipPath(element)"
                     [style.boxShadow]="element.boxShadow"
                     [style.opacity]="element.opacity || 1"
                     [style.border]="element.border">
                </div>

                <!-- Line element -->
                <div *ngIf="element.type === 'line'" 
                     class="line-element"
                     [style.backgroundColor]="element.color"
                     [style.width.px]="element.width"
                     [style.height.px]="element.lineWidth || 2"
                     [style.opacity]="element.opacity || 1">
                </div>

                <!-- Icon element -->
                <div *ngIf="element.type === 'icon'" 
                     class="icon-element"
                     [style.backgroundImage]="'url(' + element.src + ')'"
                     [style.backgroundSize]="'contain'"
                     [style.backgroundRepeat]="'no-repeat'"
                     [style.backgroundPosition]="'center'"
                     [style.filter]="getIconFilter(element)"
                     [style.opacity]="element.opacity || 1">
                </div>
                
                <!-- Resize handles (only show for selected element) -->
                <div *ngIf="selectedElement === i" class="resize-handles">
                  <div class="resize-handle top-left" (mousedown)="startResize(i, 'top-left', $event)"></div>
                  <div class="resize-handle top" (mousedown)="startResize(i, 'top', $event)"></div>
                  <div class="resize-handle top-right" (mousedown)="startResize(i, 'top-right', $event)"></div>
                  <div class="resize-handle right" (mousedown)="startResize(i, 'right', $event)"></div>
                  <div class="resize-handle bottom-right" (mousedown)="startResize(i, 'bottom-right', $event)"></div>
                  <div class="resize-handle bottom" (mousedown)="startResize(i, 'bottom', $event)"></div>
                  <div class="resize-handle bottom-left" (mousedown)="startResize(i, 'bottom-left', $event)"></div>
                  <div class="resize-handle left" (mousedown)="startResize(i, 'left', $event)"></div>
                </div>
                
                <!-- Resize Size Indicator (only show for selected element during resize) -->
                <div *ngIf="selectedElement === i && showResizeIndicators" 
                     class="resize-indicator"
                     [style.left.px]="resizeIndicatorPosition.x"
                     [style.top.px]="resizeIndicatorPosition.y">
                  <span class="resize-indicator-text">{{ currentResizeWidth }} Ã {{ currentResizeHeight }}</span>
                </div>
              </div>
            </div>
            
            <!-- Canvas Size Indicator -->
            <div class="canvas-size-indicator">
              <span class="canvas-size-text">{{canvasWidth}} Ã {{canvasHeight}}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mobile Canvas Controls -->
      <div class="canvas-controls mobile-only">
        <div class="zoom-controls">
          <button class="zoom-btn" (click)="setZoom(50)" title="50%">50%</button>
          <button class="zoom-btn" (click)="setZoom(75)" title="75%">75%</button>
          <button class="zoom-btn" (click)="setZoom(100)" title="100%">100%</button>
          <button class="zoom-btn" (click)="fitToScreen()" title="Fit">
            <mat-icon>fit_screen</mat-icon>
          </button>
        </div>
      </div>
    </div>
    
    <div class="properties-panel" [ngClass]="{'mobile-active': activeMobilePanel === 'properties'}" 
         style="background: linear-gradient(to bottom, #f8fafc 0%, #f1f5f9 100%); border-left: 1px solid #e2e8f0; overflow-y: auto;">
      
      <!-- Layer Management Panel -->
      <div *ngIf="canvasElements.length > 0" style="background: white; border-radius: 12px; margin: 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(139, 92, 246, 0.1);">
        <!-- Modern Header -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
          <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">layers</mat-icon>
            </div>
            <span>Layers</span>
            <span style="font-size: 0.75rem; color: #64748b; font-weight: 600; background: linear-gradient(135deg, #f3e8ff 0%, #ede9fe 100%); padding: 0.25rem 0.625rem; border-radius: 6px;">({{ canvasElements.length }})</span>
          </h3>
          
          <!-- Layer Actions (Compact) -->
          <div style="display: flex; gap: 0.25rem;">
            <button title="Isolate" (click)="isolateLayer()" [disabled]="selectedElement === null && selectedElements.length === 0"
                    style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">{{ isLayerIsolated ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <button title="Select All" (click)="selectAllElements()"
                    style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">checklist</mat-icon>
            </button>
            <button title="Group" (click)="groupSelectedElements()" [disabled]="selectedElements.length < 2"
                    style="background: #f1f5f9; border: none; padding: 0.375rem; border-radius: 6px; cursor: pointer; display: flex;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">group_work</mat-icon>
            </button>
          </div>
        </div>
        
        <!-- Compact Search -->
        <div style="position: relative; margin-bottom: 0.75rem;">
          <mat-icon style="position: absolute; left: 0.625rem; top: 50%; transform: translateY(-50%); font-size: 16px; width: 16px; height: 16px; color: #94a3b8;">search</mat-icon>
          <input type="text" placeholder="Search layers..." [(ngModel)]="layerSearchQuery" (input)="filterLayers()"
                 style="width: 100%; padding: 0.5rem 0.5rem 0.5rem 2rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; outline: none;">
        </div>
        
        <!-- Compact Layers List -->
        <div style="max-height: 300px; overflow-y: auto;">
          <div *ngFor="let element of filteredCanvasElements; let i = index; trackBy: trackByElementId"
               [ngClass]="{'selected': selectedElement === i || selectedElements.includes(i), 'locked': element.locked, 'hidden': element.hidden, 'dragging': draggedLayerIndex === i}"
               [attr.draggable]="!element.locked"
               (dragstart)="onLayerDragStart($event, i)"
               (dragover)="onLayerDragOver($event, i)"
               (drop)="onLayerDrop($event, i)"
               (dragend)="onLayerDragEnd($event)"
               (click)="selectLayer(i, $event)"
               (dblclick)="startLayerRename(i)"
               style="display: flex; align-items: center; gap: 0.625rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.15s;">
            
            <!-- Layer Icon -->
            <div style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border-radius: 6px; padding: 0.375rem; display: flex; flex-shrink: 0;">
              <mat-icon *ngIf="element.type === 'text'" style="font-size: 16px; width: 16px; height: 16px;">text_fields</mat-icon>
              <mat-icon *ngIf="element.type === 'image'" style="font-size: 16px; width: 16px; height: 16px;">photo</mat-icon>
              <mat-icon *ngIf="element.type === 'shape'" style="font-size: 16px; width: 16px; height: 16px;">category</mat-icon>
              <mat-icon *ngIf="element.type === 'line'" style="font-size: 16px; width: 16px; height: 16px;">show_chart</mat-icon>
            </div>
            
            <!-- Layer Info -->
            <div style="flex: 1; min-width: 0;">
              <span *ngIf="!element.editing" style="font-size: 0.75rem; font-weight: 600; color: #0f172a; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                {{ element.layerName || getDefaultLayerName(element, i) }}
              </span>
              <input *ngIf="element.editing"
                     [(ngModel)]="element.layerName" 
                     (blur)="finishLayerRename(i)"
                     (keydown.enter)="finishLayerRename(i)"
                     (keydown.escape)="cancelLayerRename(i)"
                     style="width: 100%; padding: 0.25rem; border: 1px solid #6366f1; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
              <div style="display: flex; gap: 0.5rem; margin-top: 0.125rem;">
                <span style="font-size: 0.65rem; color: #64748b;">{{ element.type | titlecase }}</span>
                <span style="font-size: 0.65rem; color: #94a3b8;">{{ element.width }}Ã{{ element.height }}</span>
              </div>
            </div>
            
            <!-- Layer Controls -->
            <div style="display: flex; gap: 0.25rem; flex-shrink: 0;">
              <button [ngClass]="{'active': !element.hidden}" (click)="toggleLayerVisibility(i, $event)" title="Visibility"
                      style="background: transparent; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">{{ element.hidden ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <button [ngClass]="{'active': element.locked}" (click)="toggleLayerLock(i, $event)" title="Lock"
                      style="background: transparent; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">{{ element.locked ? 'lock' : 'lock_open' }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Element Properties (Modern Design) -->
      <div *ngIf="selectedElement !== null" style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(16, 185, 129, 0.1);">
        <!-- Modern Header -->
        <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">tune</mat-icon>
          </div>
          <span>Properties</span>
        </h3>
        
        <!-- Quick Actions (Compact Grid) -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.875rem;">
          <button title="Bring Front" (click)="bringToFront()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">flip_to_front</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Front</span>
          </button>
          <button title="Forward" (click)="bringForward()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">arrow_upward</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Up</span>
          </button>
          <button title="Backward" (click)="sendBackward()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">arrow_downward</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Down</span>
          </button>
          <button title="Send Back" (click)="sendToBack()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">flip_to_back</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Back</span>
          </button>
          <button title="Duplicate" (click)="duplicateElement(selectedElement)"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #10b981;">content_copy</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Copy</span>
          </button>
          <button title="Reset" (click)="resetElementTransform()"
                  style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">refresh</mat-icon>
            <span style="font-size: 0.6rem; color: #94a3b8;">Reset</span>
          </button>
          <button title="Delete" (click)="deleteElement(selectedElement)"
                  style="background: #fef2f2; border: 1px solid #fecaca; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; transition: all 0.15s; grid-column: span 2;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #ef4444;">delete</mat-icon>
            <span style="font-size: 0.6rem; color: #ef4444;">Delete</span>
          </button>
        </div>
        
        <!-- Alignment Tools (Compact) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">align_horizontal_center</mat-icon>
            <span>Alignment</span>
          </h4>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.375rem;">
            <button (click)="alignElement('left')" title="Left"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_horizontal_left</mat-icon>
            </button>
            <button (click)="alignElement('center-horizontal')" title="Center H"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_horizontal_center</mat-icon>
            </button>
            <button (click)="alignElement('right')" title="Right"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_horizontal_right</mat-icon>
            </button>
            <button (click)="alignElement('top')" title="Top"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_vertical_top</mat-icon>
            </button>
            <button (click)="alignElement('center-vertical')" title="Center V"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_vertical_center</mat-icon>
            </button>
            <button (click)="alignElement('bottom')" title="Bottom"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">align_vertical_bottom</mat-icon>
            </button>
          </div>
          
          <div *ngIf="selectedElements.length > 2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem; margin-top: 0.5rem;">
            <button (click)="distributeElements('horizontal')" 
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">align_horizontal_left</mat-icon>
              Horizontal
            </button>
            <button (click)="distributeElements('vertical')" 
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.375rem; font-size: 0.7rem; font-weight: 600;">
              <mat-icon style="font-size: 14px; width: 14px; height: 14px;">align_vertical_top</mat-icon>
              Vertical
            </button>
          </div>
        </div>
      
      <!-- Position & Size (Ultra Compact) -->
      <div style="background: #f8fafc; border-radius: 8px; padding: 0.625rem; margin-bottom: 0.875rem;">
        <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.5rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
          <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">photo_size_select_small</mat-icon>
          <span>Position & Size</span>
        </h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.375rem;">
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">X</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].x" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">Y</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].y" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">W</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].width" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.375rem; display: flex; align-items: center; gap: 0.375rem;">
            <span style="font-size: 0.65rem; color: #64748b; font-weight: 600; min-width: 12px;">H</span>
            <input type="number" [(ngModel)]="canvasElements[selectedElement].height" (change)="updateElement()"
                   style="width: 100%; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; outline: none; padding: 0.125rem 0;">
          </div>
        </div>
      </div>
      
      <!-- Text Properties (Modern Design) -->
      <div *ngIf="canvasElements[selectedElement].type === 'text'" style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(99, 102, 241, 0.1);">
      <!-- Text Content -->
      <div style="background: linear-gradient(135deg, #fefeff 0%, #faf9ff 100%); border-radius: 10px; padding: 0.875rem; margin-bottom: 1rem; border: 1px solid #e9e5ff;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.625rem;">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0; font-size: 0.85rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #6366f1;">text_fields</mat-icon>
            <span>Text Content</span>
          </h4>
          <div style="display: flex; gap: 0.25rem;">
            <button (click)="openAIRewrite()" title="AI Rewrite"
                    style="background: #f1f5f9; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer;">
              <mat-icon style="font-size: 12px; width: 12px; height: 12px; color: #8b5cf6;">auto_fix_high</mat-icon>
            </button>
            <button (click)="openTranslateText()" title="Translate"
                    style="background: #f1f5f9; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer;">
              <mat-icon style="font-size: 12px; width: 12px; height: 12px; color: #6366f1;">translate</mat-icon>
            </button>
            <button (click)="startVoiceToText()" title="Voice"
                    style="background: #f1f5f9; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer;">
              <mat-icon style="font-size: 12px; width: 12px; height: 12px; color: #f43f5e;">mic</mat-icon>
            </button>
          </div>
        </div>
        <textarea [(ngModel)]="canvasElements[selectedElement].content" (change)="updateElement()"
                  placeholder="Enter your text here..."
                  style="width: 100%; min-height: 80px; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; resize: vertical; outline: none; font-family: inherit; margin-bottom: 0.375rem;"></textarea>
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; gap: 0.25rem;">
            <button (click)="checkAccessibility()" title="Accessibility"
                    style="background: #f1f5f9; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer;">
              <mat-icon style="font-size: 12px; width: 12px; height: 12px; color: #64748b;">accessibility</mat-icon>
            </button>
            <button (click)="addHyperlink()" title="Add Link"
                    style="background: #f1f5f9; border: none; padding: 0.25rem; border-radius: 4px; cursor: pointer;">
              <mat-icon style="font-size: 12px; width: 12px; height: 12px; color: #64748b;">link</mat-icon>
            </button>
          </div>
          <span style="font-size: 0.65rem; color: #94a3b8;">{{ (canvasElements[selectedElement].content || '').length }} chars</span>
        </div>
      </div>      <!-- Font & Typography (Ultra Compact) -->
      <div style="background: #f8fafc; border-radius: 8px; padding: 0.625rem; margin-bottom: 0.875rem;">
        <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.5rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
          <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #14b8a6;">font_download</mat-icon>
          <span>Font & Typography</span>
        </h4>

        <!-- Font Browser (Compact) -->
        <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.5rem; margin-bottom: 0.5rem;">
          <div [ngStyle]="getCurrentFontStyle()" style="font-size: 0.8rem; margin-bottom: 0.375rem; color: #0f172a; font-weight: 600;">
            {{ canvasElements[selectedElement].fontFamily || 'Select Font' }}
          </div>
          <button (click)="openFontBrowser()"
                  style="width: 100%; padding: 0.375rem; background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; border: none; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.25rem; font-size: 0.65rem; font-weight: 600;">
            <mat-icon style="font-size: 12px; width: 12px; height: 12px;">library_books</mat-icon>
            Browse Fonts
          </button>
        </div>

        <!-- Font Size & Style (Stacked Layout) -->
        <div style="display: flex; flex-direction: column; gap: 0.375rem;">
          <!-- Font Size -->
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.625rem; min-height: 80px; box-sizing: border-box;">
            <div style="font-size: 0.65rem; color: #64748b; font-weight: 600; margin-bottom: 0.5rem;">Size</div>
            <div style="display: flex; align-items: center; gap: 0.25rem;">
              <button (click)="adjustFontSize(-2)"
                      style="padding: 0.25rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; flex-shrink: 0;">
                <mat-icon style="font-size: 12px; color: #64748b;">remove</mat-icon>
              </button>
              <input type="number"
                     [(ngModel)]="canvasElements[selectedElement].fontSize"
                     (change)="updateElement()"
                     style="flex: 1; border: none; font-size: 0.7rem; font-weight: 600; color: #0f172a; text-align: center; outline: none; min-width: 0;"
                     min="8" max="200">
              <button (click)="adjustFontSize(2)"
                      style="padding: 0.25rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; flex-shrink: 0;">
                <mat-icon style="font-size: 12px; color: #64748b;">add</mat-icon>
              </button>
            </div>
          </div>

          <!-- Style Buttons -->
          <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.625rem; min-height: 80px; box-sizing: border-box;">
            <div style="font-size: 0.65rem; color: #64748b; font-weight: 600; margin-bottom: 0.5rem;">Style</div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.25rem;">
              <button [class.active]="canvasElements[selectedElement].fontWeight === 'bold'" (click)="toggleTextStyle('fontWeight', 'bold')"
                      style="padding: 0.375rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                <mat-icon style="font-size: 12px; color: #64748b;">format_bold</mat-icon>
              </button>
              <button [class.active]="canvasElements[selectedElement].fontStyle === 'italic'" (click)="toggleTextStyle('fontStyle', 'italic')"
                      style="padding: 0.375rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                <mat-icon style="font-size: 12px; color: #64748b;">format_italic</mat-icon>
              </button>
              <button [class.active]="canvasElements[selectedElement].textDecoration === 'underline'" (click)="toggleTextStyle('textDecoration', 'underline')"
                      style="padding: 0.375rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                <mat-icon style="font-size: 12px; color: #64748b;">format_underlined</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
        </div>
        
        <!-- Color & Style (Compact Design) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">palette</mat-icon>
            <span>Color & Style</span>
          </h4>
          
          <!-- Compact Tabs -->
          <div style="display: flex; gap: 0.375rem; margin-bottom: 0.625rem; background: white; padding: 0.25rem; border-radius: 6px; border: 1px solid #e2e8f0;">
            <button [class.active]="activeColorTab === 'solid'" (click)="activeColorTab = 'solid'"
                    style="flex: 1; padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Solid
            </button>
            <button [class.active]="activeColorTab === 'gradient'" (click)="activeColorTab = 'gradient'"
                    style="flex: 1; padding: 0.375rem; background: transparent; border: none; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 600; color: #64748b; transition: all 0.15s;">
              Gradient
            </button>
          </div>
          
          <!-- Solid Color -->
          <div *ngIf="activeColorTab === 'solid'">
            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.625rem; margin-bottom: 0.625rem;">
              <input type="color" [(ngModel)]="canvasElements[selectedElement].color" (change)="updateElement()"
                     style="width: 100%; height: 40px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
            </div>
            <!-- Color Presets (Compact Grid) -->
            <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.375rem;">
              <div *ngFor="let color of colorPresets" 
                   [style.background-color]="color"
                   [class.selected]="canvasElements[selectedElement].color === color"
                   (click)="applyColor(color)"
                   style="aspect-ratio: 1; border-radius: 6px; cursor: pointer; border: 2px solid #e2e8f0; transition: all 0.15s;">
              </div>
            </div>
          </div>
          
          <!-- Gradient -->
          <div *ngIf="activeColorTab === 'gradient'">
            <select [(ngModel)]="canvasElements[selectedElement].textGradientType" (change)="updateTextGradient()"
                    style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; margin-bottom: 0.625rem; outline: none;">
              <option value="">No Gradient</option>
              <option value="linear">Linear Gradient</option>
              <option value="radial">Radial Gradient</option>
            </select>
            
            <div *ngIf="canvasElements[selectedElement].textGradientType" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.625rem;">
              <div>
                <label style="font-size: 0.65rem; color: #64748b; display: block; margin-bottom: 0.25rem;">Color 1</label>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].textGradientColor1" (change)="updateTextGradient()"
                       style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
              </div>
              <div>
                <label style="font-size: 0.65rem; color: #64748b; display: block; margin-bottom: 0.25rem;">Color 2</label>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].textGradientColor2" (change)="updateTextGradient()"
                       style="width: 100%; height: 36px; border: 2px solid #e2e8f0; border-radius: 6px; cursor: pointer;">
              </div>
            </div>
            
            <div *ngIf="canvasElements[selectedElement].textGradientType === 'linear'">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.375rem;">
                <label style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Angle</label>
                <span style="font-size: 0.7rem; color: #64748b;">{{ canvasElements[selectedElement].textGradientAngle || 0 }}Â°</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].textGradientAngle" (change)="updateTextGradient()" 
                     min="0" max="360" step="15"
                     style="width: 100%; height: 6px; border-radius: 3px; outline: none;">
            </div>
          </div>
        </div>

        <!-- Alignment & Position (Compact Design) -->
        <div style="background: #f8fafc; border-radius: 8px; padding: 0.75rem; margin-bottom: 0.875rem;">
          <h4 style="display: flex; align-items: center; gap: 0.375rem; margin: 0 0 0.625rem 0; font-size: 0.75rem; font-weight: 600; color: #0f172a;">
            <mat-icon style="font-size: 14px; width: 14px; height: 14px; color: #6366f1;">format_align_center</mat-icon>
            <span>Alignment & Position</span>
          </h4>
          
          <!-- Text Alignment (Compact 4-button) -->
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.375rem; margin-bottom: 0.625rem;">
            <button [class.active]="canvasElements[selectedElement].textAlign === 'left'" (click)="setTextStyle('textAlign', 'left')" title="Left"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_left</mat-icon>
            </button>
            <button [class.active]="canvasElements[selectedElement].textAlign === 'center'" (click)="setTextStyle('textAlign', 'center')" title="Center"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_center</mat-icon>
            </button>
            <button [class.active]="canvasElements[selectedElement].textAlign === 'right'" (click)="setTextStyle('textAlign', 'right')" title="Right"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_right</mat-icon>
            </button>
            <button [class.active]="canvasElements[selectedElement].textAlign === 'justify'" (click)="setTextStyle('textAlign', 'justify')" title="Justify"
                    style="background: white; border: 1px solid #e2e8f0; padding: 0.5rem; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
              <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">format_align_justify</mat-icon>
            </button>
          </div>
          
          <!-- Transform Controls (Compact) -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.5rem; display: flex; align-items: center; justify-content: space-between;">
              <button (click)="rotateText(-90)" title="Rotate Left"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">rotate_left</mat-icon>
              </button>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">{{ canvasElements[selectedElement].rotate || 0 }}Â°</span>
              <button (click)="rotateText(90)" title="Rotate Right"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">rotate_right</mat-icon>
              </button>
            </div>
            
            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
              <button (click)="flipText('horizontal')" title="Flip H"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b;">flip</mat-icon>
              </button>
              <button (click)="flipText('vertical')" title="Flip V"
                      style="background: transparent; border: none; padding: 0.25rem; cursor: pointer; display: flex;">
                <mat-icon style="font-size: 16px; width: 16px; height: 16px; color: #64748b; transform: rotate(90deg);">flip</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Image specific properties -->
      <div *ngIf="selectedElement !== null && canvasElements[selectedElement] && canvasElements[selectedElement].type === 'image'">
        <!-- Image Preview & Replace -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(6, 182, 212, 0.1);">
          <h3 style="display: flex; align-items: center; gap: 0.625rem; margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 700; color: #0f172a;">
            <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 8px; padding: 8px; display: flex; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px;">image</mat-icon>
            </div>
            <span>Image</span>
          </h3>
          
          <div style="position: relative; width: 100%; aspect-ratio: 16/9; background: #f8fafc; border: 2px dashed #e2e8f0; border-radius: 8px; overflow: hidden; margin-bottom: 0.75rem;">
            <img [src]="canvasElements[selectedElement].src" [alt]="canvasElements[selectedElement].alt || 'Image'"
                 style="width: 100%; height: 100%; object-fit: contain;">
          </div>
          
          <button (click)="triggerUpload()"
                  style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 600; transition: all 0.2s;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px;">photo_library</mat-icon>
            <span>Replace Image</span>
          </button>
        </div>
        
        <!-- Image Appearance -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(6, 182, 212, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #06b6d4;">tune</mat-icon>
            <span>Appearance</span>
          </h4>
          
          <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            <div>
              <label style="font-size: 0.75rem; color: #64748b; display: block; margin-bottom: 0.375rem; font-weight: 600;">Object Fit</label>
              <select [(ngModel)]="canvasElements[selectedElement].objectFit" (change)="updateElement()"
                      style="width: 100%; padding: 0.625rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.8125rem; outline: none; background: #f8fafc;">
                <option value="contain">Contain</option>
                <option value="cover">Cover</option>
                <option value="fill">Fill</option>
                <option value="scale-down">Scale Down</option>
              </select>
            </div>
            
            <div>
              <label style="font-size: 0.75rem; color: #64748b; display: block; margin-bottom: 0.375rem; font-weight: 600;">Border Radius</label>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="range" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" 
                       min="0" max="100" step="1"
                       style="flex: 1; height: 6px; border-radius: 3px; outline: none;">
                <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" 
                       min="0" max="100"
                       style="width: 60px; padding: 0.375rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.8125rem; text-align: center; outline: none;">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Image Transform -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(245, 158, 11, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #f59e0b;">transform</mat-icon>
            <span>Transform</span>
          </h4>
          
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 0.75rem;">
            <button (click)="cropImage()" 
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#06b6d4';" 
                    onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #64748b;">crop</mat-icon>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Crop</span>
            </button>
            <button (click)="scaleImage()" 
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#06b6d4';" 
                    onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #64748b;">open_in_full</mat-icon>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Scale</span>
            </button>
            <button (click)="rotateImage(-90)" 
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#06b6d4';" 
                    onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #64748b;">rotate_left</mat-icon>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Rotate L</span>
            </button>
            <button (click)="rotateImage(90)" 
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#06b6d4';" 
                    onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #64748b;">rotate_right</mat-icon>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Rotate R</span>
            </button>
            <button (click)="flipImage('horizontal')" 
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#06b6d4';" 
                    onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #64748b;">flip</mat-icon>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Flip H</span>
            </button>
            <button (click)="flipImage('vertical')" 
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#06b6d4';" 
                    onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e2e8f0';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #64748b; transform: rotate(90deg);">flip</mat-icon>
              <span style="font-size: 0.7rem; font-weight: 600; color: #0f172a;">Flip V</span>
            </button>
          </div>
          
          <div style="display: flex; align-items: center; gap: 0.625rem; padding: 0.875rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; border-radius: 8px;">
            <input type="checkbox" [(ngModel)]="canvasElements[selectedElement].lockAspectRatio" (change)="updateElement()" 
                   id="aspectRatioLock"
                   style="width: 18px; height: 18px; cursor: pointer; accent-color: #06b6d4;">
            <label for="aspectRatioLock" style="font-size: 0.875rem; color: #0f172a; cursor: pointer; margin: 0; font-weight: 500;">
              Lock Aspect Ratio
            </label>
          </div>
        </div>
        
        <!-- Image Filters -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(139, 92, 246, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #8b5cf6;">photo_filter</mat-icon>
            <span>Filters</span>
          </h4>
          
          <div style="display: flex; gap: 0.375rem; margin-bottom: 1rem; background: #f8fafc; padding: 0.375rem; border-radius: 8px; border: 1px solid #e2e8f0;">
            <button (click)="activeImageFilterTab = 'basic'"
                    style="flex: 1; padding: 0.625rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; transition: all 0.2s;"
                    [style.background]="activeImageFilterTab === 'basic' ? 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)' : 'transparent'"
                    [style.color]="activeImageFilterTab === 'basic' ? 'white' : '#64748b'">
              Basic
            </button>
            <button (click)="activeImageFilterTab = 'advanced'"
                    style="flex: 1; padding: 0.625rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; transition: all 0.2s;"
                    [style.background]="activeImageFilterTab === 'advanced' ? 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)' : 'transparent'"
                    [style.color]="activeImageFilterTab === 'advanced' ? 'white' : '#64748b'">
              Advanced
            </button>
            <button (click)="activeImageFilterTab = 'blend'"
                    style="flex: 1; padding: 0.625rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; transition: all 0.2s;"
                    [style.background]="activeImageFilterTab === 'blend' ? 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)' : 'transparent'"
                    [style.color]="activeImageFilterTab === 'blend' ? 'white' : '#64748b'">
              Blend
            </button>
          </div>
          
          <!-- Basic Filters -->
          <div *ngIf="activeImageFilterTab === 'basic'" style="display: flex; flex-direction: column; gap: 1rem;">
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.8125rem; color: #64748b; font-weight: 500;">Brightness</span>
                <span style="font-size: 0.8125rem; font-weight: 600; color: #0f172a;">{{canvasElements[selectedElement].brightness || 100}}%</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].brightness" 
                     (change)="updateImageFilters()" min="0" max="200" step="5" value="100"
                     style="width: 100%; height: 8px; border-radius: 4px; outline: none; accent-color: #8b5cf6;">
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.8125rem; color: #64748b; font-weight: 500;">Contrast</span>
                <span style="font-size: 0.8125rem; font-weight: 600; color: #0f172a;">{{canvasElements[selectedElement].contrast || 100}}%</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].contrast" 
                     (change)="updateImageFilters()" min="0" max="200" step="5" value="100"
                     style="width: 100%; height: 8px; border-radius: 4px; outline: none; accent-color: #8b5cf6;">
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.8125rem; color: #64748b; font-weight: 500;">Saturation</span>
                <span style="font-size: 0.8125rem; font-weight: 600; color: #0f172a;">{{canvasElements[selectedElement].saturation || 100}}%</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].saturation" 
                     (change)="updateImageFilters()" min="0" max="200" step="5" value="100"
                     style="width: 100%; height: 8px; border-radius: 4px; outline: none; accent-color: #8b5cf6;">
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.8125rem; color: #64748b; font-weight: 500;">Hue Rotate</span>
                <span style="font-size: 0.8125rem; font-weight: 600; color: #0f172a;">{{canvasElements[selectedElement].hueRotate || 0}}Â°</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].hueRotate" 
                     (change)="updateImageFilters()" min="0" max="360" step="15" value="0"
                     style="width: 100%; height: 8px; border-radius: 4px; outline: none; accent-color: #8b5cf6;">
            </div>
            
            <div style="border-top: 1px solid #e2e8f0; padding-top: 0.75rem;">
              <label style="font-size: 0.75rem; color: #64748b; display: block; margin-bottom: 0.5rem; font-weight: 600;">Filter Presets</label>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                <button (click)="applyFilterPreset('none')" 
                        style="padding: 0.625rem; background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; color: #dc2626; transition: all 0.2s;">
                  Reset
                </button>
                <button (click)="applyFilterPreset('vintage')" 
                        style="padding: 0.625rem; background: #fef3c7; border: 1px solid #fde68a; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; color: #d97706; transition: all 0.2s;">
                  Vintage
                </button>
                <button (click)="applyFilterPreset('warm')" 
                        style="padding: 0.625rem; background: #ffedd5; border: 1px solid #fed7aa; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; color: #ea580c; transition: all 0.2s;">
                  Warm
                </button>
                <button (click)="applyFilterPreset('cool')" 
                        style="padding: 0.625rem; background: #dbeafe; border: 1px solid #bfdbfe; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; color: #2563eb; transition: all 0.2s;">
                  Cool
                </button>
              </div>
            </div>
          </div>
          
          <!-- Advanced Filters -->
          <div *ngIf="activeImageFilterTab === 'advanced'" style="text-align: center; padding: 2rem;">
            <mat-icon style="font-size: 48px; width: 48px; height: 48px; color: #cbd5e1; margin-bottom: 0.5rem;">auto_fix_high</mat-icon>
            <p style="font-size: 0.875rem; color: #64748b; margin: 0;">Advanced filters coming soon</p>
          </div>
          
          <!-- Blend Modes -->
          <div *ngIf="activeImageFilterTab === 'blend'">
            <label style="font-size: 0.75rem; color: #64748b; display: block; margin-bottom: 0.5rem; font-weight: 600;">Blend Mode</label>
            <select [(ngModel)]="canvasElements[selectedElement].blendMode" (change)="updateElement()"
                    style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.8125rem; outline: none; background: #f8fafc; font-weight: 500;">
              <option value="normal">Normal</option>
              <option value="multiply">Multiply</option>
              <option value="screen">Screen</option>
              <option value="overlay">Overlay</option>
              <option value="soft-light">Soft Light</option>
              <option value="hard-light">Hard Light</option>
              <option value="color-dodge">Color Dodge</option>
              <option value="color-burn">Color Burn</option>
              <option value="darken">Darken</option>
              <option value="lighten">Lighten</option>
              <option value="difference">Difference</option>
              <option value="exclusion">Exclusion</option>
              <option value="luminosity">Luminosity</option>
            </select>
          </div>
        </div>
        
        <!-- Image Masking -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(236, 72, 153, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #ec4899;">masks</mat-icon>
            <span>Masking</span>
          </h4>
          
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.625rem;">
            <button (click)="applyMask('rectangle')"
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.375rem; padding: 0.875rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; border: 2px solid;"
                    [style.background]="canvasElements[selectedElement].maskType === 'rectangle' ? 'linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%)' : '#f8fafc'"
                    [style.border-color]="canvasElements[selectedElement].maskType === 'rectangle' ? '#ec4899' : '#e2e8f0'">
              <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #ec4899;">crop_square</mat-icon>
              <span style="font-size: 0.75rem; font-weight: 600; color: #0f172a;">Rectangle</span>
            </button>
            <button (click)="applyMask('circle')"
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.375rem; padding: 0.875rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; border: 2px solid;"
                    [style.background]="canvasElements[selectedElement].maskType === 'circle' ? 'linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%)' : '#f8fafc'"
                    [style.border-color]="canvasElements[selectedElement].maskType === 'circle' ? '#ec4899' : '#e2e8f0'">
              <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #ec4899;">radio_button_unchecked</mat-icon>
              <span style="font-size: 0.75rem; font-weight: 600; color: #0f172a;">Circle</span>
            </button>
            <button (click)="applyMask('custom')"
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.375rem; padding: 0.875rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; border: 2px solid;"
                    [style.background]="canvasElements[selectedElement].maskType === 'custom' ? 'linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%)' : '#f8fafc'"
                    [style.border-color]="canvasElements[selectedElement].maskType === 'custom' ? '#ec4899' : '#e2e8f0'">
              <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #ec4899;">gesture</mat-icon>
              <span style="font-size: 0.75rem; font-weight: 600; color: #0f172a;">Custom</span>
            </button>
            <button (click)="removeMask()"
                    style="display: flex; flex-direction: column; align-items: center; gap: 0.375rem; padding: 0.875rem; background: #fef2f2; border: 2px solid #fecaca; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
              <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #dc2626;">clear</mat-icon>
              <span style="font-size: 0.75rem; font-weight: 600; color: #dc2626;">Remove</span>
            </button>
          </div>
        </div>
        
        <!-- Background Removal -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(16, 185, 129, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #10b981;">auto_fix_high</mat-icon>
            <span>Background</span>
          </h4>
          
          <button (click)="toggleBackgroundRemoval()"
                  style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.625rem; padding: 0.875rem; margin-bottom: 0.75rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all 0.2s; border: 2px solid;"
                  [style.background]="isBackgroundRemovalActive() ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : '#f8fafc'"
                  [style.border-color]="isBackgroundRemovalActive() ? '#10b981' : '#e2e8f0'"
                  [style.color]="isBackgroundRemovalActive() ? 'white' : '#0f172a'">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px;">content_cut</mat-icon>
            <span>Remove Background</span>
          </button>
          
          <div style="display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; border-radius: 8px;">
            <input type="checkbox" [(ngModel)]="canvasElements[selectedElement].preserveTransparency" (change)="preserveTransparency()"
                   id="preserveAlpha"
                   style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
            <label for="preserveAlpha" style="font-size: 0.875rem; color: #0f172a; cursor: pointer; margin: 0; font-weight: 500;">
              Preserve PNG Alpha Channel
            </label>
          </div>
        </div>
        
        <!-- Effects & Styling -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(245, 158, 11, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #f59e0b;">auto_awesome</mat-icon>
            <span>Effects</span>
          </h4>
          
          <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="font-size: 0.8125rem; color: #64748b; font-weight: 500;">Opacity</span>
                <span style="font-size: 0.8125rem; font-weight: 600; color: #0f172a;">{{ ((canvasElements[selectedElement].opacity || 1) * 100).toFixed(0) }}%</span>
              </div>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" (change)="updateElement()" min="0.1" max="1" step="0.1"
                     style="width: 100%; height: 8px; border-radius: 4px; outline: none; accent-color: #f59e0b;">
            </div>
            
            <div>
              <label style="font-size: 0.75rem; color: #64748b; display: block; margin-bottom: 0.5rem; font-weight: 600;">Shadow</label>
              <select [(ngModel)]="canvasElements[selectedElement].boxShadow" (change)="updateElement()"
                      style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.8125rem; outline: none; background: #f8fafc; font-weight: 500;">
                <option value="none">None</option>
                <option value="0 2px 5px rgba(0,0,0,0.1)">Light</option>
                <option value="0 4px 8px rgba(0,0,0,0.2)">Medium</option>
                <option value="0 8px 16px rgba(0,0,0,0.3)">Strong</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Border -->
        <div style="background: white; border-radius: 12px; margin: 0 1rem 1rem 1rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid rgba(59, 130, 246, 0.1);">
          <h4 style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1rem 0; font-size: 0.9rem; font-weight: 700; color: #0f172a;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #3b82f6;">border_style</mat-icon>
            <span>Border</span>
          </h4>
          
          <div>
            <label style="font-size: 0.75rem; color: #64748b; display: block; margin-bottom: 0.5rem; font-weight: 600;">Border Style</label>
            <select [(ngModel)]="canvasElements[selectedElement].border" (change)="updateElement()"
                    style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.8125rem; outline: none; background: #f8fafc; font-weight: 500;">
              <option value="none">None</option>
              <option value="1px solid #000">Thin Solid</option>
              <option value="2px solid #000">Medium Solid</option>
              <option value="3px solid #000">Thick Solid</option>
              <option value="1px dashed #000">Dashed</option>
              <option value="1px dotted #000">Dotted</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- Shape specific properties -->
      <div *ngIf="selectedElement !== null && canvasElements[selectedElement] && canvasElements[selectedElement].type === 'shape'">
        <div class="property-group">
          <label>Shape Type</label>
          <div class="shape-controls">
            <div class="shape-selector">
              <span>Type</span>
              <select [(ngModel)]="canvasElements[selectedElement].shape" (change)="updateElement()">
                <option value="rectangle">Rectangle</option>
                <option value="circle">Circle</option>
                <option value="triangle">Triangle</option>
                <option value="ellipse">Ellipse</option>
                <option value="diamond">Diamond</option>
                <option value="hexagon">Hexagon</option>
                <option value="star">Star</option>
                <option value="heart">Heart</option>
                <option value="arrow">Arrow</option>
              </select>
            </div>
            
            <div class="color-control">
              <span>Fill Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].color" (change)="updateElement()">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Gradient</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Gradient Type</span>
              <select [(ngModel)]="canvasElements[selectedElement].gradientType" (change)="updateGradient()">
                <option value="">No Gradient</option>
                <option value="linear">Linear</option>
                <option value="radial">Radial</option>
              </select>
            </div>
            
            <div class="property-control" *ngIf="canvasElements[selectedElement].gradientType">
              <span>First Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].gradientStop1" (change)="updateGradient()">
            </div>
            
            <div class="property-control" *ngIf="canvasElements[selectedElement].gradientType">
              <span>Second Color</span>
              <input type="color" [(ngModel)]="canvasElements[selectedElement].gradientStop2" (change)="updateGradient()">
            </div>
            
            <div class="property-control" *ngIf="canvasElements[selectedElement].gradientType === 'linear'">
              <span>Angle (Â°)</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].gradientAngle" (change)="updateGradient()" min="0" max="360" step="15">
              <span class="value-display">{{ canvasElements[selectedElement].gradientAngle || 0 }}Â°</span>
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Shape Properties</label>
          <div class="property-controls">
            <div class="property-control" *ngIf="canvasElements[selectedElement].shape === 'rectangle'">
              <span>Border Radius</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].borderRadius" (change)="updateElement()" min="0" max="100">
            </div>
            
            <div class="property-control">
              <span>Opacity</span>
              <input type="range" [(ngModel)]="canvasElements[selectedElement].opacity" (change)="updateElement()" min="0.1" max="1" step="0.1">
              <span class="value-display">{{ canvasElements[selectedElement].opacity || 1 }}</span>
            </div>
            
            <div class="property-control">
              <span>Rotation (Â°)</span>
              <input type="number" [(ngModel)]="canvasElements[selectedElement].rotate" (change)="updateElement()" min="0" max="360">
            </div>
          </div>
        </div>
        
        <div class="property-group">
          <label>Border & Effects</label>
          <div class="property-controls">
            <div class="property-control">
              <span>Border</span>
              <select [(ngModel)]="canvasElements[selectedElement].border" (change)="updateElement()">
                <option value="none">None</option>
                <option value="1px solid #000">Thin</option>
                <option value="2px solid #000">Medium</option>
                <option value="3px solid #000">Thick</option>
                <option value="1px dashed #000">Dashed</option>
                <option value="1px dotted #000">Dotted</option>
              </select>
            </div>
            
            <div class="property-control">
              <span>Shadow</span>
              <select [(ngModel)]="canvasElements[selectedElement].boxShadow" (change)="updateElement()">
                <option value="none">None</option>
                <option value="0 2px 5px rgba(0,0,0,0.1)">Light</option>
                <option value="0 4px 8px rgba(0,0,0,0.2)">Medium</option>
                <option value="0 8px 16px rgba(0,0,0,0.3)">Strong</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            
            <div class="shadow-custom-controls" *ngIf="canvasElements[selectedElement].boxShadow === 'custom'">
              <div class="property-control">
                <span>Shadow Color</span>
                <input type="color" [(ngModel)]="canvasElements[selectedElement].shadowColor" (change)="updateCustomShadow()">
              </div>
              <div class="property-control">
                <span>Blur</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowBlur" (change)="updateCustomShadow()" min="0" max="20" step="1">
                <span class="value-display">{{ canvasElements[selectedElement].shadowBlur || 0 }}px</span>
              </div>
              <div class="property-control">
                <span>Offset X</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowOffsetX" (change)="updateCustomShadow()" min="-20" max="20" step="1">
                <span class="value-display">{{ canvasElements[selectedElement].shadowOffsetX || 0 }}px</span>
              </div>
              <div class="property-control">
                <span>Offset Y</span>
                <input type="range" [(ngModel)]="canvasElements[selectedElement].shadowOffsetY" (change)="updateCustomShadow()" min="-20" max="20" step="1">
                <span class="value-display">{{ canvasElements[selectedElement].shadowOffsetY || 0 }}px</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Custom Size Dialog - Modern Design -->
  <div *ngIf="showCustomSizeDialog" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 1.5rem;">
    <div style="background: white; border-radius: 16px; width: 100%; max-width: 600px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
      <!-- Modern Header -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1.5rem 2rem; border-bottom: 2px solid #e2e8f0; background: linear-gradient(135deg, #f8fafc 0%, #faf5ff 100%);">
        <div style="display: flex; align-items: center; gap: 0.875rem;">
          <div style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; border-radius: 10px; padding: 10px; display: flex; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px;">photo_size_select_large</mat-icon>
          </div>
          <div>
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin: 0;">Custom Canvas Size</h3>
            <p style="font-size: 0.875rem; color: #64748b; margin: 0.25rem 0 0 0;">Set dimensions or choose preset</p>
          </div>
        </div>
        <button (click)="closeCustomSizeDialog()" 
                style="background: #f1f5f9; border: none; border-radius: 10px; padding: 0.625rem; cursor: pointer; transition: all 0.3s;"
                onmouseover="this.style.background='#e2e8f0'; this.style.transform='rotate(90deg)';" 
                onmouseout="this.style.background='#f1f5f9'; this.style.transform='rotate(0deg)';">
          <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #64748b;">close</mat-icon>
        </button>
      </div>
      
      <!-- Content -->
      <div style="padding: 2rem;">
        <!-- Custom Dimensions -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 2rem;">
          <div>
            <label for="customWidth" style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #a855f7;">width</mat-icon>
              <span>Width (px)</span>
            </label>
            <input type="number" id="customWidth" [(ngModel)]="customWidth" min="50" max="2000"
                   style="width: 100%; padding: 0.875rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; font-weight: 600; color: #0f172a; outline: none; transition: all 0.3s;"
                   onfocus="this.style.borderColor='#a855f7'; this.style.boxShadow='0 0 0 4px rgba(168, 85, 247, 0.1)';" 
                   onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
          </div>
          <div>
            <label for="customHeight" style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #a855f7;">height</mat-icon>
              <span>Height (px)</span>
            </label>
            <input type="number" id="customHeight" [(ngModel)]="customHeight" min="50" max="2000"
                   style="width: 100%; padding: 0.875rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; font-weight: 600; color: #0f172a; outline: none; transition: all 0.3s;"
                   onfocus="this.style.borderColor='#a855f7'; this.style.boxShadow='0 0 0 4px rgba(168, 85, 247, 0.1)';" 
                   onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
          </div>
        </div>
        
        <!-- Preset Sizes -->
        <div>
          <h4 style="font-size: 0.95rem; font-weight: 700; color: #0f172a; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #a855f7;">apps</mat-icon>
            <span>Preset Sizes</span>
          </h4>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.875rem;">
            <button (click)="selectPresetSize('instagram')" 
                    style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #fdf4ff 100%); border: 2px solid #e9d5ff; border-radius: 12px; cursor: pointer; transition: all 0.3s; text-align: left; display: flex; align-items: center; gap: 0.75rem;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(168, 85, 247, 0.15)'; this.style.borderColor='#a855f7';" 
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e9d5ff';">
              <mat-icon style="font-size: 28px; width: 28px; height: 28px; color: #c026d3;">photo_library</mat-icon>
              <div>
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a;">Instagram Post</div>
                <div style="font-size: 0.75rem; color: #64748b;">1080 Ã 1080</div>
              </div>
            </button>
            
            <button (click)="selectPresetSize('facebook')" 
                    style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #eff6ff 100%); border: 2px solid #dbeafe; border-radius: 12px; cursor: pointer; transition: all 0.3s; text-align: left; display: flex; align-items: center; gap: 0.75rem;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.15)'; this.style.borderColor='#3b82f6';" 
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#dbeafe';">
              <mat-icon style="font-size: 28px; width: 28px; height: 28px; color: #3b82f6;">facebook</mat-icon>
              <div>
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a;">Facebook Post</div>
                <div style="font-size: 0.75rem; color: #64748b;">1200 Ã 630</div>
              </div>
            </button>
            
            <button (click)="selectPresetSize('twitter')" 
                    style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #f0f9ff 100%); border: 2px solid #e0f2fe; border-radius: 12px; cursor: pointer; transition: all 0.3s; text-align: left; display: flex; align-items: center; gap: 0.75rem;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(14, 165, 233, 0.15)'; this.style.borderColor='#0ea5e9';" 
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#e0f2fe';">
              <mat-icon style="font-size: 28px; width: 28px; height: 28px; color: #0ea5e9;">tag</mat-icon>
              <div>
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a;">Twitter Post</div>
                <div style="font-size: 0.75rem; color: #64748b;">1024 Ã 512</div>
              </div>
            </button>
            
            <button (click)="selectPresetSize('story')" 
                    style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #fdf4ff 100%); border: 2px solid #fae8ff; border-radius: 12px; cursor: pointer; transition: all 0.3s; text-align: left; display: flex; align-items: center; gap: 0.75rem;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(217, 70, 239, 0.15)'; this.style.borderColor='#d946ef';" 
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#fae8ff';">
              <mat-icon style="font-size: 28px; width: 28px; height: 28px; color: #d946ef;">auto_stories</mat-icon>
              <div>
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a;">Instagram Story</div>
                <div style="font-size: 0.75rem; color: #64748b;">1080 Ã 1920</div>
              </div>
            </button>
            
            <button (click)="selectPresetSize('youtube')" 
                    style="padding: 1rem; background: linear-gradient(135deg, #fefeff 0%, #fef2f2 100%); border: 2px solid #fee2e2; border-radius: 12px; cursor: pointer; transition: all 0.3s; text-align: left; display: flex; align-items: center; gap: 0.75rem; grid-column: span 2;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(239, 68, 68, 0.15)'; this.style.borderColor='#ef4444';" 
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#fee2e2';">
              <mat-icon style="font-size: 28px; width: 28px; height: 28px; color: #ef4444;">play_circle</mat-icon>
              <div>
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a;">YouTube Thumbnail</div>
                <div style="font-size: 0.75rem; color: #64748b;">1280 Ã 720</div>
              </div>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <div style="display: flex; align-items: center; justify-content: flex-end; gap: 1rem; padding: 1.5rem 2rem; border-top: 2px solid #e2e8f0; background: #f8fafc;">
        <button (click)="closeCustomSizeDialog()" 
                style="padding: 0.875rem 1.5rem; background: white; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.875rem; font-weight: 700; color: #64748b; cursor: pointer; transition: all 0.3s;"
                onmouseover="this.style.background='#f1f5f9'; this.style.borderColor='#cbd5e1';" 
                onmouseout="this.style.background='white'; this.style.borderColor='#e2e8f0';">
          Cancel
        </button>
        <button (click)="applyCustomSize()" 
                style="padding: 0.875rem 1.75rem; background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); border: none; border-radius: 10px; font-size: 0.875rem; font-weight: 700; color: white; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3); display: flex; align-items: center; gap: 0.5rem;"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(168, 85, 247, 0.4)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.3)';">
          <mat-icon style="font-size: 20px; width: 20px; height: 20px;">check_circle</mat-icon>
          <span>Apply Size</span>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Image Crop Dialog - Modern Design -->
  <div *ngIf="showCropDialog" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 1.5rem; animation: fadeIn 0.3s ease-in-out;">
    <div style="background: white; border-radius: 16px; width: 100%; max-width: 900px; max-height: 90vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: scaleIn 0.3s ease-in-out;">
      <!-- Modern Header -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1.5rem 2rem; border-bottom: 2px solid #e2e8f0; background: linear-gradient(135deg, #f8fafc 0%, #f0f9ff 100%);">
        <div style="display: flex; align-items: center; gap: 0.875rem;">
          <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-radius: 10px; padding: 10px; display: flex; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px;">crop</mat-icon>
          </div>
          <div>
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin: 0;">Crop Image</h3>
            <p style="font-size: 0.875rem; color: #64748b; margin: 0.25rem 0 0 0;">Adjust crop area and aspect ratio</p>
          </div>
        </div>
        <button (click)="closeCropDialog()" 
                style="background: #f1f5f9; border: none; border-radius: 10px; padding: 0.625rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center;"
                onmouseover="this.style.background='#e2e8f0'; this.style.transform='rotate(90deg)';" 
                onmouseout="this.style.background='#f1f5f9'; this.style.transform='rotate(0deg)';">
          <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #64748b;">close</mat-icon>
        </button>
      </div>
      
      <!-- Crop Content -->
      <div style="padding: 2rem; max-height: calc(90vh - 200px); overflow-y: auto;">
        <!-- Crop Container -->
        <div class="crop-container" style="position: relative; width: 100%; max-height: 500px; background: #1e293b; border-radius: 12px; overflow: hidden; margin-bottom: 1.5rem; box-shadow: inset 0 0 0 2px #334155;">
          <img #cropImage [src]="currentImageToCrop?.src" alt="Image to crop" style="max-width: 100%; max-height: 500px; display: block; margin: auto;">
          <div class="crop-area" #cropArea
               [style.width.px]="cropWidth"
               [style.height.px]="cropHeight"
               [style.top.px]="cropTop"
               [style.left.px]="cropLeft"
               (mousedown)="startCropDrag($event)"
               style="position: absolute; border: 3px solid #06b6d4; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5), 0 0 20px rgba(6, 182, 212, 0.5); cursor: move; transition: box-shadow 0.2s;">
            <div class="resize-handle top-left" (mousedown)="startCropResize('top-left', $event)" style="position: absolute; width: 16px; height: 16px; background: white; border: 3px solid #06b6d4; border-radius: 50%; top: -8px; left: -8px; cursor: nwse-resize; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);"></div>
            <div class="resize-handle top-right" (mousedown)="startCropResize('top-right', $event)" style="position: absolute; width: 16px; height: 16px; background: white; border: 3px solid #06b6d4; border-radius: 50%; top: -8px; right: -8px; cursor: nesw-resize; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);"></div>
            <div class="resize-handle bottom-left" (mousedown)="startCropResize('bottom-left', $event)" style="position: absolute; width: 16px; height: 16px; background: white; border: 3px solid #06b6d4; border-radius: 50%; bottom: -8px; left: -8px; cursor: nesw-resize; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);"></div>
            <div class="resize-handle bottom-right" (mousedown)="startCropResize('bottom-right', $event)" style="position: absolute; width: 16px; height: 16px; background: white; border: 3px solid #06b6d4; border-radius: 50%; bottom: -8px; right: -8px; cursor: nwse-resize; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);"></div>
          </div>
        </div>
        
        <!-- Crop Controls -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
          <!-- Aspect Ratio Selector -->
          <div style="background: linear-gradient(135deg, #f8fafc 0%, #f0f9ff 100%); padding: 1.25rem; border-radius: 12px; border: 2px solid #e2e8f0;">
            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.75rem;">
              <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #06b6d4;">aspect_ratio</mat-icon>
              <span>Aspect Ratio</span>
            </label>
            <select [(ngModel)]="cropAspectRatio" (change)="applyCropAspectRatio()"
                    style="width: 100%; padding: 0.875rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.875rem; font-weight: 600; color: #0f172a; background: white; cursor: pointer; outline: none; transition: all 0.3s;"
                    onfocus="this.style.borderColor='#06b6d4'; this.style.boxShadow='0 0 0 4px rgba(6, 182, 212, 0.1)';" 
                    onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
              <option value="free">ð Free Form</option>
              <option value="1:1">â¬ 1:1 (Square)</option>
              <option value="4:3">ðº 4:3 (Standard)</option>
              <option value="16:9">ï¿½ï¸ 16:9 (Widescreen)</option>
              <option value="3:4">ð 3:4 (Portrait)</option>
              <option value="9:16">ð± 9:16 (Mobile)</option>
            </select>
          </div>
          
          <!-- Crop Dimensions Display -->
          <div style="background: linear-gradient(135deg, #fefeff 0%, #f0fdf4 100%); padding: 1.25rem; border-radius: 12px; border: 2px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
            <mat-icon style="font-size: 32px; width: 32px; height: 32px; color: #10b981; margin-bottom: 0.5rem;">photo_size_select_large</mat-icon>
            <div style="font-size: 0.75rem; font-weight: 600; color: #64748b; margin-bottom: 0.25rem;">Crop Size</div>
            <div style="font-size: 1.125rem; font-weight: 700; color: #0f172a;">{{cropWidth}} Ã {{cropHeight}}</div>
            <div style="font-size: 0.7rem; color: #64748b; margin-top: 0.25rem;">pixels</div>
          </div>
        </div>
      </div>
      
      <!-- Modern Footer -->
      <div style="display: flex; align-items: center; justify-content: flex-end; gap: 1rem; padding: 1.5rem 2rem; border-top: 2px solid #e2e8f0; background: #f8fafc;">
        <button (click)="closeCropDialog()" 
                style="padding: 0.875rem 1.5rem; background: white; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.875rem; font-weight: 700; color: #64748b; cursor: pointer; transition: all 0.3s;"
                onmouseover="this.style.background='#f1f5f9'; this.style.borderColor='#cbd5e1';" 
                onmouseout="this.style.background='white'; this.style.borderColor='#e2e8f0';">
          Cancel
        </button>
        <button (click)="applyCrop()" 
                style="padding: 0.875rem 1.75rem; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); border: none; border-radius: 10px; font-size: 0.875rem; font-weight: 700; color: white; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3); display: flex; align-items: center; gap: 0.5rem;"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(6, 182, 212, 0.4)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(6, 182, 212, 0.3)';">
          <mat-icon style="font-size: 20px; width: 20px; height: 20px;">check_circle</mat-icon>
          <span>Apply Crop</span>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Share Link Dialog - Modern Design -->
  <div *ngIf="showShareDialog" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 1.5rem;">
    <div style="background: white; border-radius: 16px; width: 100%; max-width: 550px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
      <!-- Modern Header -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1.5rem 2rem; border-bottom: 2px solid #e2e8f0; background: linear-gradient(135deg, #f8fafc 0%, #f0fdf4 100%);">
        <div style="display: flex; align-items: center; gap: 0.875rem;">
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 10px; padding: 10px; display: flex; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px;">share</mat-icon>
          </div>
          <div>
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin: 0;">Share Template</h3>
            <p style="font-size: 0.875rem; color: #64748b; margin: 0.25rem 0 0 0;">Share with others to collaborate</p>
          </div>
        </div>
        <button (click)="closeShareDialog()" 
                style="background: #f1f5f9; border: none; border-radius: 10px; padding: 0.625rem; cursor: pointer; transition: all 0.3s;"
                onmouseover="this.style.background='#e2e8f0'; this.style.transform='rotate(90deg)';" 
                onmouseout="this.style.background='#f1f5f9'; this.style.transform='rotate(0deg)';">
          <mat-icon style="font-size: 24px; width: 24px; height: 24px; color: #64748b;">close</mat-icon>
        </button>
      </div>
      
      <!-- Content -->
      <div style="padding: 2rem;">
        <!-- Share Link -->
        <div style="margin-bottom: 2rem;">
          <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.75rem;">
            <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #10b981;">link</mat-icon>
            <span>Share Link</span>
          </label>
          <div style="display: flex; gap: 0.75rem;">
            <input type="text" [value]="shareLink" readonly #shareLinkInput
                   style="flex: 1; padding: 0.875rem 1rem; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.875rem; font-weight: 600; color: #0f172a; background: #f8fafc; outline: none;">
            <button (click)="copyShareLink(shareLinkInput)"
                    style="padding: 0.875rem 1.25rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; border-radius: 10px; color: white; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); display: flex; align-items: center; gap: 0.5rem; font-weight: 700; font-size: 0.875rem;"
                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(16, 185, 129, 0.4)';" 
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)';">
              <mat-icon style="font-size: 20px; width: 20px; height: 20px;">content_copy</mat-icon>
              <span>Copy</span>
            </button>
          </div>
        </div>
        
        <!-- Permissions -->
        <div style="background: linear-gradient(135deg, #fefeff 0%, #f0fdf4 100%); padding: 1.5rem; border-radius: 12px; border: 2px solid #d1fae5;">
          <h4 style="font-size: 0.95rem; font-weight: 700; color: #0f172a; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
            <mat-icon style="font-size: 20px; width: 20px; height: 20px; color: #10b981;">lock_person</mat-icon>
            <span>Access Permissions</span>
          </h4>
          <div style="display: flex; flex-direction: column; gap: 0.875rem;">
            <label for="view-only" style="display: flex; align-items: center; gap: 0.875rem; padding: 1rem; background: white; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s;"
                   onmouseover="this.style.borderColor='#10b981'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.1)';" 
                   onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
              <input type="radio" id="view-only" name="permission" value="view" [(ngModel)]="sharePermission"
                     style="width: 20px; height: 20px; accent-color: #10b981; cursor: pointer;">
              <div style="flex: 1;">
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem;">
                  <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #64748b;">visibility</mat-icon>
                  <span>View Only</span>
                </div>
                <div style="font-size: 0.75rem; color: #64748b;">Users can only view the template</div>
              </div>
            </label>
            
            <label for="can-edit" style="display: flex; align-items: center; gap: 0.875rem; padding: 1rem; background: white; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s;"
                   onmouseover="this.style.borderColor='#10b981'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.1)';" 
                   onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
              <input type="radio" id="can-edit" name="permission" value="edit" [(ngModel)]="sharePermission"
                     style="width: 20px; height: 20px; accent-color: #10b981; cursor: pointer;">
              <div style="flex: 1;">
                <div style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem;">
                  <mat-icon style="font-size: 18px; width: 18px; height: 18px; color: #10b981;">edit</mat-icon>
                  <span>Can Edit</span>
                </div>
                <div style="font-size: 0.75rem; color: #64748b;">Users can view and make changes</div>
              </div>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1.5rem 2rem; border-top: 2px solid #e2e8f0; background: #f8fafc;">
        <button (click)="generateNewShareLink()" 
                style="padding: 0.875rem 1.5rem; background: white; border: 2px solid #10b981; border-radius: 10px; font-size: 0.875rem; font-weight: 700; color: #10b981; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 0.5rem;"
                onmouseover="this.style.background='#f0fdf4'; this.style.transform='scale(1.02)';" 
                onmouseout="this.style.background='white'; this.style.transform='scale(1)';">
          <mat-icon style="font-size: 20px; width: 20px; height: 20px;">refresh</mat-icon>
          <span>Generate New Link</span>
        </button>
        <button (click)="closeShareDialog()" 
                style="padding: 0.875rem 1.75rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; border-radius: 10px; font-size: 0.875rem; font-weight: 700; color: white; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(16, 185, 129, 0.4)';" 
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)';">
          Done
        </button>
      </div>
    </div>
  </div>
</div>
